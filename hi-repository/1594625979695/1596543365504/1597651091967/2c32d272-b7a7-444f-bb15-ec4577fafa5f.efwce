<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<efwce>
    <fileName>Criteria Failure Report</fileName>
    <efw>2c32d272-b7a7-444f-bb15-ec4577fafa5f.efw</efw>
    <visible>true</visible>
    <description>Efw Dashboard </description>
    <state><![CDATA[{"allTypes":{"sqlTypes":[{"name":"sql"},{"name":"sql.groovy"},{"name":"sql.adhoc"}],"vizTypes":[{"name":"Area","type":"EFW-c3","subtype":"Area","icon":"AreaChart"},{"name":"Area Spline","type":"EFW-c3","subtype":"AreaSpline","icon":"AreaSplineChart"},{"name":"Area Step","type":"EFW-c3","subtype":"AreaStep","icon":"AreaStepChart"},{"name":"Bar","type":"EFW-c3","subtype":"bar","icon":"BarChart"},{"name":"Donut","type":"EFW-c3","subtype":"donut","icon":"DonutChart"},{"name":"Gauge","type":"EFW-c3","subtype":"gauge","icon":"HICircularGauge"},{"name":"Line","type":"EFW-c3","subtype":"Line","icon":"LineChart"},{"name":"Pie","type":"EFW-c3","subtype":"Pie","icon":"PieChart"},{"name":"Scatter","type":"EFW-c3","subtype":"Scatter","icon":"ScatterChart"},{"name":"Spline","type":"EFW-c3","subtype":"Spline","icon":"SplineChart"},{"name":"Step","type":"EFW-c3","subtype":"Step","icon":"StepChart"},{"name":"Cross Tab","type":"EFW-CrossTab","icon":"HICrossTable"},{"name":"Table","type":"EFW-Table","icon":"HITable"},{"name":"Custom","type":"Custom","icon":"VF"}],"connTypes":[{"clazz":"com.helicalinsight.datasource.GlobalJdbcDataSource","classifier":"global","name":"Managed DataSource","type":"global.jdbc","hidden":"false"},{"clazz":"com.helicalinsight.datasource.JDBCDriver","classifier":"efwd","name":"Plain Jdbc DataSource","type":"sql.jdbc","hidden":"false"},{"clazz":"com.helicalinsight.adhoc.SqlAdhocDriver","classifier":"efwd","name":"Adhoc DataSource","type":"sql.adhoc","hidden":"true"},{"clazz":"com.helicalinsight.datasource.ExtJDBCDriver","classifier":"efwd","name":"Groovy Plain Jdbc DataSource","type":"sql.jdbc.groovy","hidden":"false"},{"clazz":"com.helicalinsight.datasource.GroovyManagedDriver","classifier":"efwd","name":"Groovy Managed Jdbc DataSource","type":"sql.jdbc.groovy.managed","hidden":"false"}],"parameterTypes":[{"name":"Collection"},{"name":"Numeric"},{"name":"String"}]},"datasource":[{"id":1,"configure":"<globalId>2<\/globalId>","name":"sponsor","type":{"name":"Managed DataSource","type":"global.jdbc"}}],"dashboard":{"html":"<div>\n<div id=\"divfailure\" class=\"col-xs-6 col-sm-3 col-lg-2 inputControl\">\n        <div id=\"Failures\"><\/div>\n<\/div>\n<div id=\"divprotocol\" class=\"col-xs-6 col-sm-3 col-lg-2 inputControl\">\n        <div id=\"Protocols\"><\/div>\n<\/div>\n<\/div>\n<div id=\"Trials\"><\/div>\n<div id=\"SiteTrials\"><\/div>\n<div id=\"failure_ParentTable\"><\/div>\n<div id=\"dummy\"><\/div>\n","css":".bar-chart-bar {\r\n    display: block; \r\n    position:relative; \r\n\tfloat: right;\r\n    height: 15px;\r\n}\r\n#table th {\r\n    border-bottom: 1px solid #dadada;\r\n    position: sticky;\r\n    box-shadow: #dee1e3 0px 2px 2px 0px;\r\n}\r\n#table_child thead,#table_child2 thead{\r\n    visibility: collapse;\r\n}\r\n#main-table-bars{\r\n    margin-left: 10px ! important;\r\n}\r\n#table_for_header thead tr th{\r\n    background-color: #f6f6f6;\r\n    font-weight: normal;\r\n    font-family: Lato;\r\n    color: #777d94;\r\n    text-align: left;\r\n    padding: 1rem;\r\n    padding-left: 1.5rem;\r\n}\r\n#table_for_header thead,#chart_2, #chart_3{\r\n    border: 1px solid lightgray;\r\n}\r\n#nested_tables{\r\n    padding: 5px;\r\n}\r\n.criteria-failure-codes {\r\n    display: inline-block;\r\n    border: 1px solid #DADADA;\r\n    background: #F9F9FA;\r\n    padding: .3rem;\r\n    border-radius: .3rem;\r\n    font-size: 1.1rem;\r\n    font-family: Lato;\r\n    cursor: pointer;\r\n}\r\n.dataTables_filter{\r\n float: left ! important;\r\n margin-top: -35px;\r\n}\r\n\r\n#table .colH_1, .col_1, .colH_2, .col_2,#table_child .colH_1, .col_1, .colH_2, .col_2,#table_child2 .colH_1, .col_1, .colH_2, .col_2{\r\n    text-align: right ! important;\r\n    justify-content: flex-end ! important;\r\n   // font-weight: bold ! important;\r\n    \r\n} \r\n#table .col_1, .col_2,#table_child .col_1, .col_2,#table_child2 .col_1, .col_2{\r\n    font-size: 1.3rem ! important;\r\n}\r\n#table .colH_3, .col_3,#table_child .colH_3, .col_3,#table_child2 .colH_3, .col_3{\r\n    padding-left: 5rem ! important;\r\n    \r\n}\r\n#table .colH_0,.colH_4{\r\n    border-left: none ! important;\r\n}\r\ndetails[open] .elipsisSpan { \r\n  display:none;\r\n}\r\nsummary{\r\n    outline: none;\r\n    display: list-item;\r\n}\r\n#bySiteButton, #byCountryButton, #closeButton {\r\n    padding-left: 5px;\r\n    padding-right: 5px;\r\n    font-family: Lato;\r\n    font-weight: bold;\r\n    //font-size: 1.3rem;\r\n    color: #777d94;\r\n    background: #f6f6f6;\r\n    border: none;\r\n    outline:none;\r\n}\r\n#closeButton{\r\n    float:right;\r\n}\r\n#bySiteButton{\r\n    float: right;\r\n    padding-bottom: 7px;\r\n\tmargin: 0px -7px;\r\n}\r\n#byCountryButton{\r\n    padding-bottom: 7px;\r\n\tmargin: 0px 9px;\r\n}\r\n#table_child, #table_child2{\r\n    //padding: 5px;\r\n    border: none;\r\n}\r\n#Trials, #SiteTrials{\r\n    display: none;\r\n}\r\n#divprotocol{\r\n    float: right;\r\n    padding: 2px;\r\n}\r\n#divfailure{\r\n    float: right;\r\n    padding: 2px;\r\n}\r\n#Protocols .form-control, #Failures .form-control{\r\n    font-family: Lato;\r\n    font-weight: bold;\r\n    color: #777d94;\r\n}\r\n.select2-container-multi .select2-choices{\r\n    border-radius: 4px;\r\n    min-height: 40px ! important;\r\n    color: #dadada;\r\n    border-color: #cdcdcd;\r\n    max-height: 100px;\r\n    overflow-y: auto;\r\n}\r\n.select2-container-multi .select2-choices .select2-search-choice{\r\n    border-radius: 2px;\r\n    background-color: rgba(0,126,255,0.08);\r\n    border: 1px solid rgba(0,126,255,0.24);\r\n    color: #007eff;\r\n    display: inline-block;\r\n    vertical-align: top;\r\n    margin-top: 5px;\r\n    margin-left: 5px;\r\n    max-width: 90%;\r\n}\r\n.select2-search-choice div{\r\n    padding: 2px;\r\n    padding-left: 7px;\r\n    color: #60A5EB;\r\n    text-overflow: initial;\r\n    overflow: auto;\r\n    white-space: normal;\r\n    word-break: break-word;\r\n    hyphens: none;\r\n    //border-left: 1px solid rgba(0,126,255,0.24);\r\n}\r\n.select2-search-choice-close{\r\n    height: 100%;\r\n    top: 0px ! important;\r\n    left: 0px ! important;\r\n    border-right: 1px solid rgba(0,126,255,0.24);\r\n    width: 18px;\r\n    /*\r\n    padding-bottom: 25px;\r\n    margin-top: -4px;\r\n    padding-left: 18px;\r\n    */\r\n}\r\n.select2-search-choice-close:before{\r\n    color: #007eff;\r\n    font-weight: 100;\r\n    font-size: 12px;\r\n    top: 20%;\r\n    /*\r\n    margin-top: 5px;\r\n    margin-left: -1px;\r\n    */\r\n}\r\n.select2-container-multi .select2-choices .select2-search-field input{\r\n    font-family: Arial !important;\r\n    font-style: italic;\r\n    color: #a4a8b4 ! important;\r\n    line-height: 1.6em;\r\n}\r\n.select2-drop-active{\r\n    border: 1px solid #cdcdcd;\r\n    border-top: 1px solid #cdcdcd;\r\n}\r\n.select2-results{\r\n    /*font-family: Arial !important; */\r\n    /* font-style: italic; */\r\n    color: #595f75 ! important;\r\n    line-height: 1.6em;\r\n    font-family: Lato;\r\n}\r\n.select2-results .select2-highlighted{\r\n    background: #f6f6f6;\r\n    color: #595f75;\r\n}\r\n"},"parameters":[{"id":1,"configure":"dashboard.setVariable('Trials',[\"_all_\"]);\nvar Trials = {\n    name: \"Trials\" ,\n    type:  \"select2\",\n    parameters: ['Trials'],\n    listeners: ['Protocols'], //,'Protocols','Failures'\n    requestParameters: { 'user_name': 'user_name'},\n    options:{\n        all: true,\n        multiple: true,             // it can be true or false\n        display : 'trial_id',\n        value : 'trial_id'\n    },\n    htmlElementId : \"#Trials\",              \n    executeAtStart: true,            // it can be true or false\n    map: 6,\n    efwd : {\n        file: '__efwd_file_name__'\n    },\n};\n","name":"Trials","type":"Collection","sql":{"id":6,"type":"sql","text":"select distinct cast(t.id as text) as trial_id from \"Trial\" t\r\ninner join \"TrialGrant\" tg on t.id=tg.trial_id\r\nwhere tg.user_id = ${user_name}","dataSource":{"id":1,"name":"sponsor"},"parameters":[{"id":2,"openQuote":"","closeQuote":""}]}},{"id":2,"configure":"//DashboardGlobals.sessionUserName\n//'auth0|5b242f33c622dc3967ae3822'\ndashboard.setVariable('user_name',DashboardGlobals.sessionUserName);\nvar user_name = {\n    name: \"user_name\" ,\n    type:  \"select2\", \n    options:{\n        multiple: false,             // it can be true or false\n        display : 'column_name',\n        value : 'column_name',\n        placeholder: 'select value'\n    },\n    htmlElementId : \"#user_name\",              \n    executeAtStart: false,            // it can be true or false\n    map: 7,\n    efwd : {\n        file: '__efwd_file_name__'\n    },\n};\nconsole.log(\"Logged in User: \",dashboard.getVariable('user_name'));\n","name":"user_name","type":"String","sql":{"id":7,"type":"sql","text":"","dataSource":{"id":1,"name":"sponsor"},"parameters":[]}},{"id":3,"configure":"dashboard.setVariable('selected_criteria_code','Inc 1');\nvar selected_criteria_code = {\n    name: \"selected_criteria_code\" ,\n    type:  \"select2\",             \n    options:{\n        multiple: false,             // it can be true or false\n        display : 'column_name',\n        value : 'column_name',\n        placeholder: 'select value'\n    },\n    htmlElementId : \"#selected_criteria_code\",              \n    executeAtStart: false,            // it can be true or false\n    map: 12,\n    efwd : {\n        file: '__efwd_file_name__'\n    },\n};\n","name":"selected_criteria_code","type":"String","sql":{"id":12,"type":"sql","text":"","dataSource":{"id":1,"name":"sponsor"},"parameters":[]}},{"id":4,"configure":"dashboard.setVariable('SiteTrials',[\"_all_\"]);\nvar SiteTrials = {\n    name: \"SiteTrials\" ,\n    type:  \"select2\",          \n    listeners: ['Trials'],\n    parameters:[\"SiteTrials\"],\n    requestParameters: {'Trials': 'Trials', 'user_name': 'user_name'},\n    options:{\n        all: true,\n        multiple: true,             // it can be true or false\n        display : 'site_trial_id',\n        value : 'site_trial_id'\n    },\n    htmlElementId : \"#SiteTrials\",              \n    executeAtStart: true,            // it can be true or false\n    map: 13,\n    efwd : {\n        file: '__efwd_file_name__'\n    },\n};\n","name":"SiteTrials","type":"Collection","sql":{"id":13,"type":"sql","text":"select distinct cast(stp.site_trial_id as text) as site_trial_id from \"SiteTrialPatientView\" stp\r\nJOIN \"SiteTrialRead\" st ON stp.site_trial_id = st.id and st.is_pseudo=false\r\nJOIN \"Trial\" trial  ON st.sponsor_trial_id = trial.id  and trial.is_pseudo=false\r\nJOIN \"TrialGrant\" TG on TG.trial_id = trial.id\r\nwhere \r\n(('_all_'=${Trials}) or (cast(trial.id as text) = ${Trials}))\r\nAND TG.user_id = ${user_name}","dataSource":{"id":1,"name":"sponsor"},"parameters":[{"id":2,"openQuote":"","closeQuote":""},{"id":1,"openQuote":"","closeQuote":""}]}},{"id":5,"configure":"dashboard.setVariable('Protocols',[\"All Protocols\"]);\nvar Protocols = {\n    name: \"Protocols\" ,\n    type:  \"select2\",             \n    parameters:[\"Protocols\"],\n    listeners: ['Trials'],\n    requestParameters: {'Trials': 'Trials', 'user_name': 'user_name'},\n    options:{\n        multiple: true,             // it can be true or false\n        display : 'protocol_name_and_version',\n        value : 'protocol_name_and_version',\n        placeholder: 'All Protocols'\n    },\n    htmlElementId : \"#Protocols\",              \n    executeAtStart: true,            // it can be true or false\n    map: 14,\n    efwd : {\n        file: '__efwd_file_name__'\n    },\n};\n","name":"Protocols","type":"Collection","sql":{"id":14,"type":"sql","text":"select protocol_name_and_version from \r\n\t(\r\n\tselect distinct protocol_name_and_version,IEC.created_at from \"InclusionExclusionCriteria\" IEC\r\n\tJOIN \"Trial\" AS T ON T.id = IEC.trial_id\r\n\tJOIN \"TrialGrant\" TG on TG.trial_id = T.id\r\n\twhere (('_all_'=${Trials}) or (cast(T.id as text) = ${Trials}))\r\n    AND TG.user_id = ${user_name}\r\n\t) as protocals\r\norder by created_at desc","dataSource":{"id":1,"name":"sponsor"},"parameters":[{"id":1,"openQuote":"","closeQuote":""},{"id":2,"openQuote":"","closeQuote":""}]}},{"id":6,"configure":"dashboard.setVariable('Failures',[\"All Failures\"]);\nvar Failures = {\n    name: \"Failures\" ,\n    type:  \"select2\",             \n    parameters:[\"Failures\"],\n    requestParameters: {'Trials': 'Trials', 'user_name': 'user_name','SiteTrials': 'SiteTrials','Protocols': 'Protocols'},\n    options:{\n        multiple: true,             // it can be true or false\n        display : 'display_col',\n        value : 'passing_col',\n        placeholder: 'All Failures'\n    },\n    htmlElementId : \"#Failures\",              \n    executeAtStart: true,            // it can be true or false\n    map: 15,\n    efwd : {\n        file: '__efwd_file_name__'\n    },\n};\n","name":"Failures","type":"Collection","sql":{"id":15,"type":"sql","text":"select\r\nCASE WHEN STPV.stage = 'potential-candidate' THEN 'Potential Candidate' ELSE\r\n  CASE WHEN STPV.stage = 'pre-screening' THEN 'Pre-Screening' ELSE\r\n\tCASE WHEN STPV.stage = 'first-visit-scheduled' THEN 'First Visit Scheduled' ELSE\r\n\t  CASE WHEN STPV.stage = 'in-screening' THEN 'In-Screening' ELSE\r\n\t\tCASE WHEN STPV.stage = 'enrolled' THEN 'Actively Enrolled' ELSE\r\n\t\t  CASE WHEN STPV.stage = 'completed' THEN 'Completed' ELSE\r\n\t\t\tCASE WHEN STPV.stage = 'pre-screen-failure' THEN 'Pre-screen Failure' ELSE\r\n\t\t\t\tCASE WHEN STPV.stage = 'screen-failure' THEN 'Screen Failure' ELSE\r\n\t\t\t\t\tCASE WHEN STPV.stage = 'discontinued' THEN 'Discontinued' ELSE 'Other' END END END END END END END END END as display_col,\r\nSTPV.stage as passing_col,\r\nCASE WHEN STPV.stage = 'pre-screen-failure' THEN 1 ELSE\r\n CASE WHEN STPV.stage = 'screen-failure' THEN 2 ELSE\r\n\tCASE WHEN STPV.stage = 'potential-candidate' THEN 3 ELSE\r\n\t  CASE WHEN STPV.stage = 'pre-screening' THEN 4 ELSE\r\n\t\tCASE WHEN STPV.stage = 'first-visit-scheduled' THEN 5 ELSE\r\n\t\t  CASE WHEN STPV.stage = 'in-screening' THEN 6 ELSE\r\n\t\t\tCASE WHEN STPV.stage = 'enrolled' THEN 7 ELSE\r\n\t\t\t  CASE WHEN STPV.stage = 'completed' THEN 8 ELSE\t\t\r\n\t\t\t\tCASE WHEN STPV.stage = 'discontinued' THEN 9 ELSE 10 END END END END END END END END END AS list_order\r\nfrom \r\n(select distinct STPV.stage from \"Answer\" AS A\r\nJOIN \"SiteTrialQuestion\" AS STQ ON A.site_trial_question_id = STQ.id\r\nJOIN \"Question\" AS Q ON Q.id = STQ.question_id\r\nJOIN \"InclusionExclusionCriteriaQuestion\" IECQ ON IECQ.question_id = Q.id\r\nJOIN \"InclusionExclusionCriteria\" IEC ON IECQ.ie_criteria_id = IEC.id\r\nRIGHT JOIN \"SiteTrialPatientView\" AS STPV ON STPV.id = A.site_trial_patient_id\r\nJOIN \"SiteTrialView\" AS STV ON STV.id = STQ.site_trial_id and STV.is_pseudo = false\r\nJOIN \"Trial\" AS T ON T.id = sponsor_trial_id AND T.id = IEC.trial_id AND T.is_pseudo = false\r\nJOIN \"TrialGrant\" TG on TG.trial_id = T.id\r\nJOIN \"Site\" AS S ON S.id = STV.site_id AND S.is_pseudo = false\r\nWhere   \r\nSTV.ie_criteria_checklist_enabled = true\r\nAND stage != 'archive'\r\nAND ((response = 'Yes' AND criterion_type = 'exclusion') OR (response = 'No' AND criterion_type = 'inclusion'))\r\nAND TG.user_id = ${user_name}\r\nAND (('_all_'=${Trials}) or (cast(T.id as text) = ${Trials}))\r\nAND (('_all_' in (${SiteTrials})) or (cast(STPV.site_trial_id as text) in (${SiteTrials})))\r\nAND (('All Protocols' in (${Protocols})) or (cast(protocol_name_and_version as text) in (${Protocols})))\r\n)STPV\r\norder by list_order","dataSource":{"id":1,"name":"sponsor"},"parameters":[{"id":1,"openQuote":"","closeQuote":""},{"id":2,"openQuote":"","closeQuote":""},{"id":4,"openQuote":"","closeQuote":""},{"id":5,"openQuote":"","closeQuote":""}]}}],"reports":[{"id":1,"configure":"var table = [];\nvar failure_ParentTable = {\n    name: \"failure_ParentTable\",\n    type:\"chart\",\n    listeners: ['SiteTrials','Trials'], //,'Protocols','Failures'\n    requestParameters: {'Trials': 'Trials', 'user_name': 'user_name','SiteTrials': 'SiteTrials','Protocols': 'Protocols','Failures': 'Failures'},\n    vf : {\n        id: \"1\",\n        file: '__efwvf_name__'\n    },\n    efwd : {\n        file: '__efwd_file_name__'\n    },\n    htmlElementId : \"#failure_ParentTable\", // provide report id here\n    executeAtStart: true  // it can be true or false\n};\n","visualisation":"if (data.length == 0) {\r\n\t\t\t    $('#chart_1').html(\"<div ><h4 style='font-family:Lato;text-align:CENTER;color:#777d94; padding-top:80px;'>No Data Available For Current Selection<\/h4><\/div>\");\r\n\t\t\t    return;\r\n} else {\r\nvar link = document.createElement(\"link\");\r\n\t\t\t\t  link.rel = \"stylesheet\";\r\n\t\t\t\t  \r\n\t\t\t\t  if(window.DashboardGlobals)\r\n\t\t\t\t\t\tlink.href = window.DashboardGlobals.baseUrl+\"/getExternalResource.html?path=1594625979695/1600153490910/jquery.dataTables.css\";\t\t\t\t\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tlink.href = \"getExternalResource.html?path=1594625979695/1600153490910/jquery.dataTables.css\";\r\n\t\t\t\t  \r\n\t\t\t\t\r\n\t\t\t\t document.getElementsByTagName(\"head\")[0].appendChild(link);\r\n\t\t\t\t var link2 = document.createElement(\"link\");\r\n\t\t\t\t link2.rel = 'stylesheet';\r\n\t\t\t\tif(window.DashboardGlobals)\r\n\t\t\t\tlink2.href = \"https://fonts.googleapis.com/css?family=Lato\";\r\n\t\t\t\telse\r\n\t\t\t\tlink2.href = \"https://fonts.googleapis.com/css?family=Lato\";\r\n\r\n\t\t\t\tdocument.getElementsByTagName(\"head\")[0].appendChild(link2);\r\n\t\t\t\t \r\n\t\t\t\t \r\n\t\t\t\t   var script = document.createElement(\"script\");\r\n\t\t\t\t   scriptLoaded = false;\r\n\t\t\t\t   \r\n\t\t\t\t\tif(window.DashboardGlobals)\r\n\t\t\t\t\t\tscript.src = window.DashboardGlobals.baseUrl+\"/getExternalResource.html?path=1594625979695/1600153490910/jquery.dataTables.min.js\";\t\t\t\t\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tscript.src = \"getExternalResource.html?path=1594625979695/1600153490910/jquery.dataTables.min.js\";\r\n\t\t\t\t \r\n\t\t\t\t script.async = false;\r\n\t\t\t\t document.getElementsByTagName(\"head\")[0].appendChild(script);\r\n\r\n                                var column_index=[];\r\n\t\t\t\t\t\t\t\tvar flag;\r\n\t\t\t\t\t\t\t\tfunction tabulate(elem, data, columns) {\t\r\n\t\t\t\t\t\t\t\tvar table = d3.select(elem).append(\"table\")\t\r\n\t\t\t\t\t\t\t\t.attr(\"class\",\" table display compact width:100%;cellspacing:1 \")\r\n\t\t\t\t\t\t\t\t.attr(\"id\",\"table\")\r\n\t\t\t\t\t\t\t\tthead = table.append(\"thead\"),\r\n\t\t\t\t\t\t\t\ttbody = table.append(\"tbody\");\r\n\r\n\r\n\t\t\t\t\t\t\t\t// append the header row\r\n\t\t\t\t\t\t\t\tthead.append(\"tr\")\r\n\t\t\t\t\t\t\t\t.selectAll(\"th\")\r\n\t\t\t\t\t\t\t\t.data(columns)\r\n\t\t\t\t\t\t\t\t.enter()\r\n\t\t\t\t\t\t\t\t.append(\"th\")\r\n\t\t\t\t\t\t\t\t.text(function(column) { return column; })\r\n\t\t\t\t\t\t\t\t.attr('class', function(d, i){ return \"colH_\" + i; })\r\n\t\t\t\t\t\t\t\t.style('background-color','#f6f6f6')\r\n\t\t\t\t\t\t\t\t//.style('font-size','13px')\r\n\t\t\t\t\t\t\t\t.style('font-weight', 'normal')\r\n\t\t\t\t\t\t\t\t.style('font-family', 'Lato')\r\n\t\t\t\t\t\t\t\t.style('color','#777d94')\r\n\t\t\t\t\t\t\t\t//.style('border-left','1px solid #d2cfcf75')\r\n\t\t\t\t\t\t\t\t.style('text-align','left')\r\n\t\t\t\t\t\t\t\t//.style('padding-bottom','10px')\r\n\t\t\t\t\t\t\t\t//.style('@media print','display:none')\r\n\t\t\t\t\t\t\t\t//.style('padding-left','25px')\r\n\t\t\t\t\t\t\t\t.style('min-width','10rem')\r\n\t\t\t\t\t\t\t\t.style('padding','1rem')\r\n\r\n\r\n\t\t\t\t\t\t\t\t// create a row for each object in the data\r\n\t\t\t\t\t\t\t\tvar rows = tbody.selectAll(\"tr\")\r\n\t\t\t\t\t\t\t\t.data(data)\r\n\t\t\t\t\t\t\t\t.enter()\r\n\t\t\t\t\t\t\t\t.append(\"tr\");\r\n\r\n\t\t\t\t\t\t\t\t// create a cell in each row for each column\r\n\t\t\t\t\t\t\t\tvar cells = rows.selectAll(\"td\")\r\n\t\t\t\t\t\t\t\t.data(function(row) {\r\n\t\t\t\t\t\t\t\treturn columns.map(function(column) {\r\n\t\t\t\t\t\t\t\treturn {column: column, value: row[column]};\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t.enter()\r\n\t\t\t\t\t\t\t\t.append(\"td\")\r\n\t\t\t\t\t\t\t\t.text(function(d) { return d.value; })\r\n\t\t\t\t\t\t\t\t.attr('class', function(d, i){ return \"col_\" + i; })\r\n\t\t\t\t\t\t\t\t//.attr('align', 'center')\r\n\t\t\t\t\t\t\t\t.style('color','#777d94')\r\n\t\t\t\t\t\t\t\t//.style('font-size','13px')\r\n\t\t\t\t\t\t\t\t.style('font-weight', 'normal')\r\n\t\t\t\t\t\t\t\t.style('font-family', 'Lato')\r\n\t\t\t\t\t\t\t\t.style('vertical-align', 'middle')\r\n\t\t\t\t\t\t\t\t.style('padding', '1.5rem')\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\treturn table;\r\n\t\t\t\t\t\t\t\t}\t\r\n\r\n\t\t\t\t\t\t\t\t// render the table\r\n\t\t\t\t\t\t\t\tvar subjectTable = tabulate( '#chart_1', data, Object.keys(data[0]));\t\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t  script.onload = function(){\r\n\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tvar firstrecord=true;\r\n\t\t\t\t\t\t\t\tvar firstValue = 0;\r\n\t\t\t\t\t\t\t\tvar localizedData=0;\r\n\t\t\t\t\t\t\t\t//const getNavigatorLanguage='en-US';\r\n\t\t\t\t\t\t\t\tconst getNavigatorLanguage = (navigator.languages && navigator.languages.length) ? navigator.languages[0] : navigator.userLanguage || navigator.language || navigator.browserLanguage || 'en-US';\r\n\t\t\t\t\t\t\t\tconst urlString = window.location.search;\r\n\t\t\t\t\t\t\t\tconst urlParams = new URLSearchParams(urlString);\r\n\t\t\t\t\t\t\t\tconsole.log(\"URL has pageLength: \",urlParams.has('pageLength'));\r\n\t\t\t\t\t\t\t\tconsole.log(\"pageLength: \",urlParams.get('pageLength'));\r\n\t\t\t\t\t\t\t\tif(urlParams.has('pageLength'))\r\n\t\t\t\t\t\t\t\tvar pageLength=parseInt(urlParams.get('pageLength'));\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\tvar pageLength=50;\r\n\t\t\t\t\t\t\t\tconsole.log(\"Data Length: \",data.length);\r\n\t\t\t\t\t\t\t\tif(data.length > pageLength)\r\n\t\t\t\t\t\t\t\tvar paging=true\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\tvar paging=false\r\n\t\t\t\t\t\t\t\t$(document).ready(function() {\t\r\n\t\t\t\t\t\t\t\ttable = $('#table').DataTable({\r\n\t\t\t\t\t\t\t\t\t//\"deferRender\": true,\r\n\t\t\t\t\t\t\t\t\t\"pageLength\": pageLength,\r\n\t\t\t\t\t\t\t\t\t\"lengthChange\": false,\r\n\t\t\t\t\t\t\t\t\t//\"pagingType\": \"full_numbers\",\r\n\t\t\t\t\t\t\t\t\t//\"lengthMenu\": [[25, 10, 25, 50, -1], [10, 10, 25, 50, \"All\"]],\r\n\t\t\t\t\t\t\t\t\t\"paging\": paging,\r\n\t\t\t\t\t\t\t\t\t\"jQueryUI\": true,\r\n\t\t\t\t\t\t\t\t\t\"ordering\": false,\r\n\t\t\t\t\t\t\t\t\t\"info\": true,\r\n\t\t\t\t\t\t\t\t\t//\"bFilter\": false,\r\n\t\t\t\t\t\t\t\t\tautoWidth: false,\r\n\t\t\t\t\t\t\t\t\t\"columns\": [\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\"title\":\"\",\r\n\t\t\t\t\t\t\t\t\t\t\"sortable\":false,\r\n\t\t\t\t\t\t\t\t\t\t\"width\":'96px',\r\n\t\t\t\t\t\t\t\t\t\t\"render\": function(data, type, row, meta){\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tfor(var i = 0; i < Object.keys(data).length; i++){\r\n\t\t\t\t\t\t\t\t\t\t\t\tif(firstrecord){\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tfirstValue = Math.round((120/data + Number.EPSILON)*100)/100;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tfirstrecord=false;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn $(\"<div class='bar-chart-bar' id='main-table-bars'><\/div>\", {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}).css({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"width\": '120px',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"background-color\": '#85000b'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}).prop(\"outerHTML\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvar remainValues = Math.round((firstValue*data + Number.EPSILON)*100)/100;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvar backColor='#fef8f9';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    if(remainValues>90){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#85000b';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>80&&remainValues<=90){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#d2202f';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>70&&remainValues<=80){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#df5f6a';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>60&&remainValues<=70){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#e6838b';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>50&&remainValues<=60){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#ec9ea5';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>40&&remainValues<=50){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#f0b5ba';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>30&&remainValues<=40){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#f4c8cc';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>20&&remainValues<=30){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#f8dadc';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>10&&remainValues<=20){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#fbe9eb';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues=>0&&remainValues<=10){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#fef8f9';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn $(\"<div class='bar-chart-bar'><\/div>\", {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}).css({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"width\": remainValues+'px',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"background-color\": backColor\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}).prop(\"outerHTML\")\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\"type\": \"html\",\r\n\t\t\t\t\t\t\t\t\t\t\"title\":\"# of Patients\",\r\n\t\t\t\t\t\t\t\t\t\t\"width\":'120px',\r\n\t\t\t\t\t\t\t\t\t\t\"render\":function(data){\r\n\t\t\t\t\t\t\t\t\t\t\treturn getLanguage(parseInt(data));\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\"title\":\"Percentage\",\r\n\t\t\t\t\t\t\t\t\t\t\"width\":'120px',\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\"title\":\"Failed Criteria\",\r\n\t\t\t\t\t\t\t\t\t\t\"width\":'120px',\r\n\t\t\t\t\t\t\t\t\t\t\"render\":function(data){\r\n\t\t\t\t\t\t\t\t\t\t\treturn \"<div><span   class='criteria-failure-codes'>\"+data+\"<\/span><\/div>\"\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\"title\":\"\",\r\n\t\t\t\t\t\t\t\t\t\t\"className\": \"text-left\",\r\n\t\t\t\t\t\t\t\t\t\t\"render\":function(data, type, row, meta){\r\n\t\t\t\t\t\t\t\t\t\t\tvar data=decodeHTML(data);\r\n\t\t\t\t\t\t\t\t\t\t\tvar showChar = 200;\r\n\t\t\t\t\t\t\t\t\t\t\tvar openDet=false;\r\n\t\t\t\t\t\t\t\t\t\t\tvar actualshowChar=data.indexOf(' ', showChar);\r\n\t\t\t\t\t\t\t\t\t\t\tif(actualshowChar!=-1) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tvar frontString = data.substr(0, actualshowChar);\r\n\t\t\t\t\t\t\t\t\t\t\t\tvar backString = data.substr(actualshowChar, data.length);\r\n\t\t\t\t\t\t\t\t\t\t\t\tvar html='<details style=\" font-family: Lato; cursor: pointer;\">'+backString+'<summary style=\" font-family: Lato;\">'+frontString+'<span class=\"elipsisSpan\">...<\/span><\/summary><\/details>';\r\n\t\t\t\t\t\t\t\t\t\t\t\treturn html.toString();\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\t\t\t\t\t\treturn data;\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tfunction getLanguage(localizedData){\r\n\t\t\t\t\t\t\t\t\treturn localizedData.toLocaleString(getNavigatorLanguage) \r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tfunction decodeHTML(encodedHTML){ return $('<div>').html(encodedHTML).text(); }\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tconst details = document.querySelectorAll(\"details\");\r\n\t\t\t\t\t\t\t\tdetails.forEach((targetDetail) => {\r\n\t\t\t\t\t\t\t\t  targetDetail.addEventListener(\"click\", () => {\r\n\t\t\t\t\t\t\t\t\t// Close all the details that are not targetDetail.\r\n\t\t\t\t\t\t\t\t\tdetails.forEach((detail) => {\r\n\t\t\t\t\t\t\t\t\t  if (detail !== targetDetail) {\r\n\t\t\t\t\t\t\t\t\t\tdetail.removeAttribute(\"open\");\r\n\t\t\t\t\t\t\t\t\t  }\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t  });\r\n\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\t});\t\r\n\t\t\t\t\t\t\t\t \r\n\t\t  }\r\n}","name":"failure_ParentTable","vizName":"Custom","type":"Custom","icon":"VF","sql":{"id":1,"type":"sql","text":"select \r\n\tcase when max(sum_by_trial)=0 then 0 else cast(round((sum(number_of_patients)/max(sum_by_trial))*100,0) as int) end as \"bar value\",\r\n \tsum(\"criteria failure responses\".\"number_of_patients\") as \"# of Patients\",\r\n \tcase when max(sum_by_trial)=0 then '0%' else concat(cast(round((sum(number_of_patients)/max(sum_by_trial))*100,0) as text), '%') end as \"Percentage\",\r\n \t\"criteria failure responses\".\"failed_criteria\" as \"Failed Criteria\",\r\n \t\"criteria failure responses\".\"failed_criteria_text\" as \"Failed Criteria text\" \r\nfrom\r\n\t(WITH rawdata AS(\r\nselect * from (\r\nSELECT\r\nT.id as trial_id,T.name as trial_name,\r\nSTPV.id as patient_id,\r\ncriterion_type,\r\ncustom_identifier,\r\ncase when criterion_type='inclusion' then CONCAT('Inc ',custom_identifier) else CONCAT('Exc ',custom_identifier) END AS Criteria,\r\nresponse,\r\nIECQ.question_id,\r\nQ.question_text,\r\nIEC.created_at,\r\nIEC.protocol_name_and_version,\r\nA.created_at AS acreate,\r\nS.country,\r\nstage\r\nFROM \"Answer\" AS A\r\nJOIN \"SiteTrialQuestion\" AS STQ ON A.site_trial_question_id = STQ.id\r\nJOIN \"Question\" AS Q ON Q.id = STQ.question_id\r\nJOIN \"InclusionExclusionCriteriaQuestion\" IECQ ON IECQ.question_id = Q.id\r\nJOIN \"InclusionExclusionCriteria\" IEC ON IECQ.ie_criteria_id = IEC.id\r\nRIGHT JOIN \"SiteTrialPatientView\" AS STPV ON STPV.id = A.site_trial_patient_id\r\nJOIN \"SiteTrialView\" AS STV ON STV.id = STQ.site_trial_id and STV.is_pseudo = false\r\nJOIN \"Trial\" AS T ON T.id = sponsor_trial_id AND T.id = IEC.trial_id AND T.is_pseudo = false\r\nJOIN \"TrialGrant\" TG on TG.trial_id = T.id\r\nJOIN \"Site\" AS S ON S.id = STV.site_id AND S.is_pseudo = false\r\nWhere   \r\nSTV.ie_criteria_checklist_enabled = true\r\nAND stage != 'archive'\r\nAND (('_all_'=${Trials}) or (cast(T.id as text) = ${Trials}))\r\nAND (('_all_' in (${SiteTrials})) or (cast(STPV.site_trial_id as text) in (${SiteTrials})))\r\nAND TG.user_id = 'auth0|5d9234f1bc48890e1d290c57' \r\n) as body\r\nwhere (('All Failures'in (${Failures})) or (cast(stage as text) in (${Failures})))\r\n),\r\nLatestQuestion as (select patient_id,question_id,max(created_at) as created_at\r\nFROM RAWDATA\r\ngroup by patient_id,question_id ),\r\nraw_main as (select r.* from RAWDATA r JOIN LatestQuestion lq on r.patient_id=lq.patient_id and r.question_id = lq.question_id and r.created_at = lq.created_at),\r\nmaxcreation AS (\r\nSELECT raw.trial_name,raw.trial_id,\r\nRANK() OVER(\r\nPARTITION BY raw.trial_name\r\nORDER BY COUNT(raw.Criteria) DESC) AS ranking,\r\nraw.Criteria,\r\nCOUNT(raw.Criteria) AS Number_of_patients,\r\nraw.question_text,\r\nraw.country\r\nFROM raw_main AS raw\r\nINNER JOIN (\r\n  SELECT trial_name, MAX(created_at) AS creation\r\n  FROM raw_main\r\n  GROUP BY trial_name) b ON raw.trial_name = b.trial_name\r\nWHERE\r\nraw.created_at = b.creation \r\nAND (('All Protocols' in (${Protocols})) or (cast(protocol_name_and_version as text) in (${Protocols})))\r\nAND ((response = 'Yes' AND criterion_type = 'exclusion') OR (response = 'No' AND criterion_type = 'inclusion'))\r\nGROUP BY raw.trial_name, raw.trial_id,raw.criteria, raw.question_text,raw.country\r\n)\r\nselect \r\nmc1.trial_id,mc1.trial_name,mc1.ranking,\r\nmc1.number_of_patients,\r\nsum(mc1.number_of_patients) over(partition by trial_id order by trial_id) as sum_by_trial,\r\nsum(mc1.number_of_patients) over(partition by criteria,question_text order by criteria,question_text) as sum_by_site,\r\nmc1.criteria as failed_criteria,\r\nmc1.question_text as failed_criteria_text,\r\nmc1.country\r\nfrom maxcreation as mc1\r\ngroup by mc1.trial_id,mc1.trial_name,mc1.ranking,\r\nmc1.number_of_patients,mc1.criteria,mc1.question_text,country\r\norder by mc1.trial_id)  \"criteria failure responses\" \r\ngroup by\r\n\t\"criteria failure responses\".\"failed_criteria\", \"criteria failure responses\".\"failed_criteria_text\" \r\norder by\r\n\tsum(\"criteria failure responses\".\"number_of_patients\") desc, \"criteria failure responses\".\"failed_criteria\" asc","dataSource":{"id":1,"name":"sponsor"},"parameters":[{"id":1,"openQuote":"","closeQuote":""},{"id":2,"openQuote":"","closeQuote":""},{"id":4,"openQuote":"","closeQuote":""},{"id":5,"openQuote":"","closeQuote":""},{"id":6,"openQuote":"","closeQuote":""}]}},{"id":2,"configure":"var failure_by_site = {\n    name: \"failure_by_site\",\n    type:\"chart\",\n    requestParameters: {'Trials': 'Trials', 'user_name': 'user_name','selected_criteria_code': 'selected_criteria_code','SiteTrials': 'SiteTrials','Protocols': 'Protocols','Failures': 'Failures'},\n    vf : {\n        id: \"2\",\n        file: '__efwvf_name__'\n    },\n    efwd : {\n        file: '__efwd_file_name__'\n    },\n    htmlElementId : \"#failure_by_site\", // provide report id here\n    executeAtStart: true  // it can be true or false\n};\n","visualisation":"if (data.length == 0) {\r\n\t\t\t    $('#chart_2').html(\"<div ><h4 style='font-family:Lato;text-align:CENTER;color:#777d94; padding-top:60px;'>No Data Available For Current Selection<\/h4><\/div>\");\r\n\t\t\t    return;\r\n} else {\r\nvar link = document.createElement(\"link\");\r\n\t\t\t\t  link.rel = \"stylesheet\";\r\n\t\t\t\t  \r\n\t\t\t\t  if(window.DashboardGlobals)\r\n\t\t\t\t\t\tlink.href = window.DashboardGlobals.baseUrl+\"/getExternalResource.html?path=1594625979695/1600153490910/jquery.dataTables.css\";\t\t\t\t\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tlink.href = \"getExternalResource.html?path=1594625979695/1600153490910/jquery.dataTables.css\";\r\n\t\t\t\t  \r\n\t\t\t\t\r\n\t\t\t\t document.getElementsByTagName(\"head\")[0].appendChild(link);\r\n\t\t\t\t var link2 = document.createElement(\"link\");\r\n\t\t\t\t link2.rel = 'stylesheet';\r\n\t\t\t\tif(window.DashboardGlobals)\r\n\t\t\t\tlink2.href = \"https://fonts.googleapis.com/css?family=Lato\";\r\n\t\t\t\telse\r\n\t\t\t\tlink2.href = \"https://fonts.googleapis.com/css?family=Lato\";\r\n\r\n\t\t\t\tdocument.getElementsByTagName(\"head\")[0].appendChild(link2);\r\n\t\t\t\t \r\n\t\t\t\t \r\n\t\t\t\t   var script = document.createElement(\"script\");\r\n\t\t\t\t   scriptLoaded = false;\r\n\t\t\t\t   \r\n\t\t\t\t\tif(window.DashboardGlobals)\r\n\t\t\t\t\t\tscript.src = window.DashboardGlobals.baseUrl+\"/getExternalResource.html?path=1594625979695/1600153490910/jquery.dataTables.min.js\";\t\t\t\t\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tscript.src = \"getExternalResource.html?path=1594625979695/1600153490910/jquery.dataTables.min.js\";\r\n\t\t\t\t \r\n\t\t\t\t script.async = false;\r\n\t\t\t\t document.getElementsByTagName(\"head\")[0].appendChild(script);\r\n\r\n                                var column_index=[];\r\n\t\t\t\t\t\t\t\tvar flag;\r\n\t\t\t\t\t\t\t\tfunction tabulate(elem, data, columns) {\t\r\n\t\t\t\t\t\t\t\tvar table = d3.select(elem).append(\"table\")\t\r\n\t\t\t\t\t\t\t\t.attr(\"class\",\" table display compact width:100%;cellspacing:1 \")\r\n\t\t\t\t\t\t\t\t.attr(\"id\",\"table_child\")\r\n\t\t\t\t\t\t\t\tthead = table.append(\"thead\"),\r\n\t\t\t\t\t\t\t\ttbody = table.append(\"tbody\");\r\n\r\n\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t// append the header row\r\n\t\t\t\t\t\t\t\tthead.append(\"tr\")\r\n\t\t\t\t\t\t\t\t.selectAll(\"th\")\r\n\t\t\t\t\t\t\t\t.data(columns)\r\n\t\t\t\t\t\t\t\t.enter()\r\n\t\t\t\t\t\t\t\t.append(\"th\")\r\n\t\t\t\t\t\t\t\t.text(function(column) { return column; })\r\n\t\t\t\t\t\t\t\t.attr('class', function(d, i){ return \"colH_\" + i; })\r\n\t\t\t\t\t\t\t\t.style('background-color','#f6f6f6')\r\n\t\t\t\t\t\t\t\t//.style('font-size','13px')\r\n\t\t\t\t\t\t\t\t.style('font-weight', 'normal')\r\n\t\t\t\t\t\t\t\t.style('font-family', 'Lato')\r\n\t\t\t\t\t\t\t\t.style('color','#777d94')\r\n\t\t\t\t\t\t\t\t//.style('border-left','1px solid #d2cfcf75')\r\n\t\t\t\t\t\t\t\t.style('text-align','left')\r\n\t\t\t\t\t\t\t\t//.style('padding-bottom','10px')\r\n\t\t\t\t\t\t\t\t//.style('@media print','display:none')\r\n\t\t\t\t\t\t\t\t//.style('padding-left','25px')\r\n\t\t\t\t\t\t\t\t.style('min-width','10rem')\r\n\t\t\t\t\t\t\t\t.style('padding','1rem');\r\n\t\t\t\t\t\t\t\t\r\n\r\n\r\n\t\t\t\t\t\t\t\t// create a row for each object in the data\r\n\t\t\t\t\t\t\t\tvar rows = tbody.selectAll(\"tr\")\r\n\t\t\t\t\t\t\t\t.data(data)\r\n\t\t\t\t\t\t\t\t.enter()\r\n\t\t\t\t\t\t\t\t.append(\"tr\");\r\n\r\n\t\t\t\t\t\t\t\t// create a cell in each row for each column\r\n\t\t\t\t\t\t\t\tvar cells = rows.selectAll(\"td\")\r\n\t\t\t\t\t\t\t\t.data(function(row) {\r\n\t\t\t\t\t\t\t\treturn columns.map(function(column) {\r\n\t\t\t\t\t\t\t\treturn {column: column, value: row[column]};\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t.enter()\r\n\t\t\t\t\t\t\t\t.append(\"td\")\r\n\t\t\t\t\t\t\t\t.text(function(d) { return d.value; })\r\n\t\t\t\t\t\t\t\t.attr('class', function(d, i){ return \"col_\" + i; })\r\n\t\t\t\t\t\t\t\t//.attr('align', 'center')\r\n\t\t\t\t\t\t\t\t.style('color','#777d94')\r\n\t\t\t\t\t\t\t\t//.style('font-size','13px')\r\n\t\t\t\t\t\t\t\t.style('font-weight', 'normal')\r\n\t\t\t\t\t\t\t\t.style('font-family', 'Lato')\r\n\t\t\t\t\t\t\t\t.style('vertical-align', 'middle')\r\n\t\t\t\t\t\t\t\t.style('padding', '1.5rem')\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\treturn table;\r\n\t\t\t\t\t\t\t\t}\t\r\n\r\n\t\t\t\t\t\t\t\t// render the table\r\n\t\t\t\t\t\t\t\tvar subjectTable = tabulate( '#chart_2', data, Object.keys(data[0]));\t\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t  script.onload = function(){\r\n\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tvar firstrecord=true;\r\n\t\t\t\t\t\t\t\tvar firstValue = 0;\r\n\t\t\t\t\t\t\t\tvar localizedData=0;\r\n\t\t\t\t\t\t\t\t//const getNavigatorLanguage='en-US';\r\n\t\t\t\t\t\t\t\tconst getNavigatorLanguage = (navigator.languages && navigator.languages.length) ? navigator.languages[0] : navigator.userLanguage || navigator.language || navigator.browserLanguage || 'en-US';\r\n\t\t\t\t\t\t\t\tconst urlString = window.location.search;\r\n\t\t\t\t\t\t\t\tconst urlParams = new URLSearchParams(urlString);\r\n\t\t\t\t\t\t\t\tif(urlParams.has('pageLength'))\r\n\t\t\t\t\t\t\t\tvar pageLength=parseInt(urlParams.get('pageLength'));\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\tvar pageLength=50;\r\n\t\t\t\t\t\t\t\tconsole.log(\"Data Length: \",data.length);\r\n\t\t\t\t\t\t\t\tif(data.length > pageLength)\r\n\t\t\t\t\t\t\t\tvar paging=true\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\tvar paging=false\r\n\t\t\t\t\t\t\t\t$(document).ready(function() {\r\n\t\t\t\t\t\t\t\tconsole.log(\"Inside Ready: \");\r\n\t\t\t\t\t\t\t\tvar table_by_store = $('#table_child').DataTable({\r\n\t\t\t\t\t\t\t\t\t//\"deferRender\": true,\r\n\t\t\t\t\t\t\t\t\t\"pageLength\": pageLength,\r\n\t\t\t\t\t\t\t\t\t\"lengthChange\": false,\r\n\t\t\t\t\t\t\t\t\t//\"pagingType\": \"full_numbers\",\r\n\t\t\t\t\t\t\t\t\t//\"lengthMenu\": [[25, 10, 25, 50, -1], [10, 10, 25, 50, \"All\"]],\r\n\t\t\t\t\t\t\t\t\t\"paging\": paging,\r\n\t\t\t\t\t\t\t\t\t\"jQueryUI\": true,\r\n\t\t\t\t\t\t\t\t\t\"ordering\": false,\r\n\t\t\t\t\t\t\t\t\t\"info\": true,\r\n\t\t\t\t\t\t\t\t\t\"bFilter\": false,\r\n\t\t\t\t\t\t\t\t\tautoWidth: false,\r\n\t\t\t\t\t\t\t\t\t\"columns\": [\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\"title\":\"\",\r\n\t\t\t\t\t\t\t\t\t\t\"sortable\":false,\r\n\t\t\t\t\t\t\t\t\t\t\"width\":'96px',\r\n\t\t\t\t\t\t\t\t\t\t\"render\": function(data, type, row, meta){\r\n\t\t\t\t\t\t\t\t\t\t\tfor(var i = 0; i < Object.keys(data).length; i++){\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\tif(firstrecord){\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tfirstValue = Math.round((120/data + Number.EPSILON)*100)/100;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tfirstrecord=false;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn $(\"<div class='bar-chart-bar'><\/div>\", {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}).css({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"width\": '120px',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"background-color\": '#85000b'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}).prop(\"outerHTML\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvar remainValues = Math.round((firstValue*data + Number.EPSILON)*100)/100;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvar backColor='#fef8f9';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    if(remainValues>90){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#85000b';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>80&&remainValues<=90){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#d2202f';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>70&&remainValues<=80){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#df5f6a';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>60&&remainValues<=70){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#e6838b';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>50&&remainValues<=60){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#ec9ea5';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>40&&remainValues<=50){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#f0b5ba';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>30&&remainValues<=40){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#f4c8cc';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>20&&remainValues<=30){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#f8dadc';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>10&&remainValues<=20){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#fbe9eb';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues=>0&&remainValues<=10){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#fef8f9';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn $(\"<div class='bar-chart-bar'><\/div>\", {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}).css({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"width\": remainValues+'px',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"background-color\": backColor\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}).prop(\"outerHTML\")\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\"type\": \"html\",\r\n\t\t\t\t\t\t\t\t\t\t\"title\":\"\",\r\n\t\t\t\t\t\t\t\t\t\t\"width\":'120px',\r\n\t\t\t\t\t\t\t\t\t\t\"render\":function(data){\r\n\t\t\t\t\t\t\t\t\t\t\treturn getLanguage(parseInt(data));\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\"title\":\"\",\r\n\t\t\t\t\t\t\t\t\t\t\"width\":'120px',\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\"className\": \"text-left\"\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tfunction getLanguage(localizedData){\r\n\t\t\t\t\t\t\t\t\treturn localizedData.toLocaleString(getNavigatorLanguage) \r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tfunction decodeHTML(encodedHTML){ return $('<div>').html(encodedHTML).text(); }\r\n\r\n\r\n\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t});\t\r\n\t\t\t\t\t\t\t\t \r\n\t\t  }\r\n}","name":"failure_by_site","vizName":"Custom","type":"Custom","icon":"VF","sql":{"id":4,"type":"sql","text":"select \r\n\tcase when max(sum_by_site)=0 then 0 else cast(round((sum(number_of_patients)/max(sum_by_site))*100,0) as int) end as \"bar value\",\r\n \tsum(\"criteria failure responses\".\"number_of_patients\") as \"# of Patients\",\r\n \tcase when max(sum_by_site)=0 then '0%' else concat(cast(round((sum(number_of_patients)/max(sum_by_site))*100,0) as text), '%') end as \"Percentage\",\r\n \t\"criteria failure responses\".\"site_name\" as \"Site\" \r\nfrom\r\n\t(WITH rawdata AS(\r\nselect * from (\r\nSELECT\r\nT.id as trial_id,T.name as trial_name\r\n,S.id as site_id,S.name as site_name,\r\nSTPV.id as patient_id,\r\ncriterion_type,\r\ncustom_identifier,\r\ncase when criterion_type='inclusion' then CONCAT('Inc ',custom_identifier) else CONCAT('Exc ',custom_identifier) END AS Criteria,\r\nresponse,\r\nIECQ.question_id,\r\nQ.question_text,\r\nIEC.created_at,\r\nIEC.protocol_name_and_version,\r\nA.created_at AS acreate,\r\nS.country,\r\nstage\r\nFROM \"Answer\" AS A\r\nJOIN \"SiteTrialQuestion\" AS STQ ON A.site_trial_question_id = STQ.id\r\nJOIN \"Question\" AS Q ON Q.id = STQ.question_id\r\nJOIN \"InclusionExclusionCriteriaQuestion\" IECQ ON IECQ.question_id = Q.id\r\nJOIN \"InclusionExclusionCriteria\" IEC ON IECQ.ie_criteria_id = IEC.id\r\nRIGHT JOIN \"SiteTrialPatientView\" AS STPV ON STPV.id = A.site_trial_patient_id\r\nJOIN \"SiteTrialView\" AS STV ON STV.id = STQ.site_trial_id and STV.is_pseudo = false\r\nJOIN \"Trial\" AS T ON T.id = sponsor_trial_id AND T.id = IEC.trial_id AND T.is_pseudo = false\r\nJOIN \"TrialGrant\" TG on TG.trial_id = T.id\r\nJOIN \"Site\" AS S ON S.id = STV.site_id AND S.is_pseudo = false\r\nWhere   \r\nSTV.ie_criteria_checklist_enabled = true\r\nAND stage != 'archive'\r\nAND (('_all_'=${Trials}) or (cast(T.id as text) = ${Trials}))\r\nAND (('_all_' in (${SiteTrials})) or (cast(STPV.site_trial_id as text) in (${SiteTrials})))\r\nAND TG.user_id = 'auth0|5d9234f1bc48890e1d290c57') as body\r\nwhere (('All Failures'in (${Failures})) or (cast(stage as text) in (${Failures})))\r\n),\r\nLatestQuestion as (select patient_id,question_id,max(created_at) as created_at\r\nFROM RAWDATA\r\ngroup by patient_id,question_id ),\r\nraw_main as (select r.* from RAWDATA r JOIN LatestQuestion lq on r.patient_id=lq.patient_id and r.question_id = lq.question_id and r.created_at = lq.created_at),\r\nmaxcreation AS (\r\nSELECT raw.trial_name,raw.trial_id, raw.site_name,raw.site_id,\r\nRANK() OVER(\r\nPARTITION BY raw.trial_name,raw.site_name\r\nORDER BY COUNT(raw.Criteria) DESC) AS ranking,\r\nraw.Criteria,\r\nCOUNT(raw.Criteria) AS Number_of_patients,\r\nraw.question_text,\r\nraw.country\r\nFROM raw_main AS raw\r\nINNER JOIN (\r\n  SELECT trial_name,site_name, MAX(created_at) AS creation\r\n  FROM raw_main\r\n  GROUP BY trial_name,site_name) b ON raw.trial_name = b.trial_name and raw.site_name = b.site_name\r\nWHERE \r\nraw.criteria=${selected_criteria_code}\r\nAND (('All Protocols' in (${Protocols})) or (cast(protocol_name_and_version as text) in (${Protocols})))\r\nAND raw.created_at = b.creation\r\nAND ((response = 'Yes' AND criterion_type = 'exclusion') OR (response = 'No' AND criterion_type = 'inclusion'))\r\nGROUP BY raw.trial_name, raw.trial_id,raw.site_name, raw.site_id, raw.criteria, raw.question_text,raw.country\r\n)\r\nselect \r\nmc1.site_id,mc1.site_name,mc1.trial_id,mc1.trial_name,mc1.ranking,\r\nmc1.number_of_patients,\r\nsum(mc1.number_of_patients) over(partition by trial_id order by trial_id) as sum_by_trial,\r\nsum(mc1.number_of_patients) over(partition by criteria,question_text order by criteria,question_text) as sum_by_site,\r\nmc1.criteria as failed_criteria,\r\nmc1.question_text as failed_criteria_text,\r\nmc1.country\r\nfrom maxcreation as mc1\r\ngroup by mc1.site_id,mc1.site_name,mc1.trial_id,mc1.trial_name,mc1.ranking,\r\nmc1.number_of_patients,mc1.criteria,mc1.question_text,country\r\norder by mc1.site_id,mc1.trial_id)  \"criteria failure responses\" \r\ngroup by\r\n\t\"criteria failure responses\".\"site_name\" \r\norder by\r\n\tsum(\"criteria failure responses\".\"number_of_patients\") desc, \"criteria failure responses\".\"site_name\" asc","dataSource":{"id":1,"name":"sponsor"},"parameters":[{"id":1,"openQuote":"","closeQuote":""},{"id":2,"openQuote":"","closeQuote":""},{"id":3,"openQuote":"","closeQuote":""},{"id":4,"openQuote":"","closeQuote":""},{"id":5,"openQuote":"","closeQuote":""},{"id":6,"openQuote":"","closeQuote":""}]}},{"id":3,"configure":"var failure_by_country = {\n    name: \"failure_by_country\",\n    type:\"chart\",\n    requestParameters: { 'Trials': 'Trials', 'user_name': 'user_name','selected_criteria_code': 'selected_criteria_code','SiteTrials': 'SiteTrials','Protocols': 'Protocols','Failures': 'Failures'},\n    vf : {\n        id: \"3\",\n        file: '__efwvf_name__'\n    },\n    efwd : {\n        file: '__efwd_file_name__'\n    },\n    htmlElementId : \"#failure_by_country\", // provide report id here\n    executeAtStart: true  // it can be true or false\n};\n","visualisation":"if (data.length == 0) {\r\n\t\t\t    $('#chart_3').html(\"<div ><h4 style='font-family:Lato;text-align:CENTER;color:#777d94; padding-top:60px;'>No Data Available For Current Selection<\/h4><\/div>\");\r\n\t\t\t    return;\r\n} else {\r\nvar link = document.createElement(\"link\");\r\n\t\t\t\t  link.rel = \"stylesheet\";\r\n\t\t\t\t  \r\n\t\t\t\t  if(window.DashboardGlobals)\r\n\t\t\t\t\t\tlink.href = window.DashboardGlobals.baseUrl+\"/getExternalResource.html?path=1594625979695/1600153490910/jquery.dataTables.css\";\t\t\t\t\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tlink.href = \"getExternalResource.html?path=1594625979695/1600153490910/jquery.dataTables.css\";\r\n\t\t\t\t  \r\n\t\t\t\t\r\n\t\t\t\t document.getElementsByTagName(\"head\")[0].appendChild(link);\r\n\t\t\t\t var link2 = document.createElement(\"link\");\r\n\t\t\t\t link2.rel = 'stylesheet';\r\n\t\t\t\tif(window.DashboardGlobals)\r\n\t\t\t\tlink2.href = \"https://fonts.googleapis.com/css?family=Lato\";\r\n\t\t\t\telse\r\n\t\t\t\tlink2.href = \"https://fonts.googleapis.com/css?family=Lato\";\r\n\r\n\t\t\t\tdocument.getElementsByTagName(\"head\")[0].appendChild(link2);\r\n\t\t\t\t \r\n\t\t\t\t \r\n\t\t\t\t   var script = document.createElement(\"script\");\r\n\t\t\t\t   scriptLoaded = false;\r\n\t\t\t\t   \r\n\t\t\t\t\tif(window.DashboardGlobals)\r\n\t\t\t\t\t\tscript.src = window.DashboardGlobals.baseUrl+\"/getExternalResource.html?path=1594625979695/1600153490910/jquery.dataTables.min.js\";\t\t\t\t\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tscript.src = \"getExternalResource.html?path=1594625979695/1600153490910/jquery.dataTables.min.js\";\r\n\t\t\t\t \r\n\t\t\t\t script.async = false;\r\n\t\t\t\t document.getElementsByTagName(\"head\")[0].appendChild(script);\r\n\r\n                                var column_index=[];\r\n\t\t\t\t\t\t\t\tvar flag;\r\n\t\t\t\t\t\t\t\tfunction tabulate(elem, data, columns) {\t\r\n\t\t\t\t\t\t\t\tvar table = d3.select(elem).append(\"table\")\t\r\n\t\t\t\t\t\t\t\t.attr(\"class\",\" table display compact width:100%;cellspacing:1 \")\r\n\t\t\t\t\t\t\t\t.attr(\"id\",\"table_child2\")\r\n\t\t\t\t\t\t\t\tthead = table.append(\"thead\"),\r\n\t\t\t\t\t\t\t\ttbody = table.append(\"tbody\");\r\n\r\n\r\n\t\t\t\t\t\t\t\t// append the header row\r\n\t\t\t\t\t\t\t\tthead.append(\"tr\")\r\n\t\t\t\t\t\t\t\t.selectAll(\"th\")\r\n\t\t\t\t\t\t\t\t.data(columns)\r\n\t\t\t\t\t\t\t\t.enter()\r\n\t\t\t\t\t\t\t\t.append(\"th\")\r\n\t\t\t\t\t\t\t\t.text(function(column) { return column; })\r\n\t\t\t\t\t\t\t\t.attr('class', function(d, i){ return \"colH_\" + i; })\r\n\t\t\t\t\t\t\t\t.style('background-color','#f6f6f6')\r\n\t\t\t\t\t\t\t\t//.style('font-size','13px')\r\n\t\t\t\t\t\t\t\t.style('font-weight', 'normal')\r\n\t\t\t\t\t\t\t\t.style('font-family', 'Lato')\r\n\t\t\t\t\t\t\t\t.style('color','#777d94')\r\n\t\t\t\t\t\t\t\t//.style('border-left','1px solid #d2cfcf75')\r\n\t\t\t\t\t\t\t\t.style('text-align','left')\r\n\t\t\t\t\t\t\t\t//.style('padding-bottom','10px')\r\n\t\t\t\t\t\t\t\t//.style('@media print','display:none')\r\n\t\t\t\t\t\t\t\t//.style('padding-left','25px')\r\n\t\t\t\t\t\t\t\t.style('min-width','10rem')\r\n\t\t\t\t\t\t\t\t.style('padding','1rem')\r\n\r\n\r\n\t\t\t\t\t\t\t\t// create a row for each object in the data\r\n\t\t\t\t\t\t\t\tvar rows = tbody.selectAll(\"tr\")\r\n\t\t\t\t\t\t\t\t.data(data)\r\n\t\t\t\t\t\t\t\t.enter()\r\n\t\t\t\t\t\t\t\t.append(\"tr\");\r\n\r\n\t\t\t\t\t\t\t\t// create a cell in each row for each column\r\n\t\t\t\t\t\t\t\tvar cells = rows.selectAll(\"td\")\r\n\t\t\t\t\t\t\t\t.data(function(row) {\r\n\t\t\t\t\t\t\t\treturn columns.map(function(column) {\r\n\t\t\t\t\t\t\t\treturn {column: column, value: row[column]};\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t.enter()\r\n\t\t\t\t\t\t\t\t.append(\"td\")\r\n\t\t\t\t\t\t\t\t.text(function(d) { return d.value; })\r\n\t\t\t\t\t\t\t\t.attr('class', function(d, i){ return \"col_\" + i; })\r\n\t\t\t\t\t\t\t\t//.attr('align', 'center')\r\n\t\t\t\t\t\t\t\t.style('color','#777d94')\r\n\t\t\t\t\t\t\t\t//.style('font-size','13px')\r\n\t\t\t\t\t\t\t\t.style('font-weight', 'normal')\r\n\t\t\t\t\t\t\t\t.style('font-family', 'Lato')\r\n\t\t\t\t\t\t\t\t.style('vertical-align', 'middle')\r\n\t\t\t\t\t\t\t\t.style('padding', '1.5rem')\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\treturn table;\r\n\t\t\t\t\t\t\t\t}\t\r\n\r\n\t\t\t\t\t\t\t\t// render the table\r\n\t\t\t\t\t\t\t\tvar subjectTable = tabulate( '#chart_3', data, Object.keys(data[0]));\t\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t  script.onload = function(){\r\n\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tvar firstrecord=true;\r\n\t\t\t\t\t\t\t\tvar firstValue = 0;\r\n\t\t\t\t\t\t\t\tvar localizedData=0;\r\n\t\t\t\t\t\t\t\t//const getNavigatorLanguage='en-US';\r\n\t\t\t\t\t\t\t\tconst getNavigatorLanguage = (navigator.languages && navigator.languages.length) ? navigator.languages[0] : navigator.userLanguage || navigator.language || navigator.browserLanguage || 'en-US';\r\n\t\t\t\t\t\t\t\tconst urlString = window.location.search;\r\n\t\t\t\t\t\t\t\tconst urlParams = new URLSearchParams(urlString);\r\n\t\t\t\t\t\t\t\tif(urlParams.has('pageLength'))\r\n\t\t\t\t\t\t\t\tvar pageLength=parseInt(urlParams.get('pageLength'));\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\tvar pageLength=50;\r\n\t\t\t\t\t\t\t\tif(data.length > pageLength)\r\n\t\t\t\t\t\t\t\tvar paging=true\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\tvar paging=false\r\n\t\t\t\t\t\t\t\t$(document).ready(function() {\r\n\t\t\t\t\t\t\t\tconsole.log(\"Inside Ready: \");\r\n\t\t\t\t\t\t\t\tvar table_by_store = $('#table_child2').DataTable({\r\n\t\t\t\t\t\t\t\t\t//\"deferRender\": true,\r\n\t\t\t\t\t\t\t\t\t\"pageLength\": pageLength,\r\n\t\t\t\t\t\t\t\t\t\"lengthChange\": false,\r\n\t\t\t\t\t\t\t\t\t//\"pagingType\": \"full_numbers\",\r\n\t\t\t\t\t\t\t\t\t//\"lengthMenu\": [[25, 10, 25, 50, -1], [10, 10, 25, 50, \"All\"]],\r\n\t\t\t\t\t\t\t\t\t\"paging\": paging,\r\n\t\t\t\t\t\t\t\t\t\"jQueryUI\": true,\r\n\t\t\t\t\t\t\t\t\t\"ordering\": false,\r\n\t\t\t\t\t\t\t\t\t\"info\": true,\r\n\t\t\t\t\t\t\t\t\t\"bFilter\": false,\r\n\t\t\t\t\t\t\t\t\tautoWidth: false,\r\n\t\t\t\t\t\t\t\t\t\"columns\": [\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\"title\":\"\",\r\n\t\t\t\t\t\t\t\t\t\t\"sortable\":false,\r\n\t\t\t\t\t\t\t\t\t\t\"width\":'96px',\r\n\t\t\t\t\t\t\t\t\t\t\"render\": function(data, type, row, meta){\r\n\t\t\t\t\t\t\t\t\t\t\tfor(var i = 0; i < Object.keys(data).length; i++){\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\tif(firstrecord){\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tfirstValue = Math.round((120/data + Number.EPSILON)*100)/100;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tfirstrecord=false;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn $(\"<div class='bar-chart-bar'><\/div>\", {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}).css({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"width\": '120px',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"background-color\": '#85000b'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}).prop(\"outerHTML\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvar remainValues = Math.round((firstValue*data + Number.EPSILON)*100)/100;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvar backColor='#fef8f9';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    if(remainValues>90){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#85000b';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>80&&remainValues<=90){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#d2202f';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>70&&remainValues<=80){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#df5f6a';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>60&&remainValues<=70){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#e6838b';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>50&&remainValues<=60){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#ec9ea5';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>40&&remainValues<=50){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#f0b5ba';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>30&&remainValues<=40){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#f4c8cc';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>20&&remainValues<=30){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#f8dadc';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>10&&remainValues<=20){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#fbe9eb';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues=>0&&remainValues<=10){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#fef8f9';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn $(\"<div class='bar-chart-bar'><\/div>\", {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}).css({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"width\": remainValues+'px',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"background-color\": backColor\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}).prop(\"outerHTML\")\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\"type\": \"html\",\r\n\t\t\t\t\t\t\t\t\t\t\"title\":\"\",\r\n\t\t\t\t\t\t\t\t\t\t\"width\":'120px',\r\n\t\t\t\t\t\t\t\t\t\t\"render\":function(data){\r\n\t\t\t\t\t\t\t\t\t\t\treturn getLanguage(parseInt(data));\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\"title\":\"\",\r\n\t\t\t\t\t\t\t\t\t\t\"width\":'120px',\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\"className\": \"text-left\"\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tfunction getLanguage(localizedData){\r\n\t\t\t\t\t\t\t\t\treturn localizedData.toLocaleString(getNavigatorLanguage) \r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tfunction decodeHTML(encodedHTML){ return $('<div>').html(encodedHTML).text(); }\r\n\r\n\r\n\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t});\t\r\n\t\t\t\t\t\t\t\t \r\n\t\t  }\r\n}","name":"failure_by_country","vizName":"Custom","type":"Custom","icon":"VF","sql":{"id":5,"type":"sql","text":"select \r\n\tcase when max(sum_by_site)=0 then 0 else  cast(round((sum(number_of_patients)/max(sum_by_site))*100,0) as int) end as \"bar value\",\r\n \tsum(\"criteria failure responses\".\"number_of_patients\") as \"# of Patients\",\r\n \tcase when max(sum_by_site)=0 then '0%' else  concat(cast(round((sum(number_of_patients)/max(sum_by_site))*100,0) as text), '%') end as \"Percentage\",\r\n \t\"criteria failure responses\".\"country\" as \"Country\" \r\nfrom\r\n\t(WITH rawdata AS(\r\nselect * from (\r\nSELECT\r\nT.id as trial_id,T.name as trial_name\r\n,S.id as site_id,S.name as site_name,\r\nSTPV.id as patient_id,\r\ncriterion_type,\r\ncustom_identifier,\r\ncase when criterion_type='inclusion' then CONCAT('Inc ',custom_identifier) else CONCAT('Exc ',custom_identifier) END AS Criteria,\r\nresponse,\r\nIECQ.question_id,\r\nQ.question_text,\r\nIEC.created_at,\r\nIEC.protocol_name_and_version,\r\nA.created_at AS acreate,\r\nS.country,\r\nstage\r\nFROM \"Answer\" AS A\r\nJOIN \"SiteTrialQuestion\" AS STQ ON A.site_trial_question_id = STQ.id\r\nJOIN \"Question\" AS Q ON Q.id = STQ.question_id\r\nJOIN \"InclusionExclusionCriteriaQuestion\" IECQ ON IECQ.question_id = Q.id\r\nJOIN \"InclusionExclusionCriteria\" IEC ON IECQ.ie_criteria_id = IEC.id\r\nRIGHT JOIN \"SiteTrialPatientView\" AS STPV ON STPV.id = A.site_trial_patient_id\r\nJOIN \"SiteTrialView\" AS STV ON STV.id = STQ.site_trial_id and STV.is_pseudo = false\r\nJOIN \"Trial\" AS T ON T.id = sponsor_trial_id AND T.id = IEC.trial_id AND T.is_pseudo = false\r\nJOIN \"TrialGrant\" TG on TG.trial_id = T.id\r\nJOIN \"Site\" AS S ON S.id = STV.site_id AND S.is_pseudo = false\r\nWhere   \r\nSTV.ie_criteria_checklist_enabled = true\r\nAND stage != 'archive'\r\nAND (('_all_'=${Trials}) or (cast(T.id as text) = ${Trials}))\r\nAND (('_all_' in (${SiteTrials})) or (cast(STPV.site_trial_id as text) in (${SiteTrials})))\r\nAND TG.user_id = 'auth0|5d9234f1bc48890e1d290c57') as body\r\nwhere (('All Failures'in (${Failures})) or (cast(stage as text) in (${Failures})))\r\n),\r\nLatestQuestion as (select patient_id,question_id,max(created_at) as created_at\r\nFROM RAWDATA\r\ngroup by patient_id,question_id ),\r\nraw_main as (select r.* from RAWDATA r JOIN LatestQuestion lq on r.patient_id=lq.patient_id and r.question_id = lq.question_id and r.created_at = lq.created_at),\r\nmaxcreation AS (\r\nSELECT raw.trial_name,raw.trial_id, raw.site_name,raw.site_id,\r\nRANK() OVER(\r\nPARTITION BY raw.trial_name,raw.site_name\r\nORDER BY COUNT(raw.Criteria) DESC) AS ranking,\r\nraw.Criteria,\r\nCOUNT(raw.Criteria) AS Number_of_patients,\r\nraw.question_text,\r\nraw.country\r\nFROM raw_main AS raw\r\nINNER JOIN (\r\n  SELECT trial_name,site_name, MAX(created_at) AS creation\r\n  FROM raw_main\r\n  GROUP BY trial_name,site_name) b ON raw.trial_name = b.trial_name and raw.site_name = b.site_name\r\nWHERE \r\nraw.criteria=${selected_criteria_code}\r\nAND (('All Protocols' in (${Protocols})) or (cast(protocol_name_and_version as text) in (${Protocols})))\r\nAND raw.created_at = b.creation\r\nAND ((response = 'Yes' AND criterion_type = 'exclusion') OR (response = 'No' AND criterion_type = 'inclusion'))\r\nGROUP BY raw.trial_name, raw.trial_id,raw.site_name, raw.site_id, raw.criteria, raw.question_text,raw.country\r\n)\r\nselect \r\nmc1.site_id,mc1.site_name,mc1.trial_id,mc1.trial_name,mc1.ranking,\r\nmc1.number_of_patients,\r\nsum(mc1.number_of_patients) over(partition by trial_id order by trial_id) as sum_by_trial,\r\nsum(mc1.number_of_patients) over(partition by criteria,question_text order by criteria,question_text) as sum_by_site,\r\nmc1.criteria as failed_criteria,\r\nmc1.question_text as failed_criteria_text,\r\nmc1.country\r\nfrom maxcreation as mc1\r\ngroup by mc1.site_id,mc1.site_name,mc1.trial_id,mc1.trial_name,mc1.ranking,\r\nmc1.number_of_patients,mc1.criteria,mc1.question_text,country\r\norder by mc1.site_id,mc1.trial_id)  \"criteria failure responses\" \r\ngroup by\r\n\t\"criteria failure responses\".\"country\" \r\norder by\r\n\tsum(\"criteria failure responses\".\"number_of_patients\") desc, \"criteria failure responses\".\"country\" asc","dataSource":{"id":1,"name":"sponsor"},"parameters":[{"id":1,"openQuote":"","closeQuote":""},{"id":2,"openQuote":"","closeQuote":""},{"id":3,"openQuote":"","closeQuote":""},{"id":4,"openQuote":"","closeQuote":""},{"id":5,"openQuote":"","closeQuote":""},{"id":6,"openQuote":"","closeQuote":""}]}},{"id":4,"configure":"var customScript = {\n    name: \"customScript\",\n    type:\"custom\",\n    listeners:[\"Protocols\",\"Failures\"],\n    requestParameters :{},\n    efwd : {\n        id: \"19\",\n        file: '__efwd_file_name__'\n    },\n    htmlElementId : \"#dummy\", // provide report id here\n    executeAtStart: false,  // it can be true or false\n    customScript: function() {\n    \n        console.log(\"customScript Triggered\");\n        \n        if(dashboard.getVariable('Protocols').length === 0){\n            console.log(\"Selected Protocols length is Zero !!! \");\n            dashboard.setVariable('Protocols',[\"All Protocols\"]);\n        }\n        if(dashboard.getVariable('Failures').length === 0){\n            console.log(\"Selected Failures length is Zero !!! \");\n            dashboard.setVariable('Failures',[\"All Failures\"]);\n        }\n        dashboard.updateComponent('failure_ParentTable');\n    }\n};\n\nvar tr = null;\nvar row = null;\n$(document).on('click', '.criteria-failure-codes', function (e) {\n    if(tr != null){\n        tr.css('background-color', 'transparent');\n    }\n\t\ttr = $(this).closest('tr');\n\t\ttr.css('background-color', 'whitesmoke');\n        const allRows = document.querySelectorAll(\"#table tr\");\n        allRows.forEach((searchTargetRow) => {\n            var row_in = table.row(searchTargetRow);\n            if (row_in.child && row_in.child.isShown() ) {\n\t\t\trow_in.child.hide();\n\t\t\t//row_in.removeClass('shown');\n\t\t    }\n        });\n        \n\t\trow = table.row(tr);\n\t\tvar rowData = row.data();\n\t\tconsole.log(\"selected code:\",rowData[3]);\n\t\tdashboard.setVariable('selected_criteria_code',rowData[3]);\n\t\tif ( row.child.isShown() ) {\n\t\t\t\n\t\t\trow.child.hide();\n\t\t\ttr.removeClass('shown');\n\t\t}\n\t\telse {\t    \n\t\t\ttr.addClass('shown');\n\t\t\trow.child(createDiv()).show();\n\t\t\t$('td', row.child()).css({'background-color': '#e5e7eb'});\n\t\t\tdashboard.removeComponent([failure_by_site]);\n\t\t\tdashboard.addComponent([failure_by_site]);\n\t\t\tdashboard.removeComponent([failure_by_country]);\n\t\t\tdashboard.addComponent([failure_by_country]);\n\t\t\t$('#failure_by_country')[0].hidden=true;\n\t\t\t$('#bySiteButton')[0].style.borderBottom='3px solid #6dadf1';\n\t\t    var child_table_cont= document.querySelectorAll('#table_child thead tr th')[0];\n\t\t    console.log(\"child Tab:\", child_table_cont);\n\t\t}\n});\nfunction createDiv() {\n     //var html ='<button onclick=\"byCountryClicked()\" id=\"byCountryButton\">By Country<\/button><button onclick=\"bySiteClicked()\" id=\"bySiteButton\">By Site<\/button><button onclick=\"closeClicked()\" id=\"closeButton\">Close<\/button><div id=\"failure_by_site\"><\/div>'+'<div id=\"failure_by_country\"><\/div>';\n     var html=\"<div id='nested_tables'>\" \n                +\"<div id='table_for_header'>\"\n                 +\"<table style='width: 100%;'><thead><tr>\"\n                  +\"<th class='colH_0' style='width:126px;padding-top: 0px;padding-bottom: 0px;vertical-align: bottom'>\"\n                  +\"<button onclick='byCountryClicked()' id='byCountryButton'>By Country<\/button>\"\n                  +\"<button onclick='bySiteClicked()' id='bySiteButton'>By Site<\/button><\/th>\"\n                  +\"<th class='colH_1' style='width:115px'><\/th>\"\n                  +\"<th class='colH_2' style='width:115px'><\/th>\"\n                  +\"<th class='colH_3' style='min-width:10rem'><span id='site_or_country' style='font-family: Lato'>Site<\/span>\"\n                  +\"<button onclick='closeClicked()' id='closeButton'>Close<\/button><\/th>\"\n                 +\"<\/tr><\/thead><\/table>\"\n                +\"<\/div>\"\n               +\"<div id='failure_by_site'><\/div>\"\n               +\"<div id='failure_by_country'><\/div><\/div>\";\n    return html ;\n}\nfunction bySiteClicked() {\n$('#site_or_country').text('Site');\n$('#failure_by_country')[0].hidden=true;\n$('#failure_by_site')[0].hidden=false;\n$('#bySiteButton')[0].style.borderBottom='3px solid #6dadf1';\n$('#byCountryButton')[0].style.borderBottom='none';\n}\nfunction byCountryClicked() {\n$('#site_or_country').text('Country');\n$('#failure_by_country')[0].hidden=false;\n$('#failure_by_site')[0].hidden=true;\n$('#byCountryButton')[0].style.borderBottom='3px solid #6dadf1';\n$('#bySiteButton')[0].style.borderBottom='none';\n}\nfunction closeClicked() {\ntr.css('background-color', 'transparent');\nrow.child.hide();\ntr.removeClass('shown');\n}","visualisation":"","name":"customScript","vizName":"Custom","type":"Custom","icon":"VF","sql":{"id":19,"type":"sql","text":"select 1 as one","dataSource":{"id":1,"name":"sponsor"},"parameters":[]}}],"currentEditor":{"type":"reports","name":"customScript","component":"sql"},"sqlList":[{"id":1,"type":"sql","text":"select \r\n\tcast(round((sum(number_of_patients)/max(sum_by_trial))*100,0) as int) as \"bar value\",\r\n \tsum(\"criteria failure responses\".\"number_of_patients\") as \"# of Patients\",\r\n \tconcat(cast(round((sum(number_of_patients)/max(sum_by_trial))*100,0) as text), '%') as \"Percentage\",\r\n \t\"criteria failure responses\".\"failed_criteria\" as \"Failed Criteria\",\r\n \t\"criteria failure responses\".\"failed_criteria_text\" as \"Failed Criteria text\" \r\nfrom\r\n\t(WITH rawdata AS(\r\nSELECT\r\ncast('9bb8a8ec-657c-5689-9a77-7f1c0004746c' as uuid) as trial_id,'Moonlight' as trial_name\r\n--T.id as trial_id,T.name as trial_name\r\n,S.id as site_id,S.name as site_name,\r\nSTPV.id as patient_id,\r\ncase when criterion_type='inclusion' then CONCAT('Inc ',custom_identifier) else CONCAT('Enc ',custom_identifier) END AS Criteria,\r\nresponse,\r\nQ.question_text,\r\nIEC.created_at,\r\nA.created_at AS acreate,\r\nS.country\r\nFROM \"Answer\" AS A\r\nJOIN \"SiteTrialQuestion\" AS STQ ON A.site_trial_question_id = STQ.id\r\nJOIN \"Question\" AS Q ON Q.id = STQ.question_id\r\nJOIN \"InclusionExclusionCriteriaQuestion\" IECQ ON IECQ.question_id = Q.id\r\nJOIN \"InclusionExclusionCriteria\" IEC ON IECQ.ie_criteria_id = IEC.id\r\nRIGHT JOIN \"SiteTrialPatientView\" AS STPV ON STPV.id = A.site_trial_patient_id\r\nJOIN \"SiteTrialView\" AS STV ON STV.id = STQ.site_trial_id\r\nJOIN \"Trial\" AS T ON T.id = sponsor_trial_id AND T.id = IEC.trial_id\r\nJOIN \"Site\" AS S ON S.id = STV.site_id\r\nWhere STV.is_pseudo = false AND S.is_pseudo = false AND T.is_pseudo = false\r\nAND STV.ie_criteria_checklist_enabled = true\r\nAND ((response = 'Yes' AND criterion_type = 'exclusion') OR (response = 'No' AND criterion_type = 'inclusion'))\r\nAND S.id in ('e50cf7ba-8af4-59a0-a9f9-66a11458ae6b','dbf541f8-cf90-5d6e-8c9a-6b2659a9c527')\r\nAND T.id in ('0b39999c-6048-5a21-82ba-e49441b1b034','9bb8a8ec-657c-5689-9a77-7f1c0004746c')\r\nAND stage != 'archive'\r\n),\r\nmaxcreation AS (\r\nSELECT a.trial_name,a.trial_id, a.site_name,a.site_id,\r\nRANK() OVER(\r\nPARTITION BY a.trial_name,a.site_name\r\nORDER BY COUNT(a.Criteria) DESC) AS ranking,\r\na.Criteria,\r\nCOUNT(a.Criteria) AS Number_of_patients,\r\na.question_text,\r\na.country\r\nFROM rawdata AS a\r\nINNER JOIN (\r\n  SELECT trial_name,site_name, MAX(created_at) AS creation\r\n  FROM rawdata\r\n  GROUP BY trial_name,site_name) b ON a.trial_name = b.trial_name and a.site_name = b.site_name\r\nWHERE a.created_at = b.creation\r\nAND a.acreate > a.created_at\r\nGROUP BY a.trial_name, a.trial_id,a.site_name, a.site_id, a.criteria, a.question_text,a.country\r\n)\r\nselect \r\nmc1.site_id,mc1.site_name,mc1.trial_id,mc1.trial_name,mc1.ranking,\r\nmc1.number_of_patients,\r\nsum(mc1.number_of_patients) over(partition by trial_id order by trial_id) as sum_by_trial,\r\nsum(mc1.number_of_patients) over(partition by criteria,question_text order by criteria,question_text) as sum_by_site,\r\nmc1.criteria as failed_criteria,\r\nmc1.question_text as failed_criteria_text,\r\nmc1.country\r\nfrom maxcreation as mc1\r\ngroup by mc1.site_id,mc1.site_name,mc1.trial_id,mc1.trial_name,mc1.ranking,\r\nmc1.number_of_patients,mc1.criteria,mc1.question_text,country\r\norder by mc1.site_id,mc1.trial_id)  \"criteria failure responses\" \r\n\tinner join \"TrialGrant\" on (\"TrialGrant\".\"trial_id\" = \"criteria failure responses\".\"trial_id\") \r\nwhere\r\n\t( ('_all_' = '_all_')  AND ('_all_' = '_all_')  AND ('_all_' = '_all_')) and (\"TrialGrant\".user_id= 'auth0|5a908c0cee5d8b03b618225f') \r\ngroup by\r\n\t\"criteria failure responses\".\"failed_criteria\", \"criteria failure responses\".\"failed_criteria_text\" \r\norder by\r\n\tsum(\"criteria failure responses\".\"number_of_patients\") desc, \"criteria failure responses\".\"failed_criteria\" asc ","dataSource":{"id":1,"name":"connection1"},"parameters":[]},{"id":2,"type":"sql","text":"","dataSource":{},"parameters":[]},{"id":3,"type":"sql","text":"","dataSource":{},"parameters":[]},{"id":4,"type":"sql","text":"select 1 as one,2 as two","dataSource":{"id":1,"name":"connection1"},"parameters":[]},{"id":5,"type":"sql","text":"select \r\n\tcast(round((sum(number_of_patients)/max(sum_by_site))*100,0) as int) as \"bar value\",\r\n \tsum(\"criteria failure responses\".\"number_of_patients\") as \"# of Patients\",\r\n \tconcat(cast(round((sum(number_of_patients)/max(sum_by_site))*100,0) as text), '%') as \"Percentage\",\r\n \t\"criteria failure responses\".\"country\" as \"Country\" \r\nfrom\r\n\t(WITH rawdata AS(\r\nSELECT\r\ncast('9bb8a8ec-657c-5689-9a77-7f1c0004746c' as uuid) as trial_id,'Moonlight' as trial_name\r\n--T.id as trial_id,T.name as trial_name\r\n,S.id as site_id,S.name as site_name,\r\nSTPV.id as patient_id,\r\ncase when criterion_type='inclusion' then CONCAT('Inc ',custom_identifier) else CONCAT('Enc ',custom_identifier) END AS Criteria,\r\nresponse,\r\nQ.question_text,\r\nIEC.created_at,\r\nA.created_at AS acreate,\r\nS.country\r\nFROM \"Answer\" AS A\r\nJOIN \"SiteTrialQuestion\" AS STQ ON A.site_trial_question_id = STQ.id\r\nJOIN \"Question\" AS Q ON Q.id = STQ.question_id\r\nJOIN \"InclusionExclusionCriteriaQuestion\" IECQ ON IECQ.question_id = Q.id\r\nJOIN \"InclusionExclusionCriteria\" IEC ON IECQ.ie_criteria_id = IEC.id\r\nRIGHT JOIN \"SiteTrialPatientView\" AS STPV ON STPV.id = A.site_trial_patient_id\r\nJOIN \"SiteTrialView\" AS STV ON STV.id = STQ.site_trial_id\r\nJOIN \"Trial\" AS T ON T.id = sponsor_trial_id AND T.id = IEC.trial_id\r\nJOIN \"Site\" AS S ON S.id = STV.site_id\r\nWhere STV.is_pseudo = false AND S.is_pseudo = false AND T.is_pseudo = false\r\nAND STV.ie_criteria_checklist_enabled = true\r\nAND ((response = 'Yes' AND criterion_type = 'exclusion') OR (response = 'No' AND criterion_type = 'inclusion'))\r\nAND S.id in ('e50cf7ba-8af4-59a0-a9f9-66a11458ae6b','dbf541f8-cf90-5d6e-8c9a-6b2659a9c527')\r\nAND T.id in ('0b39999c-6048-5a21-82ba-e49441b1b034','9bb8a8ec-657c-5689-9a77-7f1c0004746c')\r\nAND stage != 'archive'\r\n),\r\nmaxcreation AS (\r\nSELECT a.trial_name,a.trial_id, a.site_name,a.site_id,\r\nRANK() OVER(\r\nPARTITION BY a.trial_name,a.site_name\r\nORDER BY COUNT(a.Criteria) DESC) AS ranking,\r\na.Criteria,\r\nCOUNT(a.Criteria) AS Number_of_patients,\r\na.question_text,\r\na.country\r\nFROM rawdata AS a\r\nINNER JOIN (\r\n  SELECT trial_name,site_name, MAX(created_at) AS creation\r\n  FROM rawdata\r\n  GROUP BY trial_name,site_name) b ON a.trial_name = b.trial_name and a.site_name = b.site_name\r\nWHERE a.created_at = b.creation\r\nAND a.acreate > a.created_at\r\nGROUP BY a.trial_name, a.trial_id,a.site_name, a.site_id, a.criteria, a.question_text,a.country\r\n)\r\nselect \r\nmc1.site_id,mc1.site_name,mc1.trial_id,mc1.trial_name,mc1.ranking,\r\nmc1.number_of_patients,\r\nsum(mc1.number_of_patients) over(partition by trial_id order by trial_id) as sum_by_trial,\r\nsum(mc1.number_of_patients) over(partition by criteria,question_text order by criteria,question_text) as sum_by_site,\r\nmc1.criteria as failed_criteria,\r\nmc1.question_text as failed_criteria_text,\r\nmc1.country\r\nfrom maxcreation as mc1\r\ngroup by mc1.site_id,mc1.site_name,mc1.trial_id,mc1.trial_name,mc1.ranking,\r\nmc1.number_of_patients,mc1.criteria,mc1.question_text,country\r\norder by mc1.site_id,mc1.trial_id)  \"criteria failure responses\" \r\nwhere\r\n\t( \"criteria failure responses\".\"trial_id\" = '9bb8a8ec-657c-5689-9a77-7f1c0004746c'    AND ('_all_' = '_all_') AND \"criteria failure responses\".\"failed_criteria\" = 'Enc 3'  ) \r\ngroup by\r\n\t\"criteria failure responses\".\"country\" \r\norder by\r\n\tsum(\"criteria failure responses\".\"number_of_patients\") desc, \"criteria failure responses\".\"country\" asc","dataSource":{"id":1,"name":"connection1"},"parameters":[]},{"id":6,"type":"sql","text":"select distinct t.id as trial_id from \"Trial\" t\r\ninner join \"TrialGrant\" tg on t.id=tg.trial_id\r\nwhere tg.user_id = ${user_name}","dataSource":{"id":1,"name":"connection1"},"parameters":[{"id":2,"openQuote":"","closeQuote":""}]},{"id":7,"type":"sql","text":"","dataSource":{"id":1,"name":"connection1"},"parameters":[]},{"id":8,"type":"sql","text":"","dataSource":{},"parameters":[]},{"id":9,"type":"sql","text":"","dataSource":{},"parameters":[]},{"id":10,"type":"sql","text":"","dataSource":{},"parameters":[]},{"id":11,"type":"sql","text":"","dataSource":{"id":1,"name":"connection1"},"parameters":[]},{"id":12,"type":"sql","text":"","dataSource":{"id":1,"name":"connection1"},"parameters":[]},{"id":13,"type":"sql","text":"select distinct cast(st.id as text) as site_trial_id from \"SiteTrialPatientView\" stp\r\nJOIN \"SiteTrialRead\" st ON stp.site_trial_id = st.id and st.is_pseudo=false\r\nJOIN \"Trial\" trial  ON st.sponsor_trial_id = trial.id  and trial.is_pseudo=false\r\nJOIN \"TrialGrant\" TG on TG.trial_id = trial.id\r\nwhere \r\n(('_all_'=${Trials}) or (cast(trial.id as text) = ${Trials}))\r\nAND TG.user_id = 'auth0|5b242f33c622dc3967ae3822'","dataSource":{"id":1,"name":"connection1"},"parameters":[{"id":2,"openQuote":"","closeQuote":""},{"id":1,"openQuote":"","closeQuote":""}]},{"id":14,"type":"sql","text":"select protocol_name_and_version from \r\n\t(select 'All Protocols' as protocol_name_and_version,now() as created_at \r\n\tUNION\r\n\tselect distinct protocol_name_and_version,IEC.created_at from \"InclusionExclusionCriteria\" IEC\r\n\tJOIN \"Trial\" AS T ON T.id = IEC.trial_id\r\n\tJOIN \"TrialGrant\" TG on TG.trial_id = T.id\r\n\twhere (('_all_'=${Trials}) or (cast(T.id as text) = ${Trials}))\r\n    AND TG.user_id = 'auth0|5b242f33c622dc3967ae3822'\r\n\t) as protocals\r\norder by created_at desc","dataSource":{"id":1,"name":"connection1"},"parameters":[{"id":1,"openQuote":"","closeQuote":""},{"id":2,"openQuote":"","closeQuote":""}]},{"id":15,"type":"sql","text":"select display_col,passing_col from (\r\nselect 'All Failures' as display_col,'All Failures' as passing_col,1 as list_order\r\nunion\r\nselect 'Pre-screen Failure' as display_col,'pre-screen-failure' as passing_col,2 as list_order\r\nunion\r\nselect 'Screen Failure' as display_col,'screen-failure' as passing_col,3 as list_order\r\nunion\r\nselect 'Potential Candidate' as display_col,'potential-candidate' as passing_col,4 as list_order\r\nunion\r\nselect 'Pre-Screening' as display_col,'pre-screening' as passing_col,5 as list_order\r\nunion\r\nselect 'First Visit Scheduled' as display_col,'first-visit-scheduled' as passing_col,6 as list_order\r\nunion\r\nselect 'In-Screening' as display_col,'in-screening' as passing_col,7 as list_order\r\nunion\r\nselect 'Actively Enrolled' as display_col,'enrolled' as passing_col,8 as list_order\r\nunion\r\nselect 'Completed' as display_col,'completed' as passing_col,9 as list_order\r\nunion\r\nselect 'Discontinued' as display_col,'discontinued' as passing_col,10 as list_order\r\n) as body\r\norder by list_order","dataSource":{"id":1,"name":"sponsor"},"parameters":[]},{"id":16,"type":"sql","text":"","dataSource":{},"parameters":[]},{"id":17,"type":"sql","text":"select 1 as one","dataSource":{"id":1,"name":"sponsor"},"parameters":[]},{"id":18,"type":"sql","text":"","dataSource":{},"parameters":[]},{"id":19,"type":"sql","text":"select 1 as one","dataSource":{"id":1,"name":"sponsor"},"parameters":[]}],"aceText":"select 1 as one","uuid":"2c32d272-b7a7-444f-bb15-ec4577fafa5f","showDatasource":true,"showDashboard":false,"showParameter":true,"showReport":true,"Editor":{"type":"","name":"","component":"","aceText":"select 1 as one"},"editing":false,"isEditor":""},{"formData":{"state":{"allTypes":{"sqlTypes":[{"name":"sql"},{"name":"sql.groovy"},{"name":"sql.adhoc"}],"vizTypes":[{"name":"Area","type":"EFW-c3","subtype":"Area","icon":"AreaChart"},{"name":"Area Spline","type":"EFW-c3","subtype":"AreaSpline","icon":"AreaSplineChart"},{"name":"Area Step","type":"EFW-c3","subtype":"AreaStep","icon":"AreaStepChart"},{"name":"Bar","type":"EFW-c3","subtype":"bar","icon":"BarChart"},{"name":"Donut","type":"EFW-c3","subtype":"donut","icon":"DonutChart"},{"name":"Gauge","type":"EFW-c3","subtype":"gauge","icon":"HICircularGauge"},{"name":"Line","type":"EFW-c3","subtype":"Line","icon":"LineChart"},{"name":"Pie","type":"EFW-c3","subtype":"Pie","icon":"PieChart"},{"name":"Scatter","type":"EFW-c3","subtype":"Scatter","icon":"ScatterChart"},{"name":"Spline","type":"EFW-c3","subtype":"Spline","icon":"SplineChart"},{"name":"Step","type":"EFW-c3","subtype":"Step","icon":"StepChart"},{"name":"Cross Tab","type":"EFW-CrossTab","icon":"HICrossTable"},{"name":"Table","type":"EFW-Table","icon":"HITable"},{"name":"Custom","type":"Custom","icon":"VF"}],"connTypes":[{"clazz":"com.helicalinsight.datasource.GlobalJdbcDataSource","classifier":"global","name":"Managed DataSource","type":"global.jdbc","hidden":"false"},{"clazz":"com.helicalinsight.datasource.JDBCDriver","classifier":"efwd","name":"Plain Jdbc DataSource","type":"sql.jdbc","hidden":"false"},{"clazz":"com.helicalinsight.adhoc.SqlAdhocDriver","classifier":"efwd","name":"Adhoc DataSource","type":"sql.adhoc","hidden":"true"},{"clazz":"com.helicalinsight.datasource.ExtJDBCDriver","classifier":"efwd","name":"Groovy Plain Jdbc DataSource","type":"sql.jdbc.groovy","hidden":"false"},{"clazz":"com.helicalinsight.datasource.GroovyManagedDriver","classifier":"efwd","name":"Groovy Managed Jdbc DataSource","type":"sql.jdbc.groovy.managed","hidden":"false"}],"parameterTypes":[{"name":"Collection"},{"name":"Numeric"},{"name":"String"}]},"datasource":[{"id":1,"configure":"<globalId>2<\/globalId>","name":"sponsor","type":{"name":"Managed DataSource","type":"global.jdbc"}}],"dashboard":{"html":"<div>\n<div id=\"divfailure\" class=\"col-xs-6 col-sm-3 col-lg-2 inputControl\">\n        <div id=\"Failures\"><\/div>\n<\/div>\n<div id=\"divprotocol\" class=\"col-xs-6 col-sm-3 col-lg-2 inputControl\">\n        <div id=\"Protocols\"><\/div>\n<\/div>\n<\/div>\n<div id=\"Trials\"><\/div>\n<div id=\"SiteTrials\"><\/div>\n<div id=\"failure_ParentTable\"><\/div>\n<div id=\"dummy\"><\/div>\n","css":".bar-chart-bar {\r\n    display: block; \r\n    position:relative; \r\n\tfloat: right;\r\n    height: 15px;\r\n}\r\n#table th {\r\n    border-bottom: 1px solid #dadada;\r\n    position: sticky;\r\n    box-shadow: #dee1e3 0px 2px 2px 0px;\r\n}\r\n#table_child thead,#table_child2 thead{\r\n    visibility: collapse;\r\n}\r\n#main-table-bars{\r\n    margin-left: 10px ! important;\r\n}\r\n#table_for_header thead tr th{\r\n    background-color: #f6f6f6;\r\n    font-weight: normal;\r\n    font-family: Lato;\r\n    color: #777d94;\r\n    text-align: left;\r\n    padding: 1rem;\r\n    padding-left: 1.5rem;\r\n}\r\n#table_for_header thead,#chart_2, #chart_3{\r\n    border: 1px solid lightgray;\r\n}\r\n#nested_tables{\r\n    padding: 5px;\r\n}\r\n.criteria-failure-codes {\r\n    display: inline-block;\r\n    border: 1px solid #DADADA;\r\n    background: #F9F9FA;\r\n    padding: .3rem;\r\n    border-radius: .3rem;\r\n    font-size: 1.1rem;\r\n    font-family: Lato;\r\n    cursor: pointer;\r\n}\r\n.dataTables_filter{\r\n float: left ! important;\r\n margin-top: -35px;\r\n}\r\n\r\n#table .colH_1, .col_1, .colH_2, .col_2,#table_child .colH_1, .col_1, .colH_2, .col_2,#table_child2 .colH_1, .col_1, .colH_2, .col_2{\r\n    text-align: right ! important;\r\n    justify-content: flex-end ! important;\r\n   // font-weight: bold ! important;\r\n    \r\n} \r\n#table .col_1, .col_2,#table_child .col_1, .col_2,#table_child2 .col_1, .col_2{\r\n    font-size: 1.3rem ! important;\r\n}\r\n#table .colH_3, .col_3,#table_child .colH_3, .col_3,#table_child2 .colH_3, .col_3{\r\n    padding-left: 5rem ! important;\r\n    \r\n}\r\n#table .colH_0,.colH_4{\r\n    border-left: none ! important;\r\n}\r\ndetails[open] .elipsisSpan { \r\n  display:none;\r\n}\r\nsummary{\r\n    outline: none;\r\n    display: list-item;\r\n}\r\n#bySiteButton, #byCountryButton, #closeButton {\r\n    padding-left: 5px;\r\n    padding-right: 5px;\r\n    font-family: Lato;\r\n    font-weight: bold;\r\n    //font-size: 1.3rem;\r\n    color: #777d94;\r\n    background: #f6f6f6;\r\n    border: none;\r\n    outline:none;\r\n}\r\n#closeButton{\r\n    float:right;\r\n}\r\n#bySiteButton{\r\n    float: right;\r\n    padding-bottom: 7px;\r\n\tmargin: 0px -7px;\r\n}\r\n#byCountryButton{\r\n    padding-bottom: 7px;\r\n\tmargin: 0px 9px;\r\n}\r\n#table_child, #table_child2{\r\n    //padding: 5px;\r\n    border: none;\r\n}\r\n#Trials, #SiteTrials{\r\n    display: none;\r\n}\r\n#divprotocol{\r\n    float: right;\r\n    padding: 2px;\r\n}\r\n#divfailure{\r\n    float: right;\r\n    padding: 2px;\r\n}\r\n#Protocols .form-control, #Failures .form-control{\r\n    font-family: Lato;\r\n    font-weight: bold;\r\n    color: #777d94;\r\n}\r\n.select2-container-multi .select2-choices{\r\n    border-radius: 4px;\r\n    min-height: 40px ! important;\r\n    color: #dadada;\r\n    border-color: #cdcdcd;\r\n    max-height: 100px;\r\n    overflow-y: auto;\r\n}\r\n.select2-container-multi .select2-choices .select2-search-choice{\r\n    border-radius: 2px;\r\n    background-color: rgba(0,126,255,0.08);\r\n    border: 1px solid rgba(0,126,255,0.24);\r\n    color: #007eff;\r\n    display: inline-block;\r\n    vertical-align: top;\r\n    margin-top: 5px;\r\n    margin-left: 5px;\r\n    max-width: 90%;\r\n}\r\n.select2-search-choice div{\r\n    padding: 2px;\r\n    padding-left: 7px;\r\n    color: #60A5EB;\r\n    text-overflow: initial;\r\n    overflow: auto;\r\n    white-space: normal;\r\n    word-break: break-word;\r\n    hyphens: none;\r\n    //border-left: 1px solid rgba(0,126,255,0.24);\r\n}\r\n.select2-search-choice-close{\r\n    height: 100%;\r\n    top: 0px ! important;\r\n    left: 0px ! important;\r\n    border-right: 1px solid rgba(0,126,255,0.24);\r\n    width: 18px;\r\n    /*\r\n    padding-bottom: 25px;\r\n    margin-top: -4px;\r\n    padding-left: 18px;\r\n    */\r\n}\r\n.select2-search-choice-close:before{\r\n    color: #007eff;\r\n    font-weight: 100;\r\n    font-size: 12px;\r\n    top: 20%;\r\n    /*\r\n    margin-top: 5px;\r\n    margin-left: -1px;\r\n    */\r\n}\r\n.select2-container-multi .select2-choices .select2-search-field input{\r\n    font-family: Arial !important;\r\n    font-style: italic;\r\n    color: #a4a8b4 ! important;\r\n    line-height: 1.6em;\r\n}\r\n.select2-drop-active{\r\n    border: 1px solid #cdcdcd;\r\n    border-top: 1px solid #cdcdcd;\r\n}\r\n.select2-results{\r\n    /*font-family: Arial !important; */\r\n    /* font-style: italic; */\r\n    color: #595f75 ! important;\r\n    line-height: 1.6em;\r\n    font-family: Lato;\r\n}\r\n.select2-results .select2-highlighted{\r\n    background: #f6f6f6;\r\n    color: #595f75;\r\n}\r\n"},"parameters":[{"id":1,"configure":"dashboard.setVariable('Trials',[\"_all_\"]);\nvar Trials = {\n    name: \"Trials\" ,\n    type:  \"select2\",\n    parameters: ['Trials'],\n    listeners: ['Protocols'], //,'Protocols','Failures'\n    requestParameters: { 'user_name': 'user_name'},\n    options:{\n        all: true,\n        multiple: true,             // it can be true or false\n        display : 'trial_id',\n        value : 'trial_id'\n    },\n    htmlElementId : \"#Trials\",              \n    executeAtStart: true,            // it can be true or false\n    map: 6,\n    efwd : {\n        file: '__efwd_file_name__'\n    },\n};\n","name":"Trials","type":"Collection","sql":{"id":6,"type":"sql","text":"select distinct cast(t.id as text) as trial_id from \"Trial\" t\r\ninner join \"TrialGrant\" tg on t.id=tg.trial_id\r\nwhere tg.user_id = ${user_name}","dataSource":{"id":1,"name":"sponsor"},"parameters":[{"id":2,"openQuote":"","closeQuote":""}]}},{"id":2,"configure":"//DashboardGlobals.sessionUserName\n//'auth0|5b242f33c622dc3967ae3822'\ndashboard.setVariable('user_name',DashboardGlobals.sessionUserName);\nvar user_name = {\n    name: \"user_name\" ,\n    type:  \"select2\", \n    options:{\n        multiple: false,             // it can be true or false\n        display : 'column_name',\n        value : 'column_name',\n        placeholder: 'select value'\n    },\n    htmlElementId : \"#user_name\",              \n    executeAtStart: false,            // it can be true or false\n    map: 7,\n    efwd : {\n        file: '__efwd_file_name__'\n    },\n};\nconsole.log(\"Logged in User: \",dashboard.getVariable('user_name'));\n","name":"user_name","type":"String","sql":{"id":7,"type":"sql","text":"","dataSource":{"id":1,"name":"sponsor"},"parameters":[]}},{"id":3,"configure":"dashboard.setVariable('selected_criteria_code','Inc 1');\nvar selected_criteria_code = {\n    name: \"selected_criteria_code\" ,\n    type:  \"select2\",             \n    options:{\n        multiple: false,             // it can be true or false\n        display : 'column_name',\n        value : 'column_name',\n        placeholder: 'select value'\n    },\n    htmlElementId : \"#selected_criteria_code\",              \n    executeAtStart: false,            // it can be true or false\n    map: 12,\n    efwd : {\n        file: '__efwd_file_name__'\n    },\n};\n","name":"selected_criteria_code","type":"String","sql":{"id":12,"type":"sql","text":"","dataSource":{"id":1,"name":"sponsor"},"parameters":[]}},{"id":4,"configure":"dashboard.setVariable('SiteTrials',[\"_all_\"]);\nvar SiteTrials = {\n    name: \"SiteTrials\" ,\n    type:  \"select2\",          \n    listeners: ['Trials'],\n    parameters:[\"SiteTrials\"],\n    requestParameters: {'Trials': 'Trials', 'user_name': 'user_name'},\n    options:{\n        all: true,\n        multiple: true,             // it can be true or false\n        display : 'site_trial_id',\n        value : 'site_trial_id'\n    },\n    htmlElementId : \"#SiteTrials\",              \n    executeAtStart: true,            // it can be true or false\n    map: 13,\n    efwd : {\n        file: '__efwd_file_name__'\n    },\n};\n","name":"SiteTrials","type":"Collection","sql":{"id":13,"type":"sql","text":"select distinct cast(stp.site_trial_id as text) as site_trial_id from \"SiteTrialPatientView\" stp\r\nJOIN \"SiteTrialRead\" st ON stp.site_trial_id = st.id and st.is_pseudo=false\r\nJOIN \"Trial\" trial  ON st.sponsor_trial_id = trial.id  and trial.is_pseudo=false\r\nJOIN \"TrialGrant\" TG on TG.trial_id = trial.id\r\nwhere \r\n(('_all_'=${Trials}) or (cast(trial.id as text) = ${Trials}))\r\nAND TG.user_id = ${user_name}","dataSource":{"id":1,"name":"sponsor"},"parameters":[{"id":2,"openQuote":"","closeQuote":""},{"id":1,"openQuote":"","closeQuote":""}]}},{"id":5,"configure":"dashboard.setVariable('Protocols',[\"All Protocols\"]);\nvar Protocols = {\n    name: \"Protocols\" ,\n    type:  \"select2\",             \n    parameters:[\"Protocols\"],\n    listeners: ['Trials'],\n    requestParameters: {'Trials': 'Trials', 'user_name': 'user_name'},\n    options:{\n        multiple: true,             // it can be true or false\n        display : 'protocol_name_and_version',\n        value : 'protocol_name_and_version',\n        placeholder: 'All Protocols'\n    },\n    htmlElementId : \"#Protocols\",              \n    executeAtStart: true,            // it can be true or false\n    map: 14,\n    efwd : {\n        file: '__efwd_file_name__'\n    },\n};\n","name":"Protocols","type":"Collection","sql":{"id":14,"type":"sql","text":"select protocol_name_and_version from \r\n\t(\r\n\tselect distinct protocol_name_and_version,IEC.created_at from \"InclusionExclusionCriteria\" IEC\r\n\tJOIN \"Trial\" AS T ON T.id = IEC.trial_id\r\n\tJOIN \"TrialGrant\" TG on TG.trial_id = T.id\r\n\twhere (('_all_'=${Trials}) or (cast(T.id as text) = ${Trials}))\r\n    AND TG.user_id = ${user_name}\r\n\t) as protocals\r\norder by created_at desc","dataSource":{"id":1,"name":"sponsor"},"parameters":[{"id":1,"openQuote":"","closeQuote":""},{"id":2,"openQuote":"","closeQuote":""}]}},{"id":6,"configure":"dashboard.setVariable('Failures',[\"All Failures\"]);\nvar Failures = {\n    name: \"Failures\" ,\n    type:  \"select2\",             \n    parameters:[\"Failures\"],\n    requestParameters: {'Trials': 'Trials', 'user_name': 'user_name','SiteTrials': 'SiteTrials','Protocols': 'Protocols'},\n    options:{\n        multiple: true,             // it can be true or false\n        display : 'display_col',\n        value : 'passing_col',\n        placeholder: 'All Failures'\n    },\n    htmlElementId : \"#Failures\",              \n    executeAtStart: true,            // it can be true or false\n    map: 15,\n    efwd : {\n        file: '__efwd_file_name__'\n    },\n};\n","name":"Failures","type":"Collection","sql":{"id":15,"type":"sql","text":"select\r\nCASE WHEN STPV.stage = 'potential-candidate' THEN 'Potential Candidate' ELSE\r\n  CASE WHEN STPV.stage = 'pre-screening' THEN 'Pre-Screening' ELSE\r\n\tCASE WHEN STPV.stage = 'first-visit-scheduled' THEN 'First Visit Scheduled' ELSE\r\n\t  CASE WHEN STPV.stage = 'in-screening' THEN 'In-Screening' ELSE\r\n\t\tCASE WHEN STPV.stage = 'enrolled' THEN 'Actively Enrolled' ELSE\r\n\t\t  CASE WHEN STPV.stage = 'completed' THEN 'Completed' ELSE\r\n\t\t\tCASE WHEN STPV.stage = 'pre-screen-failure' THEN 'Pre-screen Failure' ELSE\r\n\t\t\t\tCASE WHEN STPV.stage = 'screen-failure' THEN 'Screen Failure' ELSE\r\n\t\t\t\t\tCASE WHEN STPV.stage = 'discontinued' THEN 'Discontinued' ELSE 'Other' END END END END END END END END END as display_col,\r\nSTPV.stage as passing_col,\r\nCASE WHEN STPV.stage = 'pre-screen-failure' THEN 1 ELSE\r\n CASE WHEN STPV.stage = 'screen-failure' THEN 2 ELSE\r\n\tCASE WHEN STPV.stage = 'potential-candidate' THEN 3 ELSE\r\n\t  CASE WHEN STPV.stage = 'pre-screening' THEN 4 ELSE\r\n\t\tCASE WHEN STPV.stage = 'first-visit-scheduled' THEN 5 ELSE\r\n\t\t  CASE WHEN STPV.stage = 'in-screening' THEN 6 ELSE\r\n\t\t\tCASE WHEN STPV.stage = 'enrolled' THEN 7 ELSE\r\n\t\t\t  CASE WHEN STPV.stage = 'completed' THEN 8 ELSE\t\t\r\n\t\t\t\tCASE WHEN STPV.stage = 'discontinued' THEN 9 ELSE 10 END END END END END END END END END AS list_order\r\nfrom \r\n(select distinct STPV.stage from \"Answer\" AS A\r\nJOIN \"SiteTrialQuestion\" AS STQ ON A.site_trial_question_id = STQ.id\r\nJOIN \"Question\" AS Q ON Q.id = STQ.question_id\r\nJOIN \"InclusionExclusionCriteriaQuestion\" IECQ ON IECQ.question_id = Q.id\r\nJOIN \"InclusionExclusionCriteria\" IEC ON IECQ.ie_criteria_id = IEC.id\r\nRIGHT JOIN \"SiteTrialPatientView\" AS STPV ON STPV.id = A.site_trial_patient_id\r\nJOIN \"SiteTrialView\" AS STV ON STV.id = STQ.site_trial_id and STV.is_pseudo = false\r\nJOIN \"Trial\" AS T ON T.id = sponsor_trial_id AND T.id = IEC.trial_id AND T.is_pseudo = false\r\nJOIN \"TrialGrant\" TG on TG.trial_id = T.id\r\nJOIN \"Site\" AS S ON S.id = STV.site_id AND S.is_pseudo = false\r\nWhere   \r\nSTV.ie_criteria_checklist_enabled = true\r\nAND stage != 'archive'\r\nAND ((response = 'Yes' AND criterion_type = 'exclusion') OR (response = 'No' AND criterion_type = 'inclusion'))\r\nAND TG.user_id = ${user_name}\r\nAND (('_all_'=${Trials}) or (cast(T.id as text) = ${Trials}))\r\nAND (('_all_' in (${SiteTrials})) or (cast(STPV.site_trial_id as text) in (${SiteTrials})))\r\nAND (('All Protocols' in (${Protocols})) or (cast(protocol_name_and_version as text) in (${Protocols})))\r\n)STPV\r\norder by list_order","dataSource":{"id":1,"name":"sponsor"},"parameters":[{"id":1,"openQuote":"","closeQuote":""},{"id":2,"openQuote":"","closeQuote":""},{"id":4,"openQuote":"","closeQuote":""},{"id":5,"openQuote":"","closeQuote":""}]}}],"reports":[{"id":1,"configure":"var table = [];\nvar failure_ParentTable = {\n    name: \"failure_ParentTable\",\n    type:\"chart\",\n    listeners: ['SiteTrials','Trials'], //,'Protocols','Failures'\n    requestParameters: {'Trials': 'Trials', 'user_name': 'user_name','SiteTrials': 'SiteTrials','Protocols': 'Protocols','Failures': 'Failures'},\n    vf : {\n        id: \"1\",\n        file: '__efwvf_name__'\n    },\n    efwd : {\n        file: '__efwd_file_name__'\n    },\n    htmlElementId : \"#failure_ParentTable\", // provide report id here\n    executeAtStart: true  // it can be true or false\n};\n","visualisation":"if (data.length == 0) {\r\n\t\t\t    $('#chart_1').html(\"<div ><h4 style='font-family:Lato;text-align:CENTER;color:#777d94; padding-top:80px;'>No Data Available For Current Selection<\/h4><\/div>\");\r\n\t\t\t    return;\r\n} else {\r\nvar link = document.createElement(\"link\");\r\n\t\t\t\t  link.rel = \"stylesheet\";\r\n\t\t\t\t  \r\n\t\t\t\t  if(window.DashboardGlobals)\r\n\t\t\t\t\t\tlink.href = window.DashboardGlobals.baseUrl+\"/getExternalResource.html?path=1594625979695/1600153490910/jquery.dataTables.css\";\t\t\t\t\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tlink.href = \"getExternalResource.html?path=1594625979695/1600153490910/jquery.dataTables.css\";\r\n\t\t\t\t  \r\n\t\t\t\t\r\n\t\t\t\t document.getElementsByTagName(\"head\")[0].appendChild(link);\r\n\t\t\t\t var link2 = document.createElement(\"link\");\r\n\t\t\t\t link2.rel = 'stylesheet';\r\n\t\t\t\tif(window.DashboardGlobals)\r\n\t\t\t\tlink2.href = \"https://fonts.googleapis.com/css?family=Lato\";\r\n\t\t\t\telse\r\n\t\t\t\tlink2.href = \"https://fonts.googleapis.com/css?family=Lato\";\r\n\r\n\t\t\t\tdocument.getElementsByTagName(\"head\")[0].appendChild(link2);\r\n\t\t\t\t \r\n\t\t\t\t \r\n\t\t\t\t   var script = document.createElement(\"script\");\r\n\t\t\t\t   scriptLoaded = false;\r\n\t\t\t\t   \r\n\t\t\t\t\tif(window.DashboardGlobals)\r\n\t\t\t\t\t\tscript.src = window.DashboardGlobals.baseUrl+\"/getExternalResource.html?path=1594625979695/1600153490910/jquery.dataTables.min.js\";\t\t\t\t\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tscript.src = \"getExternalResource.html?path=1594625979695/1600153490910/jquery.dataTables.min.js\";\r\n\t\t\t\t \r\n\t\t\t\t script.async = false;\r\n\t\t\t\t document.getElementsByTagName(\"head\")[0].appendChild(script);\r\n\r\n                                var column_index=[];\r\n\t\t\t\t\t\t\t\tvar flag;\r\n\t\t\t\t\t\t\t\tfunction tabulate(elem, data, columns) {\t\r\n\t\t\t\t\t\t\t\tvar table = d3.select(elem).append(\"table\")\t\r\n\t\t\t\t\t\t\t\t.attr(\"class\",\" table display compact width:100%;cellspacing:1 \")\r\n\t\t\t\t\t\t\t\t.attr(\"id\",\"table\")\r\n\t\t\t\t\t\t\t\tthead = table.append(\"thead\"),\r\n\t\t\t\t\t\t\t\ttbody = table.append(\"tbody\");\r\n\r\n\r\n\t\t\t\t\t\t\t\t// append the header row\r\n\t\t\t\t\t\t\t\tthead.append(\"tr\")\r\n\t\t\t\t\t\t\t\t.selectAll(\"th\")\r\n\t\t\t\t\t\t\t\t.data(columns)\r\n\t\t\t\t\t\t\t\t.enter()\r\n\t\t\t\t\t\t\t\t.append(\"th\")\r\n\t\t\t\t\t\t\t\t.text(function(column) { return column; })\r\n\t\t\t\t\t\t\t\t.attr('class', function(d, i){ return \"colH_\" + i; })\r\n\t\t\t\t\t\t\t\t.style('background-color','#f6f6f6')\r\n\t\t\t\t\t\t\t\t//.style('font-size','13px')\r\n\t\t\t\t\t\t\t\t.style('font-weight', 'normal')\r\n\t\t\t\t\t\t\t\t.style('font-family', 'Lato')\r\n\t\t\t\t\t\t\t\t.style('color','#777d94')\r\n\t\t\t\t\t\t\t\t//.style('border-left','1px solid #d2cfcf75')\r\n\t\t\t\t\t\t\t\t.style('text-align','left')\r\n\t\t\t\t\t\t\t\t//.style('padding-bottom','10px')\r\n\t\t\t\t\t\t\t\t//.style('@media print','display:none')\r\n\t\t\t\t\t\t\t\t//.style('padding-left','25px')\r\n\t\t\t\t\t\t\t\t.style('min-width','10rem')\r\n\t\t\t\t\t\t\t\t.style('padding','1rem')\r\n\r\n\r\n\t\t\t\t\t\t\t\t// create a row for each object in the data\r\n\t\t\t\t\t\t\t\tvar rows = tbody.selectAll(\"tr\")\r\n\t\t\t\t\t\t\t\t.data(data)\r\n\t\t\t\t\t\t\t\t.enter()\r\n\t\t\t\t\t\t\t\t.append(\"tr\");\r\n\r\n\t\t\t\t\t\t\t\t// create a cell in each row for each column\r\n\t\t\t\t\t\t\t\tvar cells = rows.selectAll(\"td\")\r\n\t\t\t\t\t\t\t\t.data(function(row) {\r\n\t\t\t\t\t\t\t\treturn columns.map(function(column) {\r\n\t\t\t\t\t\t\t\treturn {column: column, value: row[column]};\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t.enter()\r\n\t\t\t\t\t\t\t\t.append(\"td\")\r\n\t\t\t\t\t\t\t\t.text(function(d) { return d.value; })\r\n\t\t\t\t\t\t\t\t.attr('class', function(d, i){ return \"col_\" + i; })\r\n\t\t\t\t\t\t\t\t//.attr('align', 'center')\r\n\t\t\t\t\t\t\t\t.style('color','#777d94')\r\n\t\t\t\t\t\t\t\t//.style('font-size','13px')\r\n\t\t\t\t\t\t\t\t.style('font-weight', 'normal')\r\n\t\t\t\t\t\t\t\t.style('font-family', 'Lato')\r\n\t\t\t\t\t\t\t\t.style('vertical-align', 'middle')\r\n\t\t\t\t\t\t\t\t.style('padding', '1.5rem')\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\treturn table;\r\n\t\t\t\t\t\t\t\t}\t\r\n\r\n\t\t\t\t\t\t\t\t// render the table\r\n\t\t\t\t\t\t\t\tvar subjectTable = tabulate( '#chart_1', data, Object.keys(data[0]));\t\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t  script.onload = function(){\r\n\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tvar firstrecord=true;\r\n\t\t\t\t\t\t\t\tvar firstValue = 0;\r\n\t\t\t\t\t\t\t\tvar localizedData=0;\r\n\t\t\t\t\t\t\t\t//const getNavigatorLanguage='en-US';\r\n\t\t\t\t\t\t\t\tconst getNavigatorLanguage = (navigator.languages && navigator.languages.length) ? navigator.languages[0] : navigator.userLanguage || navigator.language || navigator.browserLanguage || 'en-US';\r\n\t\t\t\t\t\t\t\tconst urlString = window.location.search;\r\n\t\t\t\t\t\t\t\tconst urlParams = new URLSearchParams(urlString);\r\n\t\t\t\t\t\t\t\tconsole.log(\"URL has pageLength: \",urlParams.has('pageLength'));\r\n\t\t\t\t\t\t\t\tconsole.log(\"pageLength: \",urlParams.get('pageLength'));\r\n\t\t\t\t\t\t\t\tif(urlParams.has('pageLength'))\r\n\t\t\t\t\t\t\t\tvar pageLength=parseInt(urlParams.get('pageLength'));\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\tvar pageLength=50;\r\n\t\t\t\t\t\t\t\tconsole.log(\"Data Length: \",data.length);\r\n\t\t\t\t\t\t\t\tif(data.length > pageLength)\r\n\t\t\t\t\t\t\t\tvar paging=true\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\tvar paging=false\r\n\t\t\t\t\t\t\t\t$(document).ready(function() {\t\r\n\t\t\t\t\t\t\t\ttable = $('#table').DataTable({\r\n\t\t\t\t\t\t\t\t\t//\"deferRender\": true,\r\n\t\t\t\t\t\t\t\t\t\"pageLength\": pageLength,\r\n\t\t\t\t\t\t\t\t\t\"lengthChange\": false,\r\n\t\t\t\t\t\t\t\t\t//\"pagingType\": \"full_numbers\",\r\n\t\t\t\t\t\t\t\t\t//\"lengthMenu\": [[25, 10, 25, 50, -1], [10, 10, 25, 50, \"All\"]],\r\n\t\t\t\t\t\t\t\t\t\"paging\": paging,\r\n\t\t\t\t\t\t\t\t\t\"jQueryUI\": true,\r\n\t\t\t\t\t\t\t\t\t\"ordering\": false,\r\n\t\t\t\t\t\t\t\t\t\"info\": true,\r\n\t\t\t\t\t\t\t\t\t//\"bFilter\": false,\r\n\t\t\t\t\t\t\t\t\tautoWidth: false,\r\n\t\t\t\t\t\t\t\t\t\"columns\": [\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\"title\":\"\",\r\n\t\t\t\t\t\t\t\t\t\t\"sortable\":false,\r\n\t\t\t\t\t\t\t\t\t\t\"width\":'96px',\r\n\t\t\t\t\t\t\t\t\t\t\"render\": function(data, type, row, meta){\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tfor(var i = 0; i < Object.keys(data).length; i++){\r\n\t\t\t\t\t\t\t\t\t\t\t\tif(firstrecord){\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tfirstValue = Math.round((120/data + Number.EPSILON)*100)/100;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tfirstrecord=false;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn $(\"<div class='bar-chart-bar' id='main-table-bars'><\/div>\", {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}).css({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"width\": '120px',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"background-color\": '#85000b'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}).prop(\"outerHTML\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvar remainValues = Math.round((firstValue*data + Number.EPSILON)*100)/100;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvar backColor='#fef8f9';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    if(remainValues>90){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#85000b';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>80&&remainValues<=90){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#d2202f';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>70&&remainValues<=80){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#df5f6a';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>60&&remainValues<=70){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#e6838b';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>50&&remainValues<=60){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#ec9ea5';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>40&&remainValues<=50){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#f0b5ba';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>30&&remainValues<=40){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#f4c8cc';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>20&&remainValues<=30){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#f8dadc';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>10&&remainValues<=20){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#fbe9eb';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues=>0&&remainValues<=10){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#fef8f9';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn $(\"<div class='bar-chart-bar'><\/div>\", {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}).css({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"width\": remainValues+'px',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"background-color\": backColor\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}).prop(\"outerHTML\")\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\"type\": \"html\",\r\n\t\t\t\t\t\t\t\t\t\t\"title\":\"# of Patients\",\r\n\t\t\t\t\t\t\t\t\t\t\"width\":'120px',\r\n\t\t\t\t\t\t\t\t\t\t\"render\":function(data){\r\n\t\t\t\t\t\t\t\t\t\t\treturn getLanguage(parseInt(data));\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\"title\":\"Percentage\",\r\n\t\t\t\t\t\t\t\t\t\t\"width\":'120px',\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\"title\":\"Failed Criteria\",\r\n\t\t\t\t\t\t\t\t\t\t\"width\":'120px',\r\n\t\t\t\t\t\t\t\t\t\t\"render\":function(data){\r\n\t\t\t\t\t\t\t\t\t\t\treturn \"<div><span   class='criteria-failure-codes'>\"+data+\"<\/span><\/div>\"\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\"title\":\"\",\r\n\t\t\t\t\t\t\t\t\t\t\"className\": \"text-left\",\r\n\t\t\t\t\t\t\t\t\t\t\"render\":function(data, type, row, meta){\r\n\t\t\t\t\t\t\t\t\t\t\tvar data=decodeHTML(data);\r\n\t\t\t\t\t\t\t\t\t\t\tvar showChar = 200;\r\n\t\t\t\t\t\t\t\t\t\t\tvar openDet=false;\r\n\t\t\t\t\t\t\t\t\t\t\tvar actualshowChar=data.indexOf(' ', showChar);\r\n\t\t\t\t\t\t\t\t\t\t\tif(actualshowChar!=-1) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tvar frontString = data.substr(0, actualshowChar);\r\n\t\t\t\t\t\t\t\t\t\t\t\tvar backString = data.substr(actualshowChar, data.length);\r\n\t\t\t\t\t\t\t\t\t\t\t\tvar html='<details style=\" font-family: Lato; cursor: pointer;\">'+backString+'<summary style=\" font-family: Lato;\">'+frontString+'<span class=\"elipsisSpan\">...<\/span><\/summary><\/details>';\r\n\t\t\t\t\t\t\t\t\t\t\t\treturn html.toString();\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\t\t\t\t\t\treturn data;\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tfunction getLanguage(localizedData){\r\n\t\t\t\t\t\t\t\t\treturn localizedData.toLocaleString(getNavigatorLanguage) \r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tfunction decodeHTML(encodedHTML){ return $('<div>').html(encodedHTML).text(); }\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tconst details = document.querySelectorAll(\"details\");\r\n\t\t\t\t\t\t\t\tdetails.forEach((targetDetail) => {\r\n\t\t\t\t\t\t\t\t  targetDetail.addEventListener(\"click\", () => {\r\n\t\t\t\t\t\t\t\t\t// Close all the details that are not targetDetail.\r\n\t\t\t\t\t\t\t\t\tdetails.forEach((detail) => {\r\n\t\t\t\t\t\t\t\t\t  if (detail !== targetDetail) {\r\n\t\t\t\t\t\t\t\t\t\tdetail.removeAttribute(\"open\");\r\n\t\t\t\t\t\t\t\t\t  }\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t  });\r\n\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\t});\t\r\n\t\t\t\t\t\t\t\t \r\n\t\t  }\r\n}","name":"failure_ParentTable","vizName":"Custom","type":"Custom","icon":"VF","sql":{"id":1,"type":"sql","text":"select \r\n\tcase when max(sum_by_trial)=0 then 0 else cast(round((sum(number_of_patients)/max(sum_by_trial))*100,0) as int) end as \"bar value\",\r\n \tsum(\"criteria failure responses\".\"number_of_patients\") as \"# of Patients\",\r\n \tcase when max(sum_by_trial)=0 then '0%' else concat(cast(round((sum(number_of_patients)/max(sum_by_trial))*100,0) as text), '%') end as \"Percentage\",\r\n \t\"criteria failure responses\".\"failed_criteria\" as \"Failed Criteria\",\r\n \t\"criteria failure responses\".\"failed_criteria_text\" as \"Failed Criteria text\" \r\nfrom\r\n\t(WITH rawdata AS(\r\nselect * from (\r\nSELECT\r\nT.id as trial_id,T.name as trial_name,\r\nSTPV.id as patient_id,\r\ncriterion_type,\r\ncustom_identifier,\r\ncase when criterion_type='inclusion' then CONCAT('Inc ',custom_identifier) else CONCAT('Exc ',custom_identifier) END AS Criteria,\r\nresponse,\r\nIECQ.question_id,\r\nQ.question_text,\r\nIEC.created_at,\r\nIEC.protocol_name_and_version,\r\nA.created_at AS acreate,\r\nS.country,\r\nstage\r\nFROM \"Answer\" AS A\r\nJOIN \"SiteTrialQuestion\" AS STQ ON A.site_trial_question_id = STQ.id\r\nJOIN \"Question\" AS Q ON Q.id = STQ.question_id\r\nJOIN \"InclusionExclusionCriteriaQuestion\" IECQ ON IECQ.question_id = Q.id\r\nJOIN \"InclusionExclusionCriteria\" IEC ON IECQ.ie_criteria_id = IEC.id\r\nRIGHT JOIN \"SiteTrialPatientView\" AS STPV ON STPV.id = A.site_trial_patient_id\r\nJOIN \"SiteTrialView\" AS STV ON STV.id = STQ.site_trial_id and STV.is_pseudo = false\r\nJOIN \"Trial\" AS T ON T.id = sponsor_trial_id AND T.id = IEC.trial_id AND T.is_pseudo = false\r\nJOIN \"TrialGrant\" TG on TG.trial_id = T.id\r\nJOIN \"Site\" AS S ON S.id = STV.site_id AND S.is_pseudo = false\r\nWhere   \r\nSTV.ie_criteria_checklist_enabled = true\r\nAND stage != 'archive'\r\nAND (('_all_'=${Trials}) or (cast(T.id as text) = ${Trials}))\r\nAND (('_all_' in (${SiteTrials})) or (cast(STPV.site_trial_id as text) in (${SiteTrials})))\r\nAND TG.user_id = 'auth0|5d9234f1bc48890e1d290c57' \r\n) as body\r\nwhere (('All Failures'in (${Failures})) or (cast(stage as text) in (${Failures})))\r\n),\r\nLatestQuestion as (select patient_id,question_id,max(created_at) as created_at\r\nFROM RAWDATA\r\ngroup by patient_id,question_id ),\r\nraw_main as (select r.* from RAWDATA r JOIN LatestQuestion lq on r.patient_id=lq.patient_id and r.question_id = lq.question_id and r.created_at = lq.created_at),\r\nmaxcreation AS (\r\nSELECT raw.trial_name,raw.trial_id,\r\nRANK() OVER(\r\nPARTITION BY raw.trial_name\r\nORDER BY COUNT(raw.Criteria) DESC) AS ranking,\r\nraw.Criteria,\r\nCOUNT(raw.Criteria) AS Number_of_patients,\r\nraw.question_text,\r\nraw.country\r\nFROM raw_main AS raw\r\nINNER JOIN (\r\n  SELECT trial_name, MAX(created_at) AS creation\r\n  FROM raw_main\r\n  GROUP BY trial_name) b ON raw.trial_name = b.trial_name\r\nWHERE\r\nraw.created_at = b.creation \r\nAND (('All Protocols' in (${Protocols})) or (cast(protocol_name_and_version as text) in (${Protocols})))\r\nAND ((response = 'Yes' AND criterion_type = 'exclusion') OR (response = 'No' AND criterion_type = 'inclusion'))\r\nGROUP BY raw.trial_name, raw.trial_id,raw.criteria, raw.question_text,raw.country\r\n)\r\nselect \r\nmc1.trial_id,mc1.trial_name,mc1.ranking,\r\nmc1.number_of_patients,\r\nsum(mc1.number_of_patients) over(partition by trial_id order by trial_id) as sum_by_trial,\r\nsum(mc1.number_of_patients) over(partition by criteria,question_text order by criteria,question_text) as sum_by_site,\r\nmc1.criteria as failed_criteria,\r\nmc1.question_text as failed_criteria_text,\r\nmc1.country\r\nfrom maxcreation as mc1\r\ngroup by mc1.trial_id,mc1.trial_name,mc1.ranking,\r\nmc1.number_of_patients,mc1.criteria,mc1.question_text,country\r\norder by mc1.trial_id)  \"criteria failure responses\" \r\ngroup by\r\n\t\"criteria failure responses\".\"failed_criteria\", \"criteria failure responses\".\"failed_criteria_text\" \r\norder by\r\n\tsum(\"criteria failure responses\".\"number_of_patients\") desc, \"criteria failure responses\".\"failed_criteria\" asc","dataSource":{"id":1,"name":"sponsor"},"parameters":[{"id":1,"openQuote":"","closeQuote":""},{"id":2,"openQuote":"","closeQuote":""},{"id":4,"openQuote":"","closeQuote":""},{"id":5,"openQuote":"","closeQuote":""},{"id":6,"openQuote":"","closeQuote":""}]}},{"id":2,"configure":"var failure_by_site = {\n    name: \"failure_by_site\",\n    type:\"chart\",\n    requestParameters: {'Trials': 'Trials', 'user_name': 'user_name','selected_criteria_code': 'selected_criteria_code','SiteTrials': 'SiteTrials','Protocols': 'Protocols','Failures': 'Failures'},\n    vf : {\n        id: \"2\",\n        file: '__efwvf_name__'\n    },\n    efwd : {\n        file: '__efwd_file_name__'\n    },\n    htmlElementId : \"#failure_by_site\", // provide report id here\n    executeAtStart: true  // it can be true or false\n};\n","visualisation":"if (data.length == 0) {\r\n\t\t\t    $('#chart_2').html(\"<div ><h4 style='font-family:Lato;text-align:CENTER;color:#777d94; padding-top:60px;'>No Data Available For Current Selection<\/h4><\/div>\");\r\n\t\t\t    return;\r\n} else {\r\nvar link = document.createElement(\"link\");\r\n\t\t\t\t  link.rel = \"stylesheet\";\r\n\t\t\t\t  \r\n\t\t\t\t  if(window.DashboardGlobals)\r\n\t\t\t\t\t\tlink.href = window.DashboardGlobals.baseUrl+\"/getExternalResource.html?path=1594625979695/1600153490910/jquery.dataTables.css\";\t\t\t\t\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tlink.href = \"getExternalResource.html?path=1594625979695/1600153490910/jquery.dataTables.css\";\r\n\t\t\t\t  \r\n\t\t\t\t\r\n\t\t\t\t document.getElementsByTagName(\"head\")[0].appendChild(link);\r\n\t\t\t\t var link2 = document.createElement(\"link\");\r\n\t\t\t\t link2.rel = 'stylesheet';\r\n\t\t\t\tif(window.DashboardGlobals)\r\n\t\t\t\tlink2.href = \"https://fonts.googleapis.com/css?family=Lato\";\r\n\t\t\t\telse\r\n\t\t\t\tlink2.href = \"https://fonts.googleapis.com/css?family=Lato\";\r\n\r\n\t\t\t\tdocument.getElementsByTagName(\"head\")[0].appendChild(link2);\r\n\t\t\t\t \r\n\t\t\t\t \r\n\t\t\t\t   var script = document.createElement(\"script\");\r\n\t\t\t\t   scriptLoaded = false;\r\n\t\t\t\t   \r\n\t\t\t\t\tif(window.DashboardGlobals)\r\n\t\t\t\t\t\tscript.src = window.DashboardGlobals.baseUrl+\"/getExternalResource.html?path=1594625979695/1600153490910/jquery.dataTables.min.js\";\t\t\t\t\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tscript.src = \"getExternalResource.html?path=1594625979695/1600153490910/jquery.dataTables.min.js\";\r\n\t\t\t\t \r\n\t\t\t\t script.async = false;\r\n\t\t\t\t document.getElementsByTagName(\"head\")[0].appendChild(script);\r\n\r\n                                var column_index=[];\r\n\t\t\t\t\t\t\t\tvar flag;\r\n\t\t\t\t\t\t\t\tfunction tabulate(elem, data, columns) {\t\r\n\t\t\t\t\t\t\t\tvar table = d3.select(elem).append(\"table\")\t\r\n\t\t\t\t\t\t\t\t.attr(\"class\",\" table display compact width:100%;cellspacing:1 \")\r\n\t\t\t\t\t\t\t\t.attr(\"id\",\"table_child\")\r\n\t\t\t\t\t\t\t\tthead = table.append(\"thead\"),\r\n\t\t\t\t\t\t\t\ttbody = table.append(\"tbody\");\r\n\r\n\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t// append the header row\r\n\t\t\t\t\t\t\t\tthead.append(\"tr\")\r\n\t\t\t\t\t\t\t\t.selectAll(\"th\")\r\n\t\t\t\t\t\t\t\t.data(columns)\r\n\t\t\t\t\t\t\t\t.enter()\r\n\t\t\t\t\t\t\t\t.append(\"th\")\r\n\t\t\t\t\t\t\t\t.text(function(column) { return column; })\r\n\t\t\t\t\t\t\t\t.attr('class', function(d, i){ return \"colH_\" + i; })\r\n\t\t\t\t\t\t\t\t.style('background-color','#f6f6f6')\r\n\t\t\t\t\t\t\t\t//.style('font-size','13px')\r\n\t\t\t\t\t\t\t\t.style('font-weight', 'normal')\r\n\t\t\t\t\t\t\t\t.style('font-family', 'Lato')\r\n\t\t\t\t\t\t\t\t.style('color','#777d94')\r\n\t\t\t\t\t\t\t\t//.style('border-left','1px solid #d2cfcf75')\r\n\t\t\t\t\t\t\t\t.style('text-align','left')\r\n\t\t\t\t\t\t\t\t//.style('padding-bottom','10px')\r\n\t\t\t\t\t\t\t\t//.style('@media print','display:none')\r\n\t\t\t\t\t\t\t\t//.style('padding-left','25px')\r\n\t\t\t\t\t\t\t\t.style('min-width','10rem')\r\n\t\t\t\t\t\t\t\t.style('padding','1rem');\r\n\t\t\t\t\t\t\t\t\r\n\r\n\r\n\t\t\t\t\t\t\t\t// create a row for each object in the data\r\n\t\t\t\t\t\t\t\tvar rows = tbody.selectAll(\"tr\")\r\n\t\t\t\t\t\t\t\t.data(data)\r\n\t\t\t\t\t\t\t\t.enter()\r\n\t\t\t\t\t\t\t\t.append(\"tr\");\r\n\r\n\t\t\t\t\t\t\t\t// create a cell in each row for each column\r\n\t\t\t\t\t\t\t\tvar cells = rows.selectAll(\"td\")\r\n\t\t\t\t\t\t\t\t.data(function(row) {\r\n\t\t\t\t\t\t\t\treturn columns.map(function(column) {\r\n\t\t\t\t\t\t\t\treturn {column: column, value: row[column]};\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t.enter()\r\n\t\t\t\t\t\t\t\t.append(\"td\")\r\n\t\t\t\t\t\t\t\t.text(function(d) { return d.value; })\r\n\t\t\t\t\t\t\t\t.attr('class', function(d, i){ return \"col_\" + i; })\r\n\t\t\t\t\t\t\t\t//.attr('align', 'center')\r\n\t\t\t\t\t\t\t\t.style('color','#777d94')\r\n\t\t\t\t\t\t\t\t//.style('font-size','13px')\r\n\t\t\t\t\t\t\t\t.style('font-weight', 'normal')\r\n\t\t\t\t\t\t\t\t.style('font-family', 'Lato')\r\n\t\t\t\t\t\t\t\t.style('vertical-align', 'middle')\r\n\t\t\t\t\t\t\t\t.style('padding', '1.5rem')\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\treturn table;\r\n\t\t\t\t\t\t\t\t}\t\r\n\r\n\t\t\t\t\t\t\t\t// render the table\r\n\t\t\t\t\t\t\t\tvar subjectTable = tabulate( '#chart_2', data, Object.keys(data[0]));\t\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t  script.onload = function(){\r\n\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tvar firstrecord=true;\r\n\t\t\t\t\t\t\t\tvar firstValue = 0;\r\n\t\t\t\t\t\t\t\tvar localizedData=0;\r\n\t\t\t\t\t\t\t\t//const getNavigatorLanguage='en-US';\r\n\t\t\t\t\t\t\t\tconst getNavigatorLanguage = (navigator.languages && navigator.languages.length) ? navigator.languages[0] : navigator.userLanguage || navigator.language || navigator.browserLanguage || 'en-US';\r\n\t\t\t\t\t\t\t\tconst urlString = window.location.search;\r\n\t\t\t\t\t\t\t\tconst urlParams = new URLSearchParams(urlString);\r\n\t\t\t\t\t\t\t\tif(urlParams.has('pageLength'))\r\n\t\t\t\t\t\t\t\tvar pageLength=parseInt(urlParams.get('pageLength'));\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\tvar pageLength=50;\r\n\t\t\t\t\t\t\t\tconsole.log(\"Data Length: \",data.length);\r\n\t\t\t\t\t\t\t\tif(data.length > pageLength)\r\n\t\t\t\t\t\t\t\tvar paging=true\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\tvar paging=false\r\n\t\t\t\t\t\t\t\t$(document).ready(function() {\r\n\t\t\t\t\t\t\t\tconsole.log(\"Inside Ready: \");\r\n\t\t\t\t\t\t\t\tvar table_by_store = $('#table_child').DataTable({\r\n\t\t\t\t\t\t\t\t\t//\"deferRender\": true,\r\n\t\t\t\t\t\t\t\t\t\"pageLength\": pageLength,\r\n\t\t\t\t\t\t\t\t\t\"lengthChange\": false,\r\n\t\t\t\t\t\t\t\t\t//\"pagingType\": \"full_numbers\",\r\n\t\t\t\t\t\t\t\t\t//\"lengthMenu\": [[25, 10, 25, 50, -1], [10, 10, 25, 50, \"All\"]],\r\n\t\t\t\t\t\t\t\t\t\"paging\": paging,\r\n\t\t\t\t\t\t\t\t\t\"jQueryUI\": true,\r\n\t\t\t\t\t\t\t\t\t\"ordering\": false,\r\n\t\t\t\t\t\t\t\t\t\"info\": true,\r\n\t\t\t\t\t\t\t\t\t\"bFilter\": false,\r\n\t\t\t\t\t\t\t\t\tautoWidth: false,\r\n\t\t\t\t\t\t\t\t\t\"columns\": [\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\"title\":\"\",\r\n\t\t\t\t\t\t\t\t\t\t\"sortable\":false,\r\n\t\t\t\t\t\t\t\t\t\t\"width\":'96px',\r\n\t\t\t\t\t\t\t\t\t\t\"render\": function(data, type, row, meta){\r\n\t\t\t\t\t\t\t\t\t\t\tfor(var i = 0; i < Object.keys(data).length; i++){\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\tif(firstrecord){\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tfirstValue = Math.round((120/data + Number.EPSILON)*100)/100;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tfirstrecord=false;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn $(\"<div class='bar-chart-bar'><\/div>\", {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}).css({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"width\": '120px',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"background-color\": '#85000b'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}).prop(\"outerHTML\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvar remainValues = Math.round((firstValue*data + Number.EPSILON)*100)/100;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvar backColor='#fef8f9';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    if(remainValues>90){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#85000b';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>80&&remainValues<=90){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#d2202f';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>70&&remainValues<=80){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#df5f6a';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>60&&remainValues<=70){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#e6838b';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>50&&remainValues<=60){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#ec9ea5';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>40&&remainValues<=50){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#f0b5ba';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>30&&remainValues<=40){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#f4c8cc';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>20&&remainValues<=30){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#f8dadc';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>10&&remainValues<=20){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#fbe9eb';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues=>0&&remainValues<=10){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#fef8f9';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn $(\"<div class='bar-chart-bar'><\/div>\", {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}).css({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"width\": remainValues+'px',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"background-color\": backColor\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}).prop(\"outerHTML\")\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\"type\": \"html\",\r\n\t\t\t\t\t\t\t\t\t\t\"title\":\"\",\r\n\t\t\t\t\t\t\t\t\t\t\"width\":'120px',\r\n\t\t\t\t\t\t\t\t\t\t\"render\":function(data){\r\n\t\t\t\t\t\t\t\t\t\t\treturn getLanguage(parseInt(data));\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\"title\":\"\",\r\n\t\t\t\t\t\t\t\t\t\t\"width\":'120px',\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\"className\": \"text-left\"\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tfunction getLanguage(localizedData){\r\n\t\t\t\t\t\t\t\t\treturn localizedData.toLocaleString(getNavigatorLanguage) \r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tfunction decodeHTML(encodedHTML){ return $('<div>').html(encodedHTML).text(); }\r\n\r\n\r\n\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t});\t\r\n\t\t\t\t\t\t\t\t \r\n\t\t  }\r\n}","name":"failure_by_site","vizName":"Custom","type":"Custom","icon":"VF","sql":{"id":4,"type":"sql","text":"select \r\n\tcase when max(sum_by_site)=0 then 0 else cast(round((sum(number_of_patients)/max(sum_by_site))*100,0) as int) end as \"bar value\",\r\n \tsum(\"criteria failure responses\".\"number_of_patients\") as \"# of Patients\",\r\n \tcase when max(sum_by_site)=0 then '0%' else concat(cast(round((sum(number_of_patients)/max(sum_by_site))*100,0) as text), '%') end as \"Percentage\",\r\n \t\"criteria failure responses\".\"site_name\" as \"Site\" \r\nfrom\r\n\t(WITH rawdata AS(\r\nselect * from (\r\nSELECT\r\nT.id as trial_id,T.name as trial_name\r\n,S.id as site_id,S.name as site_name,\r\nSTPV.id as patient_id,\r\ncriterion_type,\r\ncustom_identifier,\r\ncase when criterion_type='inclusion' then CONCAT('Inc ',custom_identifier) else CONCAT('Exc ',custom_identifier) END AS Criteria,\r\nresponse,\r\nIECQ.question_id,\r\nQ.question_text,\r\nIEC.created_at,\r\nIEC.protocol_name_and_version,\r\nA.created_at AS acreate,\r\nS.country,\r\nstage\r\nFROM \"Answer\" AS A\r\nJOIN \"SiteTrialQuestion\" AS STQ ON A.site_trial_question_id = STQ.id\r\nJOIN \"Question\" AS Q ON Q.id = STQ.question_id\r\nJOIN \"InclusionExclusionCriteriaQuestion\" IECQ ON IECQ.question_id = Q.id\r\nJOIN \"InclusionExclusionCriteria\" IEC ON IECQ.ie_criteria_id = IEC.id\r\nRIGHT JOIN \"SiteTrialPatientView\" AS STPV ON STPV.id = A.site_trial_patient_id\r\nJOIN \"SiteTrialView\" AS STV ON STV.id = STQ.site_trial_id and STV.is_pseudo = false\r\nJOIN \"Trial\" AS T ON T.id = sponsor_trial_id AND T.id = IEC.trial_id AND T.is_pseudo = false\r\nJOIN \"TrialGrant\" TG on TG.trial_id = T.id\r\nJOIN \"Site\" AS S ON S.id = STV.site_id AND S.is_pseudo = false\r\nWhere   \r\nSTV.ie_criteria_checklist_enabled = true\r\nAND stage != 'archive'\r\nAND (('_all_'=${Trials}) or (cast(T.id as text) = ${Trials}))\r\nAND (('_all_' in (${SiteTrials})) or (cast(STPV.site_trial_id as text) in (${SiteTrials})))\r\nAND TG.user_id = 'auth0|5d9234f1bc48890e1d290c57') as body\r\nwhere (('All Failures'in (${Failures})) or (cast(stage as text) in (${Failures})))\r\n),\r\nLatestQuestion as (select patient_id,question_id,max(created_at) as created_at\r\nFROM RAWDATA\r\ngroup by patient_id,question_id ),\r\nraw_main as (select r.* from RAWDATA r JOIN LatestQuestion lq on r.patient_id=lq.patient_id and r.question_id = lq.question_id and r.created_at = lq.created_at),\r\nmaxcreation AS (\r\nSELECT raw.trial_name,raw.trial_id, raw.site_name,raw.site_id,\r\nRANK() OVER(\r\nPARTITION BY raw.trial_name,raw.site_name\r\nORDER BY COUNT(raw.Criteria) DESC) AS ranking,\r\nraw.Criteria,\r\nCOUNT(raw.Criteria) AS Number_of_patients,\r\nraw.question_text,\r\nraw.country\r\nFROM raw_main AS raw\r\nINNER JOIN (\r\n  SELECT trial_name,site_name, MAX(created_at) AS creation\r\n  FROM raw_main\r\n  GROUP BY trial_name,site_name) b ON raw.trial_name = b.trial_name and raw.site_name = b.site_name\r\nWHERE \r\nraw.criteria=${selected_criteria_code}\r\nAND (('All Protocols' in (${Protocols})) or (cast(protocol_name_and_version as text) in (${Protocols})))\r\nAND raw.created_at = b.creation\r\nAND ((response = 'Yes' AND criterion_type = 'exclusion') OR (response = 'No' AND criterion_type = 'inclusion'))\r\nGROUP BY raw.trial_name, raw.trial_id,raw.site_name, raw.site_id, raw.criteria, raw.question_text,raw.country\r\n)\r\nselect \r\nmc1.site_id,mc1.site_name,mc1.trial_id,mc1.trial_name,mc1.ranking,\r\nmc1.number_of_patients,\r\nsum(mc1.number_of_patients) over(partition by trial_id order by trial_id) as sum_by_trial,\r\nsum(mc1.number_of_patients) over(partition by criteria,question_text order by criteria,question_text) as sum_by_site,\r\nmc1.criteria as failed_criteria,\r\nmc1.question_text as failed_criteria_text,\r\nmc1.country\r\nfrom maxcreation as mc1\r\ngroup by mc1.site_id,mc1.site_name,mc1.trial_id,mc1.trial_name,mc1.ranking,\r\nmc1.number_of_patients,mc1.criteria,mc1.question_text,country\r\norder by mc1.site_id,mc1.trial_id)  \"criteria failure responses\" \r\ngroup by\r\n\t\"criteria failure responses\".\"site_name\" \r\norder by\r\n\tsum(\"criteria failure responses\".\"number_of_patients\") desc, \"criteria failure responses\".\"site_name\" asc","dataSource":{"id":1,"name":"sponsor"},"parameters":[{"id":1,"openQuote":"","closeQuote":""},{"id":2,"openQuote":"","closeQuote":""},{"id":3,"openQuote":"","closeQuote":""},{"id":4,"openQuote":"","closeQuote":""},{"id":5,"openQuote":"","closeQuote":""},{"id":6,"openQuote":"","closeQuote":""}]}},{"id":3,"configure":"var failure_by_country = {\n    name: \"failure_by_country\",\n    type:\"chart\",\n    requestParameters: { 'Trials': 'Trials', 'user_name': 'user_name','selected_criteria_code': 'selected_criteria_code','SiteTrials': 'SiteTrials','Protocols': 'Protocols','Failures': 'Failures'},\n    vf : {\n        id: \"3\",\n        file: '__efwvf_name__'\n    },\n    efwd : {\n        file: '__efwd_file_name__'\n    },\n    htmlElementId : \"#failure_by_country\", // provide report id here\n    executeAtStart: true  // it can be true or false\n};\n","visualisation":"if (data.length == 0) {\r\n\t\t\t    $('#chart_3').html(\"<div ><h4 style='font-family:Lato;text-align:CENTER;color:#777d94; padding-top:60px;'>No Data Available For Current Selection<\/h4><\/div>\");\r\n\t\t\t    return;\r\n} else {\r\nvar link = document.createElement(\"link\");\r\n\t\t\t\t  link.rel = \"stylesheet\";\r\n\t\t\t\t  \r\n\t\t\t\t  if(window.DashboardGlobals)\r\n\t\t\t\t\t\tlink.href = window.DashboardGlobals.baseUrl+\"/getExternalResource.html?path=1594625979695/1600153490910/jquery.dataTables.css\";\t\t\t\t\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tlink.href = \"getExternalResource.html?path=1594625979695/1600153490910/jquery.dataTables.css\";\r\n\t\t\t\t  \r\n\t\t\t\t\r\n\t\t\t\t document.getElementsByTagName(\"head\")[0].appendChild(link);\r\n\t\t\t\t var link2 = document.createElement(\"link\");\r\n\t\t\t\t link2.rel = 'stylesheet';\r\n\t\t\t\tif(window.DashboardGlobals)\r\n\t\t\t\tlink2.href = \"https://fonts.googleapis.com/css?family=Lato\";\r\n\t\t\t\telse\r\n\t\t\t\tlink2.href = \"https://fonts.googleapis.com/css?family=Lato\";\r\n\r\n\t\t\t\tdocument.getElementsByTagName(\"head\")[0].appendChild(link2);\r\n\t\t\t\t \r\n\t\t\t\t \r\n\t\t\t\t   var script = document.createElement(\"script\");\r\n\t\t\t\t   scriptLoaded = false;\r\n\t\t\t\t   \r\n\t\t\t\t\tif(window.DashboardGlobals)\r\n\t\t\t\t\t\tscript.src = window.DashboardGlobals.baseUrl+\"/getExternalResource.html?path=1594625979695/1600153490910/jquery.dataTables.min.js\";\t\t\t\t\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tscript.src = \"getExternalResource.html?path=1594625979695/1600153490910/jquery.dataTables.min.js\";\r\n\t\t\t\t \r\n\t\t\t\t script.async = false;\r\n\t\t\t\t document.getElementsByTagName(\"head\")[0].appendChild(script);\r\n\r\n                                var column_index=[];\r\n\t\t\t\t\t\t\t\tvar flag;\r\n\t\t\t\t\t\t\t\tfunction tabulate(elem, data, columns) {\t\r\n\t\t\t\t\t\t\t\tvar table = d3.select(elem).append(\"table\")\t\r\n\t\t\t\t\t\t\t\t.attr(\"class\",\" table display compact width:100%;cellspacing:1 \")\r\n\t\t\t\t\t\t\t\t.attr(\"id\",\"table_child2\")\r\n\t\t\t\t\t\t\t\tthead = table.append(\"thead\"),\r\n\t\t\t\t\t\t\t\ttbody = table.append(\"tbody\");\r\n\r\n\r\n\t\t\t\t\t\t\t\t// append the header row\r\n\t\t\t\t\t\t\t\tthead.append(\"tr\")\r\n\t\t\t\t\t\t\t\t.selectAll(\"th\")\r\n\t\t\t\t\t\t\t\t.data(columns)\r\n\t\t\t\t\t\t\t\t.enter()\r\n\t\t\t\t\t\t\t\t.append(\"th\")\r\n\t\t\t\t\t\t\t\t.text(function(column) { return column; })\r\n\t\t\t\t\t\t\t\t.attr('class', function(d, i){ return \"colH_\" + i; })\r\n\t\t\t\t\t\t\t\t.style('background-color','#f6f6f6')\r\n\t\t\t\t\t\t\t\t//.style('font-size','13px')\r\n\t\t\t\t\t\t\t\t.style('font-weight', 'normal')\r\n\t\t\t\t\t\t\t\t.style('font-family', 'Lato')\r\n\t\t\t\t\t\t\t\t.style('color','#777d94')\r\n\t\t\t\t\t\t\t\t//.style('border-left','1px solid #d2cfcf75')\r\n\t\t\t\t\t\t\t\t.style('text-align','left')\r\n\t\t\t\t\t\t\t\t//.style('padding-bottom','10px')\r\n\t\t\t\t\t\t\t\t//.style('@media print','display:none')\r\n\t\t\t\t\t\t\t\t//.style('padding-left','25px')\r\n\t\t\t\t\t\t\t\t.style('min-width','10rem')\r\n\t\t\t\t\t\t\t\t.style('padding','1rem')\r\n\r\n\r\n\t\t\t\t\t\t\t\t// create a row for each object in the data\r\n\t\t\t\t\t\t\t\tvar rows = tbody.selectAll(\"tr\")\r\n\t\t\t\t\t\t\t\t.data(data)\r\n\t\t\t\t\t\t\t\t.enter()\r\n\t\t\t\t\t\t\t\t.append(\"tr\");\r\n\r\n\t\t\t\t\t\t\t\t// create a cell in each row for each column\r\n\t\t\t\t\t\t\t\tvar cells = rows.selectAll(\"td\")\r\n\t\t\t\t\t\t\t\t.data(function(row) {\r\n\t\t\t\t\t\t\t\treturn columns.map(function(column) {\r\n\t\t\t\t\t\t\t\treturn {column: column, value: row[column]};\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t.enter()\r\n\t\t\t\t\t\t\t\t.append(\"td\")\r\n\t\t\t\t\t\t\t\t.text(function(d) { return d.value; })\r\n\t\t\t\t\t\t\t\t.attr('class', function(d, i){ return \"col_\" + i; })\r\n\t\t\t\t\t\t\t\t//.attr('align', 'center')\r\n\t\t\t\t\t\t\t\t.style('color','#777d94')\r\n\t\t\t\t\t\t\t\t//.style('font-size','13px')\r\n\t\t\t\t\t\t\t\t.style('font-weight', 'normal')\r\n\t\t\t\t\t\t\t\t.style('font-family', 'Lato')\r\n\t\t\t\t\t\t\t\t.style('vertical-align', 'middle')\r\n\t\t\t\t\t\t\t\t.style('padding', '1.5rem')\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\treturn table;\r\n\t\t\t\t\t\t\t\t}\t\r\n\r\n\t\t\t\t\t\t\t\t// render the table\r\n\t\t\t\t\t\t\t\tvar subjectTable = tabulate( '#chart_3', data, Object.keys(data[0]));\t\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t  script.onload = function(){\r\n\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tvar firstrecord=true;\r\n\t\t\t\t\t\t\t\tvar firstValue = 0;\r\n\t\t\t\t\t\t\t\tvar localizedData=0;\r\n\t\t\t\t\t\t\t\t//const getNavigatorLanguage='en-US';\r\n\t\t\t\t\t\t\t\tconst getNavigatorLanguage = (navigator.languages && navigator.languages.length) ? navigator.languages[0] : navigator.userLanguage || navigator.language || navigator.browserLanguage || 'en-US';\r\n\t\t\t\t\t\t\t\tconst urlString = window.location.search;\r\n\t\t\t\t\t\t\t\tconst urlParams = new URLSearchParams(urlString);\r\n\t\t\t\t\t\t\t\tif(urlParams.has('pageLength'))\r\n\t\t\t\t\t\t\t\tvar pageLength=parseInt(urlParams.get('pageLength'));\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\tvar pageLength=50;\r\n\t\t\t\t\t\t\t\tif(data.length > pageLength)\r\n\t\t\t\t\t\t\t\tvar paging=true\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\tvar paging=false\r\n\t\t\t\t\t\t\t\t$(document).ready(function() {\r\n\t\t\t\t\t\t\t\tconsole.log(\"Inside Ready: \");\r\n\t\t\t\t\t\t\t\tvar table_by_store = $('#table_child2').DataTable({\r\n\t\t\t\t\t\t\t\t\t//\"deferRender\": true,\r\n\t\t\t\t\t\t\t\t\t\"pageLength\": pageLength,\r\n\t\t\t\t\t\t\t\t\t\"lengthChange\": false,\r\n\t\t\t\t\t\t\t\t\t//\"pagingType\": \"full_numbers\",\r\n\t\t\t\t\t\t\t\t\t//\"lengthMenu\": [[25, 10, 25, 50, -1], [10, 10, 25, 50, \"All\"]],\r\n\t\t\t\t\t\t\t\t\t\"paging\": paging,\r\n\t\t\t\t\t\t\t\t\t\"jQueryUI\": true,\r\n\t\t\t\t\t\t\t\t\t\"ordering\": false,\r\n\t\t\t\t\t\t\t\t\t\"info\": true,\r\n\t\t\t\t\t\t\t\t\t\"bFilter\": false,\r\n\t\t\t\t\t\t\t\t\tautoWidth: false,\r\n\t\t\t\t\t\t\t\t\t\"columns\": [\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\"title\":\"\",\r\n\t\t\t\t\t\t\t\t\t\t\"sortable\":false,\r\n\t\t\t\t\t\t\t\t\t\t\"width\":'96px',\r\n\t\t\t\t\t\t\t\t\t\t\"render\": function(data, type, row, meta){\r\n\t\t\t\t\t\t\t\t\t\t\tfor(var i = 0; i < Object.keys(data).length; i++){\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\tif(firstrecord){\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tfirstValue = Math.round((120/data + Number.EPSILON)*100)/100;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tfirstrecord=false;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn $(\"<div class='bar-chart-bar'><\/div>\", {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}).css({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"width\": '120px',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"background-color\": '#85000b'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}).prop(\"outerHTML\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvar remainValues = Math.round((firstValue*data + Number.EPSILON)*100)/100;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvar backColor='#fef8f9';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    if(remainValues>90){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#85000b';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>80&&remainValues<=90){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#d2202f';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>70&&remainValues<=80){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#df5f6a';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>60&&remainValues<=70){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#e6838b';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>50&&remainValues<=60){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#ec9ea5';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>40&&remainValues<=50){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#f0b5ba';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>30&&remainValues<=40){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#f4c8cc';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>20&&remainValues<=30){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#f8dadc';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>10&&remainValues<=20){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#fbe9eb';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues=>0&&remainValues<=10){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#fef8f9';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn $(\"<div class='bar-chart-bar'><\/div>\", {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}).css({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"width\": remainValues+'px',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"background-color\": backColor\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}).prop(\"outerHTML\")\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\"type\": \"html\",\r\n\t\t\t\t\t\t\t\t\t\t\"title\":\"\",\r\n\t\t\t\t\t\t\t\t\t\t\"width\":'120px',\r\n\t\t\t\t\t\t\t\t\t\t\"render\":function(data){\r\n\t\t\t\t\t\t\t\t\t\t\treturn getLanguage(parseInt(data));\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\"title\":\"\",\r\n\t\t\t\t\t\t\t\t\t\t\"width\":'120px',\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\"className\": \"text-left\"\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tfunction getLanguage(localizedData){\r\n\t\t\t\t\t\t\t\t\treturn localizedData.toLocaleString(getNavigatorLanguage) \r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tfunction decodeHTML(encodedHTML){ return $('<div>').html(encodedHTML).text(); }\r\n\r\n\r\n\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t});\t\r\n\t\t\t\t\t\t\t\t \r\n\t\t  }\r\n}","name":"failure_by_country","vizName":"Custom","type":"Custom","icon":"VF","sql":{"id":5,"type":"sql","text":"select \r\n\tcase when max(sum_by_site)=0 then 0 else  cast(round((sum(number_of_patients)/max(sum_by_site))*100,0) as int) end as \"bar value\",\r\n \tsum(\"criteria failure responses\".\"number_of_patients\") as \"# of Patients\",\r\n \tcase when max(sum_by_site)=0 then '0%' else  concat(cast(round((sum(number_of_patients)/max(sum_by_site))*100,0) as text), '%') end as \"Percentage\",\r\n \t\"criteria failure responses\".\"country\" as \"Country\" \r\nfrom\r\n\t(WITH rawdata AS(\r\nselect * from (\r\nSELECT\r\nT.id as trial_id,T.name as trial_name\r\n,S.id as site_id,S.name as site_name,\r\nSTPV.id as patient_id,\r\ncriterion_type,\r\ncustom_identifier,\r\ncase when criterion_type='inclusion' then CONCAT('Inc ',custom_identifier) else CONCAT('Exc ',custom_identifier) END AS Criteria,\r\nresponse,\r\nIECQ.question_id,\r\nQ.question_text,\r\nIEC.created_at,\r\nIEC.protocol_name_and_version,\r\nA.created_at AS acreate,\r\nS.country,\r\nstage\r\nFROM \"Answer\" AS A\r\nJOIN \"SiteTrialQuestion\" AS STQ ON A.site_trial_question_id = STQ.id\r\nJOIN \"Question\" AS Q ON Q.id = STQ.question_id\r\nJOIN \"InclusionExclusionCriteriaQuestion\" IECQ ON IECQ.question_id = Q.id\r\nJOIN \"InclusionExclusionCriteria\" IEC ON IECQ.ie_criteria_id = IEC.id\r\nRIGHT JOIN \"SiteTrialPatientView\" AS STPV ON STPV.id = A.site_trial_patient_id\r\nJOIN \"SiteTrialView\" AS STV ON STV.id = STQ.site_trial_id and STV.is_pseudo = false\r\nJOIN \"Trial\" AS T ON T.id = sponsor_trial_id AND T.id = IEC.trial_id AND T.is_pseudo = false\r\nJOIN \"TrialGrant\" TG on TG.trial_id = T.id\r\nJOIN \"Site\" AS S ON S.id = STV.site_id AND S.is_pseudo = false\r\nWhere   \r\nSTV.ie_criteria_checklist_enabled = true\r\nAND stage != 'archive'\r\nAND (('_all_'=${Trials}) or (cast(T.id as text) = ${Trials}))\r\nAND (('_all_' in (${SiteTrials})) or (cast(STPV.site_trial_id as text) in (${SiteTrials})))\r\nAND TG.user_id = 'auth0|5d9234f1bc48890e1d290c57') as body\r\nwhere (('All Failures'in (${Failures})) or (cast(stage as text) in (${Failures})))\r\n),\r\nLatestQuestion as (select patient_id,question_id,max(created_at) as created_at\r\nFROM RAWDATA\r\ngroup by patient_id,question_id ),\r\nraw_main as (select r.* from RAWDATA r JOIN LatestQuestion lq on r.patient_id=lq.patient_id and r.question_id = lq.question_id and r.created_at = lq.created_at),\r\nmaxcreation AS (\r\nSELECT raw.trial_name,raw.trial_id, raw.site_name,raw.site_id,\r\nRANK() OVER(\r\nPARTITION BY raw.trial_name,raw.site_name\r\nORDER BY COUNT(raw.Criteria) DESC) AS ranking,\r\nraw.Criteria,\r\nCOUNT(raw.Criteria) AS Number_of_patients,\r\nraw.question_text,\r\nraw.country\r\nFROM raw_main AS raw\r\nINNER JOIN (\r\n  SELECT trial_name,site_name, MAX(created_at) AS creation\r\n  FROM raw_main\r\n  GROUP BY trial_name,site_name) b ON raw.trial_name = b.trial_name and raw.site_name = b.site_name\r\nWHERE \r\nraw.criteria=${selected_criteria_code}\r\nAND (('All Protocols' in (${Protocols})) or (cast(protocol_name_and_version as text) in (${Protocols})))\r\nAND raw.created_at = b.creation\r\nAND ((response = 'Yes' AND criterion_type = 'exclusion') OR (response = 'No' AND criterion_type = 'inclusion'))\r\nGROUP BY raw.trial_name, raw.trial_id,raw.site_name, raw.site_id, raw.criteria, raw.question_text,raw.country\r\n)\r\nselect \r\nmc1.site_id,mc1.site_name,mc1.trial_id,mc1.trial_name,mc1.ranking,\r\nmc1.number_of_patients,\r\nsum(mc1.number_of_patients) over(partition by trial_id order by trial_id) as sum_by_trial,\r\nsum(mc1.number_of_patients) over(partition by criteria,question_text order by criteria,question_text) as sum_by_site,\r\nmc1.criteria as failed_criteria,\r\nmc1.question_text as failed_criteria_text,\r\nmc1.country\r\nfrom maxcreation as mc1\r\ngroup by mc1.site_id,mc1.site_name,mc1.trial_id,mc1.trial_name,mc1.ranking,\r\nmc1.number_of_patients,mc1.criteria,mc1.question_text,country\r\norder by mc1.site_id,mc1.trial_id)  \"criteria failure responses\" \r\ngroup by\r\n\t\"criteria failure responses\".\"country\" \r\norder by\r\n\tsum(\"criteria failure responses\".\"number_of_patients\") desc, \"criteria failure responses\".\"country\" asc","dataSource":{"id":1,"name":"sponsor"},"parameters":[{"id":1,"openQuote":"","closeQuote":""},{"id":2,"openQuote":"","closeQuote":""},{"id":3,"openQuote":"","closeQuote":""},{"id":4,"openQuote":"","closeQuote":""},{"id":5,"openQuote":"","closeQuote":""},{"id":6,"openQuote":"","closeQuote":""}]}},{"id":4,"configure":"var customScript = {\n    name: \"customScript\",\n    type:\"custom\",\n    listeners:[\"Protocols\",\"Failures\"],\n    requestParameters :{},\n    efwd : {\n        id: \"19\",\n        file: '__efwd_file_name__'\n    },\n    htmlElementId : \"#dummy\", // provide report id here\n    executeAtStart: false,  // it can be true or false\n    customScript: function() {\n    \n        console.log(\"customScript Triggered\");\n        \n        if(dashboard.getVariable('Protocols').length === 0){\n            console.log(\"Selected Protocols length is Zero !!! \");\n            dashboard.setVariable('Protocols',[\"All Protocols\"]);\n        }\n        if(dashboard.getVariable('Failures').length === 0){\n            console.log(\"Selected Failures length is Zero !!! \");\n            dashboard.setVariable('Failures',[\"All Failures\"]);\n        }\n        dashboard.updateComponent('failure_ParentTable');\n    }\n};\n\nvar tr = null;\nvar row = null;\n$(document).on('click', '.criteria-failure-codes', function (e) {\n    if(tr != null){\n        tr.css('background-color', 'transparent');\n    }\n\t\ttr = $(this).closest('tr');\n\t\ttr.css('background-color', 'whitesmoke');\n        const allRows = document.querySelectorAll(\"#table tr\");\n        allRows.forEach((searchTargetRow) => {\n            var row_in = table.row(searchTargetRow);\n            if (row_in.child && row_in.child.isShown() ) {\n\t\t\trow_in.child.hide();\n\t\t\t//row_in.removeClass('shown');\n\t\t    }\n        });\n        \n\t\trow = table.row(tr);\n\t\tvar rowData = row.data();\n\t\tconsole.log(\"selected code:\",rowData[3]);\n\t\tdashboard.setVariable('selected_criteria_code',rowData[3]);\n\t\tif ( row.child.isShown() ) {\n\t\t\t\n\t\t\trow.child.hide();\n\t\t\ttr.removeClass('shown');\n\t\t}\n\t\telse {\t    \n\t\t\ttr.addClass('shown');\n\t\t\trow.child(createDiv()).show();\n\t\t\t$('td', row.child()).css({'background-color': '#e5e7eb'});\n\t\t\tdashboard.removeComponent([failure_by_site]);\n\t\t\tdashboard.addComponent([failure_by_site]);\n\t\t\tdashboard.removeComponent([failure_by_country]);\n\t\t\tdashboard.addComponent([failure_by_country]);\n\t\t\t$('#failure_by_country')[0].hidden=true;\n\t\t\t$('#bySiteButton')[0].style.borderBottom='3px solid #6dadf1';\n\t\t    var child_table_cont= document.querySelectorAll('#table_child thead tr th')[0];\n\t\t    console.log(\"child Tab:\", child_table_cont);\n\t\t}\n});\nfunction createDiv() {\n     //var html ='<button onclick=\"byCountryClicked()\" id=\"byCountryButton\">By Country<\/button><button onclick=\"bySiteClicked()\" id=\"bySiteButton\">By Site<\/button><button onclick=\"closeClicked()\" id=\"closeButton\">Close<\/button><div id=\"failure_by_site\"><\/div>'+'<div id=\"failure_by_country\"><\/div>';\n     var html=\"<div id='nested_tables'>\" \n                +\"<div id='table_for_header'>\"\n                 +\"<table style='width: 100%;'><thead><tr>\"\n                  +\"<th class='colH_0' style='width:126px;padding-top: 0px;padding-bottom: 0px;vertical-align: bottom'>\"\n                  +\"<button onclick='byCountryClicked()' id='byCountryButton'>By Country<\/button>\"\n                  +\"<button onclick='bySiteClicked()' id='bySiteButton'>By Site<\/button><\/th>\"\n                  +\"<th class='colH_1' style='width:115px'><\/th>\"\n                  +\"<th class='colH_2' style='width:115px'><\/th>\"\n                  +\"<th class='colH_3' style='min-width:10rem'><span id='site_or_country' style='font-family: Lato'>Site<\/span>\"\n                  +\"<button onclick='closeClicked()' id='closeButton'>Close<\/button><\/th>\"\n                 +\"<\/tr><\/thead><\/table>\"\n                +\"<\/div>\"\n               +\"<div id='failure_by_site'><\/div>\"\n               +\"<div id='failure_by_country'><\/div><\/div>\";\n    return html ;\n}\nfunction bySiteClicked() {\n$('#site_or_country').text('Site');\n$('#failure_by_country')[0].hidden=true;\n$('#failure_by_site')[0].hidden=false;\n$('#bySiteButton')[0].style.borderBottom='3px solid #6dadf1';\n$('#byCountryButton')[0].style.borderBottom='none';\n}\nfunction byCountryClicked() {\n$('#site_or_country').text('Country');\n$('#failure_by_country')[0].hidden=false;\n$('#failure_by_site')[0].hidden=true;\n$('#byCountryButton')[0].style.borderBottom='3px solid #6dadf1';\n$('#bySiteButton')[0].style.borderBottom='none';\n}\nfunction closeClicked() {\ntr.css('background-color', 'transparent');\nrow.child.hide();\ntr.removeClass('shown');\n}","visualisation":"","name":"customScript","vizName":"Custom","type":"Custom","icon":"VF","sql":{"id":19,"type":"sql","text":"select 1 as one","dataSource":{"id":1,"name":"sponsor"},"parameters":[]}}],"currentEditor":{"type":"reports","name":"customScript","component":"sql"},"sqlList":[{"id":1,"type":"sql","text":"select \r\n\tcast(round((sum(number_of_patients)/max(sum_by_trial))*100,0) as int) as \"bar value\",\r\n \tsum(\"criteria failure responses\".\"number_of_patients\") as \"# of Patients\",\r\n \tconcat(cast(round((sum(number_of_patients)/max(sum_by_trial))*100,0) as text), '%') as \"Percentage\",\r\n \t\"criteria failure responses\".\"failed_criteria\" as \"Failed Criteria\",\r\n \t\"criteria failure responses\".\"failed_criteria_text\" as \"Failed Criteria text\" \r\nfrom\r\n\t(WITH rawdata AS(\r\nSELECT\r\ncast('9bb8a8ec-657c-5689-9a77-7f1c0004746c' as uuid) as trial_id,'Moonlight' as trial_name\r\n--T.id as trial_id,T.name as trial_name\r\n,S.id as site_id,S.name as site_name,\r\nSTPV.id as patient_id,\r\ncase when criterion_type='inclusion' then CONCAT('Inc ',custom_identifier) else CONCAT('Enc ',custom_identifier) END AS Criteria,\r\nresponse,\r\nQ.question_text,\r\nIEC.created_at,\r\nA.created_at AS acreate,\r\nS.country\r\nFROM \"Answer\" AS A\r\nJOIN \"SiteTrialQuestion\" AS STQ ON A.site_trial_question_id = STQ.id\r\nJOIN \"Question\" AS Q ON Q.id = STQ.question_id\r\nJOIN \"InclusionExclusionCriteriaQuestion\" IECQ ON IECQ.question_id = Q.id\r\nJOIN \"InclusionExclusionCriteria\" IEC ON IECQ.ie_criteria_id = IEC.id\r\nRIGHT JOIN \"SiteTrialPatientView\" AS STPV ON STPV.id = A.site_trial_patient_id\r\nJOIN \"SiteTrialView\" AS STV ON STV.id = STQ.site_trial_id\r\nJOIN \"Trial\" AS T ON T.id = sponsor_trial_id AND T.id = IEC.trial_id\r\nJOIN \"Site\" AS S ON S.id = STV.site_id\r\nWhere STV.is_pseudo = false AND S.is_pseudo = false AND T.is_pseudo = false\r\nAND STV.ie_criteria_checklist_enabled = true\r\nAND ((response = 'Yes' AND criterion_type = 'exclusion') OR (response = 'No' AND criterion_type = 'inclusion'))\r\nAND S.id in ('e50cf7ba-8af4-59a0-a9f9-66a11458ae6b','dbf541f8-cf90-5d6e-8c9a-6b2659a9c527')\r\nAND T.id in ('0b39999c-6048-5a21-82ba-e49441b1b034','9bb8a8ec-657c-5689-9a77-7f1c0004746c')\r\nAND stage != 'archive'\r\n),\r\nmaxcreation AS (\r\nSELECT a.trial_name,a.trial_id, a.site_name,a.site_id,\r\nRANK() OVER(\r\nPARTITION BY a.trial_name,a.site_name\r\nORDER BY COUNT(a.Criteria) DESC) AS ranking,\r\na.Criteria,\r\nCOUNT(a.Criteria) AS Number_of_patients,\r\na.question_text,\r\na.country\r\nFROM rawdata AS a\r\nINNER JOIN (\r\n  SELECT trial_name,site_name, MAX(created_at) AS creation\r\n  FROM rawdata\r\n  GROUP BY trial_name,site_name) b ON a.trial_name = b.trial_name and a.site_name = b.site_name\r\nWHERE a.created_at = b.creation\r\nAND a.acreate > a.created_at\r\nGROUP BY a.trial_name, a.trial_id,a.site_name, a.site_id, a.criteria, a.question_text,a.country\r\n)\r\nselect \r\nmc1.site_id,mc1.site_name,mc1.trial_id,mc1.trial_name,mc1.ranking,\r\nmc1.number_of_patients,\r\nsum(mc1.number_of_patients) over(partition by trial_id order by trial_id) as sum_by_trial,\r\nsum(mc1.number_of_patients) over(partition by criteria,question_text order by criteria,question_text) as sum_by_site,\r\nmc1.criteria as failed_criteria,\r\nmc1.question_text as failed_criteria_text,\r\nmc1.country\r\nfrom maxcreation as mc1\r\ngroup by mc1.site_id,mc1.site_name,mc1.trial_id,mc1.trial_name,mc1.ranking,\r\nmc1.number_of_patients,mc1.criteria,mc1.question_text,country\r\norder by mc1.site_id,mc1.trial_id)  \"criteria failure responses\" \r\n\tinner join \"TrialGrant\" on (\"TrialGrant\".\"trial_id\" = \"criteria failure responses\".\"trial_id\") \r\nwhere\r\n\t( ('_all_' = '_all_')  AND ('_all_' = '_all_')  AND ('_all_' = '_all_')) and (\"TrialGrant\".user_id= 'auth0|5a908c0cee5d8b03b618225f') \r\ngroup by\r\n\t\"criteria failure responses\".\"failed_criteria\", \"criteria failure responses\".\"failed_criteria_text\" \r\norder by\r\n\tsum(\"criteria failure responses\".\"number_of_patients\") desc, \"criteria failure responses\".\"failed_criteria\" asc ","dataSource":{"id":1,"name":"connection1"},"parameters":[]},{"id":2,"type":"sql","text":"","dataSource":{},"parameters":[]},{"id":3,"type":"sql","text":"","dataSource":{},"parameters":[]},{"id":4,"type":"sql","text":"select 1 as one,2 as two","dataSource":{"id":1,"name":"connection1"},"parameters":[]},{"id":5,"type":"sql","text":"select \r\n\tcast(round((sum(number_of_patients)/max(sum_by_site))*100,0) as int) as \"bar value\",\r\n \tsum(\"criteria failure responses\".\"number_of_patients\") as \"# of Patients\",\r\n \tconcat(cast(round((sum(number_of_patients)/max(sum_by_site))*100,0) as text), '%') as \"Percentage\",\r\n \t\"criteria failure responses\".\"country\" as \"Country\" \r\nfrom\r\n\t(WITH rawdata AS(\r\nSELECT\r\ncast('9bb8a8ec-657c-5689-9a77-7f1c0004746c' as uuid) as trial_id,'Moonlight' as trial_name\r\n--T.id as trial_id,T.name as trial_name\r\n,S.id as site_id,S.name as site_name,\r\nSTPV.id as patient_id,\r\ncase when criterion_type='inclusion' then CONCAT('Inc ',custom_identifier) else CONCAT('Enc ',custom_identifier) END AS Criteria,\r\nresponse,\r\nQ.question_text,\r\nIEC.created_at,\r\nA.created_at AS acreate,\r\nS.country\r\nFROM \"Answer\" AS A\r\nJOIN \"SiteTrialQuestion\" AS STQ ON A.site_trial_question_id = STQ.id\r\nJOIN \"Question\" AS Q ON Q.id = STQ.question_id\r\nJOIN \"InclusionExclusionCriteriaQuestion\" IECQ ON IECQ.question_id = Q.id\r\nJOIN \"InclusionExclusionCriteria\" IEC ON IECQ.ie_criteria_id = IEC.id\r\nRIGHT JOIN \"SiteTrialPatientView\" AS STPV ON STPV.id = A.site_trial_patient_id\r\nJOIN \"SiteTrialView\" AS STV ON STV.id = STQ.site_trial_id\r\nJOIN \"Trial\" AS T ON T.id = sponsor_trial_id AND T.id = IEC.trial_id\r\nJOIN \"Site\" AS S ON S.id = STV.site_id\r\nWhere STV.is_pseudo = false AND S.is_pseudo = false AND T.is_pseudo = false\r\nAND STV.ie_criteria_checklist_enabled = true\r\nAND ((response = 'Yes' AND criterion_type = 'exclusion') OR (response = 'No' AND criterion_type = 'inclusion'))\r\nAND S.id in ('e50cf7ba-8af4-59a0-a9f9-66a11458ae6b','dbf541f8-cf90-5d6e-8c9a-6b2659a9c527')\r\nAND T.id in ('0b39999c-6048-5a21-82ba-e49441b1b034','9bb8a8ec-657c-5689-9a77-7f1c0004746c')\r\nAND stage != 'archive'\r\n),\r\nmaxcreation AS (\r\nSELECT a.trial_name,a.trial_id, a.site_name,a.site_id,\r\nRANK() OVER(\r\nPARTITION BY a.trial_name,a.site_name\r\nORDER BY COUNT(a.Criteria) DESC) AS ranking,\r\na.Criteria,\r\nCOUNT(a.Criteria) AS Number_of_patients,\r\na.question_text,\r\na.country\r\nFROM rawdata AS a\r\nINNER JOIN (\r\n  SELECT trial_name,site_name, MAX(created_at) AS creation\r\n  FROM rawdata\r\n  GROUP BY trial_name,site_name) b ON a.trial_name = b.trial_name and a.site_name = b.site_name\r\nWHERE a.created_at = b.creation\r\nAND a.acreate > a.created_at\r\nGROUP BY a.trial_name, a.trial_id,a.site_name, a.site_id, a.criteria, a.question_text,a.country\r\n)\r\nselect \r\nmc1.site_id,mc1.site_name,mc1.trial_id,mc1.trial_name,mc1.ranking,\r\nmc1.number_of_patients,\r\nsum(mc1.number_of_patients) over(partition by trial_id order by trial_id) as sum_by_trial,\r\nsum(mc1.number_of_patients) over(partition by criteria,question_text order by criteria,question_text) as sum_by_site,\r\nmc1.criteria as failed_criteria,\r\nmc1.question_text as failed_criteria_text,\r\nmc1.country\r\nfrom maxcreation as mc1\r\ngroup by mc1.site_id,mc1.site_name,mc1.trial_id,mc1.trial_name,mc1.ranking,\r\nmc1.number_of_patients,mc1.criteria,mc1.question_text,country\r\norder by mc1.site_id,mc1.trial_id)  \"criteria failure responses\" \r\nwhere\r\n\t( \"criteria failure responses\".\"trial_id\" = '9bb8a8ec-657c-5689-9a77-7f1c0004746c'    AND ('_all_' = '_all_') AND \"criteria failure responses\".\"failed_criteria\" = 'Enc 3'  ) \r\ngroup by\r\n\t\"criteria failure responses\".\"country\" \r\norder by\r\n\tsum(\"criteria failure responses\".\"number_of_patients\") desc, \"criteria failure responses\".\"country\" asc","dataSource":{"id":1,"name":"connection1"},"parameters":[]},{"id":6,"type":"sql","text":"select distinct t.id as trial_id from \"Trial\" t\r\ninner join \"TrialGrant\" tg on t.id=tg.trial_id\r\nwhere tg.user_id = ${user_name}","dataSource":{"id":1,"name":"connection1"},"parameters":[{"id":2,"openQuote":"","closeQuote":""}]},{"id":7,"type":"sql","text":"","dataSource":{"id":1,"name":"connection1"},"parameters":[]},{"id":8,"type":"sql","text":"","dataSource":{},"parameters":[]},{"id":9,"type":"sql","text":"","dataSource":{},"parameters":[]},{"id":10,"type":"sql","text":"","dataSource":{},"parameters":[]},{"id":11,"type":"sql","text":"","dataSource":{"id":1,"name":"connection1"},"parameters":[]},{"id":12,"type":"sql","text":"","dataSource":{"id":1,"name":"connection1"},"parameters":[]},{"id":13,"type":"sql","text":"select distinct cast(st.id as text) as site_trial_id from \"SiteTrialPatientView\" stp\r\nJOIN \"SiteTrialRead\" st ON stp.site_trial_id = st.id and st.is_pseudo=false\r\nJOIN \"Trial\" trial  ON st.sponsor_trial_id = trial.id  and trial.is_pseudo=false\r\nJOIN \"TrialGrant\" TG on TG.trial_id = trial.id\r\nwhere \r\n(('_all_'=${Trials}) or (cast(trial.id as text) = ${Trials}))\r\nAND TG.user_id = 'auth0|5b242f33c622dc3967ae3822'","dataSource":{"id":1,"name":"connection1"},"parameters":[{"id":2,"openQuote":"","closeQuote":""},{"id":1,"openQuote":"","closeQuote":""}]},{"id":14,"type":"sql","text":"select protocol_name_and_version from \r\n\t(select 'All Protocols' as protocol_name_and_version,now() as created_at \r\n\tUNION\r\n\tselect distinct protocol_name_and_version,IEC.created_at from \"InclusionExclusionCriteria\" IEC\r\n\tJOIN \"Trial\" AS T ON T.id = IEC.trial_id\r\n\tJOIN \"TrialGrant\" TG on TG.trial_id = T.id\r\n\twhere (('_all_'=${Trials}) or (cast(T.id as text) = ${Trials}))\r\n    AND TG.user_id = 'auth0|5b242f33c622dc3967ae3822'\r\n\t) as protocals\r\norder by created_at desc","dataSource":{"id":1,"name":"connection1"},"parameters":[{"id":1,"openQuote":"","closeQuote":""},{"id":2,"openQuote":"","closeQuote":""}]},{"id":15,"type":"sql","text":"select display_col,passing_col from (\r\nselect 'All Failures' as display_col,'All Failures' as passing_col,1 as list_order\r\nunion\r\nselect 'Pre-screen Failure' as display_col,'pre-screen-failure' as passing_col,2 as list_order\r\nunion\r\nselect 'Screen Failure' as display_col,'screen-failure' as passing_col,3 as list_order\r\nunion\r\nselect 'Potential Candidate' as display_col,'potential-candidate' as passing_col,4 as list_order\r\nunion\r\nselect 'Pre-Screening' as display_col,'pre-screening' as passing_col,5 as list_order\r\nunion\r\nselect 'First Visit Scheduled' as display_col,'first-visit-scheduled' as passing_col,6 as list_order\r\nunion\r\nselect 'In-Screening' as display_col,'in-screening' as passing_col,7 as list_order\r\nunion\r\nselect 'Actively Enrolled' as display_col,'enrolled' as passing_col,8 as list_order\r\nunion\r\nselect 'Completed' as display_col,'completed' as passing_col,9 as list_order\r\nunion\r\nselect 'Discontinued' as display_col,'discontinued' as passing_col,10 as list_order\r\n) as body\r\norder by list_order","dataSource":{"id":1,"name":"sponsor"},"parameters":[]},{"id":16,"type":"sql","text":"","dataSource":{},"parameters":[]},{"id":17,"type":"sql","text":"select 1 as one","dataSource":{"id":1,"name":"sponsor"},"parameters":[]},{"id":18,"type":"sql","text":"","dataSource":{},"parameters":[]},{"id":19,"type":"sql","text":"select 1 as one","dataSource":{"id":1,"name":"sponsor"},"parameters":[]}],"aceText":"select 1 as one","uuid":"2c32d272-b7a7-444f-bb15-ec4577fafa5f","showDatasource":true,"showDashboard":false,"showParameter":true,"showReport":true,"Editor":{"type":"","name":"","component":"","aceText":"select 1 as one"},"editing":false,"isEditor":""},"htmlString":"<div>\n<div id=\"divfailure\" class=\"col-xs-6 col-sm-3 col-lg-2 inputControl\">\n        <div id=\"Failures\"><\/div>\n<\/div>\n<div id=\"divprotocol\" class=\"col-xs-6 col-sm-3 col-lg-2 inputControl\">\n        <div id=\"Protocols\"><\/div>\n<\/div>\n<\/div>\n<div id=\"Trials\"><\/div>\n<div id=\"SiteTrials\"><\/div>\n<div id=\"failure_ParentTable\"><\/div>\n<div id=\"dummy\"><\/div>\n","cssString":".bar-chart-bar {\r\n    display: block; \r\n    position:relative; \r\n\tfloat: right;\r\n    height: 15px;\r\n}\r\n#table th {\r\n    border-bottom: 1px solid #dadada;\r\n    position: sticky;\r\n    box-shadow: #dee1e3 0px 2px 2px 0px;\r\n}\r\n#table_child thead,#table_child2 thead{\r\n    visibility: collapse;\r\n}\r\n#main-table-bars{\r\n    margin-left: 10px ! important;\r\n}\r\n#table_for_header thead tr th{\r\n    background-color: #f6f6f6;\r\n    font-weight: normal;\r\n    font-family: Lato;\r\n    color: #777d94;\r\n    text-align: left;\r\n    padding: 1rem;\r\n    padding-left: 1.5rem;\r\n}\r\n#table_for_header thead,#chart_2, #chart_3{\r\n    border: 1px solid lightgray;\r\n}\r\n#nested_tables{\r\n    padding: 5px;\r\n}\r\n.criteria-failure-codes {\r\n    display: inline-block;\r\n    border: 1px solid #DADADA;\r\n    background: #F9F9FA;\r\n    padding: .3rem;\r\n    border-radius: .3rem;\r\n    font-size: 1.1rem;\r\n    font-family: Lato;\r\n    cursor: pointer;\r\n}\r\n.dataTables_filter{\r\n float: left ! important;\r\n margin-top: -35px;\r\n}\r\n\r\n#table .colH_1, .col_1, .colH_2, .col_2,#table_child .colH_1, .col_1, .colH_2, .col_2,#table_child2 .colH_1, .col_1, .colH_2, .col_2{\r\n    text-align: right ! important;\r\n    justify-content: flex-end ! important;\r\n   // font-weight: bold ! important;\r\n    \r\n} \r\n#table .col_1, .col_2,#table_child .col_1, .col_2,#table_child2 .col_1, .col_2{\r\n    font-size: 1.3rem ! important;\r\n}\r\n#table .colH_3, .col_3,#table_child .colH_3, .col_3,#table_child2 .colH_3, .col_3{\r\n    padding-left: 5rem ! important;\r\n    \r\n}\r\n#table .colH_0,.colH_4{\r\n    border-left: none ! important;\r\n}\r\ndetails[open] .elipsisSpan { \r\n  display:none;\r\n}\r\nsummary{\r\n    outline: none;\r\n    display: list-item;\r\n}\r\n#bySiteButton, #byCountryButton, #closeButton {\r\n    padding-left: 5px;\r\n    padding-right: 5px;\r\n    font-family: Lato;\r\n    font-weight: bold;\r\n    //font-size: 1.3rem;\r\n    color: #777d94;\r\n    background: #f6f6f6;\r\n    border: none;\r\n    outline:none;\r\n}\r\n#closeButton{\r\n    float:right;\r\n}\r\n#bySiteButton{\r\n    float: right;\r\n    padding-bottom: 7px;\r\n\tmargin: 0px -7px;\r\n}\r\n#byCountryButton{\r\n    padding-bottom: 7px;\r\n\tmargin: 0px 9px;\r\n}\r\n#table_child, #table_child2{\r\n    //padding: 5px;\r\n    border: none;\r\n}\r\n#Trials, #SiteTrials{\r\n    display: none;\r\n}\r\n#divprotocol{\r\n    float: right;\r\n    padding: 2px;\r\n}\r\n#divfailure{\r\n    float: right;\r\n    padding: 2px;\r\n}\r\n#Protocols .form-control, #Failures .form-control{\r\n    font-family: Lato;\r\n    font-weight: bold;\r\n    color: #777d94;\r\n}\r\n.select2-container-multi .select2-choices{\r\n    border-radius: 4px;\r\n    min-height: 40px ! important;\r\n    color: #dadada;\r\n    border-color: #cdcdcd;\r\n    max-height: 100px;\r\n    overflow-y: auto;\r\n}\r\n.select2-container-multi .select2-choices .select2-search-choice{\r\n    border-radius: 2px;\r\n    background-color: rgba(0,126,255,0.08);\r\n    border: 1px solid rgba(0,126,255,0.24);\r\n    color: #007eff;\r\n    display: inline-block;\r\n    vertical-align: top;\r\n    margin-top: 5px;\r\n    margin-left: 5px;\r\n    max-width: 90%;\r\n}\r\n.select2-search-choice div{\r\n    padding: 2px;\r\n    padding-left: 7px;\r\n    color: #60A5EB;\r\n    text-overflow: initial;\r\n    overflow: auto;\r\n    white-space: normal;\r\n    word-break: break-word;\r\n    hyphens: none;\r\n    //border-left: 1px solid rgba(0,126,255,0.24);\r\n}\r\n.select2-search-choice-close{\r\n    height: 100%;\r\n    top: 0px ! important;\r\n    left: 0px ! important;\r\n    border-right: 1px solid rgba(0,126,255,0.24);\r\n    width: 18px;\r\n    /*\r\n    padding-bottom: 25px;\r\n    margin-top: -4px;\r\n    padding-left: 18px;\r\n    */\r\n}\r\n.select2-search-choice-close:before{\r\n    color: #007eff;\r\n    font-weight: 100;\r\n    font-size: 12px;\r\n    top: 20%;\r\n    /*\r\n    margin-top: 5px;\r\n    margin-left: -1px;\r\n    */\r\n}\r\n.select2-container-multi .select2-choices .select2-search-field input{\r\n    font-family: Arial !important;\r\n    font-style: italic;\r\n    color: #a4a8b4 ! important;\r\n    line-height: 1.6em;\r\n}\r\n.select2-drop-active{\r\n    border: 1px solid #cdcdcd;\r\n    border-top: 1px solid #cdcdcd;\r\n}\r\n.select2-results{\r\n    /*font-family: Arial !important; */\r\n    /* font-style: italic; */\r\n    color: #595f75 ! important;\r\n    line-height: 1.6em;\r\n    font-family: Lato;\r\n}\r\n.select2-results .select2-highlighted{\r\n    background: #f6f6f6;\r\n    color: #595f75;\r\n}\r\n","configurations":{"parameters":[{"parameter":{"id":"1","name":"Trials","value":"var dashboard = Dashboard \n dashboard.resetAll() \n  \n        dashboard.setVariable('Trials',[\"_all_\"]);\nvar Trials = {\n    name: \"Trials\" ,\n    type:  \"select2\",\n    parameters: ['Trials'],\n    listeners: ['Protocols'], //,'Protocols','Failures'\n    requestParameters: { 'user_name': 'user_name'},\n    options:{\n        all: true,\n        multiple: true,             // it can be true or false\n        display : 'trial_id',\n        value : 'trial_id'\n    },\n    htmlElementId : \"#Trials\",              \n    executeAtStart: true,            // it can be true or false\n    map: 6,\n    efwd : {\n        file: '__efwd_file_name__'\n    },\n};\n "}},{"parameter":{"id":"2","name":"user_name","value":"//DashboardGlobals.sessionUserName\n//'auth0|5b242f33c622dc3967ae3822'\ndashboard.setVariable('user_name',DashboardGlobals.sessionUserName);\nvar user_name = {\n    name: \"user_name\" ,\n    type:  \"select2\", \n    options:{\n        multiple: false,             // it can be true or false\n        display : 'column_name',\n        value : 'column_name',\n        placeholder: 'select value'\n    },\n    htmlElementId : \"#user_name\",              \n    executeAtStart: false,            // it can be true or false\n    map: 7,\n    efwd : {\n        file: '__efwd_file_name__'\n    },\n};\nconsole.log(\"Logged in User: \",dashboard.getVariable('user_name'));\n"}},{"parameter":{"id":"3","name":"selected_criteria_code","value":"dashboard.setVariable('selected_criteria_code','Inc 1');\nvar selected_criteria_code = {\n    name: \"selected_criteria_code\" ,\n    type:  \"select2\",             \n    options:{\n        multiple: false,             // it can be true or false\n        display : 'column_name',\n        value : 'column_name',\n        placeholder: 'select value'\n    },\n    htmlElementId : \"#selected_criteria_code\",              \n    executeAtStart: false,            // it can be true or false\n    map: 12,\n    efwd : {\n        file: '__efwd_file_name__'\n    },\n};\n"}},{"parameter":{"id":"4","name":"SiteTrials","value":"dashboard.setVariable('SiteTrials',[\"_all_\"]);\nvar SiteTrials = {\n    name: \"SiteTrials\" ,\n    type:  \"select2\",          \n    listeners: ['Trials'],\n    parameters:[\"SiteTrials\"],\n    requestParameters: {'Trials': 'Trials', 'user_name': 'user_name'},\n    options:{\n        all: true,\n        multiple: true,             // it can be true or false\n        display : 'site_trial_id',\n        value : 'site_trial_id'\n    },\n    htmlElementId : \"#SiteTrials\",              \n    executeAtStart: true,            // it can be true or false\n    map: 13,\n    efwd : {\n        file: '__efwd_file_name__'\n    },\n};\n"}},{"parameter":{"id":"5","name":"Protocols","value":"dashboard.setVariable('Protocols',[\"All Protocols\"]);\nvar Protocols = {\n    name: \"Protocols\" ,\n    type:  \"select2\",             \n    parameters:[\"Protocols\"],\n    listeners: ['Trials'],\n    requestParameters: {'Trials': 'Trials', 'user_name': 'user_name'},\n    options:{\n        multiple: true,             // it can be true or false\n        display : 'protocol_name_and_version',\n        value : 'protocol_name_and_version',\n        placeholder: 'All Protocols'\n    },\n    htmlElementId : \"#Protocols\",              \n    executeAtStart: true,            // it can be true or false\n    map: 14,\n    efwd : {\n        file: '__efwd_file_name__'\n    },\n};\n"}},{"parameter":{"id":"6","name":"Failures","value":"dashboard.setVariable('Failures',[\"All Failures\"]);\nvar Failures = {\n    name: \"Failures\" ,\n    type:  \"select2\",             \n    parameters:[\"Failures\"],\n    requestParameters: {'Trials': 'Trials', 'user_name': 'user_name','SiteTrials': 'SiteTrials','Protocols': 'Protocols'},\n    options:{\n        multiple: true,             // it can be true or false\n        display : 'display_col',\n        value : 'passing_col',\n        placeholder: 'All Failures'\n    },\n    htmlElementId : \"#Failures\",              \n    executeAtStart: true,            // it can be true or false\n    map: 15,\n    efwd : {\n        file: '__efwd_file_name__'\n    },\n};\n"}}],"reports":[{"report":{"id":"1","name":"failure_ParentTable","value":"var table = [];\nvar failure_ParentTable = {\n    name: \"failure_ParentTable\",\n    type:\"chart\",\n    listeners: ['SiteTrials','Trials'], //,'Protocols','Failures'\n    requestParameters: {'Trials': 'Trials', 'user_name': 'user_name','SiteTrials': 'SiteTrials','Protocols': 'Protocols','Failures': 'Failures'},\n    vf : {\n        id: \"1\",\n        file: '__efwvf_name__'\n    },\n    efwd : {\n        file: '__efwd_file_name__'\n    },\n    htmlElementId : \"#failure_ParentTable\", // provide report id here\n    executeAtStart: true  // it can be true or false\n};\n"}},{"report":{"id":"2","name":"failure_by_site","value":"var failure_by_site = {\n    name: \"failure_by_site\",\n    type:\"chart\",\n    requestParameters: {'Trials': 'Trials', 'user_name': 'user_name','selected_criteria_code': 'selected_criteria_code','SiteTrials': 'SiteTrials','Protocols': 'Protocols','Failures': 'Failures'},\n    vf : {\n        id: \"2\",\n        file: '__efwvf_name__'\n    },\n    efwd : {\n        file: '__efwd_file_name__'\n    },\n    htmlElementId : \"#failure_by_site\", // provide report id here\n    executeAtStart: true  // it can be true or false\n};\n"}},{"report":{"id":"3","name":"failure_by_country","value":"var failure_by_country = {\n    name: \"failure_by_country\",\n    type:\"chart\",\n    requestParameters: { 'Trials': 'Trials', 'user_name': 'user_name','selected_criteria_code': 'selected_criteria_code','SiteTrials': 'SiteTrials','Protocols': 'Protocols','Failures': 'Failures'},\n    vf : {\n        id: \"3\",\n        file: '__efwvf_name__'\n    },\n    efwd : {\n        file: '__efwd_file_name__'\n    },\n    htmlElementId : \"#failure_by_country\", // provide report id here\n    executeAtStart: true  // it can be true or false\n};\n"}},{"report":{"id":"4","name":"customScript","value":"var customScript = {\n    name: \"customScript\",\n    type:\"custom\",\n    listeners:[\"Protocols\",\"Failures\"],\n    requestParameters :{},\n    efwd : {\n        id: \"19\",\n        file: '__efwd_file_name__'\n    },\n    htmlElementId : \"#dummy\", // provide report id here\n    executeAtStart: false,  // it can be true or false\n    customScript: function() {\n    \n        console.log(\"customScript Triggered\");\n        \n        if(dashboard.getVariable('Protocols').length === 0){\n            console.log(\"Selected Protocols length is Zero !!! \");\n            dashboard.setVariable('Protocols',[\"All Protocols\"]);\n        }\n        if(dashboard.getVariable('Failures').length === 0){\n            console.log(\"Selected Failures length is Zero !!! \");\n            dashboard.setVariable('Failures',[\"All Failures\"]);\n        }\n        dashboard.updateComponent('failure_ParentTable');\n    }\n};\n\nvar tr = null;\nvar row = null;\n$(document).on('click', '.criteria-failure-codes', function (e) {\n    if(tr != null){\n        tr.css('background-color', 'transparent');\n    }\n\t\ttr = $(this).closest('tr');\n\t\ttr.css('background-color', 'whitesmoke');\n        const allRows = document.querySelectorAll(\"#table tr\");\n        allRows.forEach((searchTargetRow) => {\n            var row_in = table.row(searchTargetRow);\n            if (row_in.child && row_in.child.isShown() ) {\n\t\t\trow_in.child.hide();\n\t\t\t//row_in.removeClass('shown');\n\t\t    }\n        });\n        \n\t\trow = table.row(tr);\n\t\tvar rowData = row.data();\n\t\tconsole.log(\"selected code:\",rowData[3]);\n\t\tdashboard.setVariable('selected_criteria_code',rowData[3]);\n\t\tif ( row.child.isShown() ) {\n\t\t\t\n\t\t\trow.child.hide();\n\t\t\ttr.removeClass('shown');\n\t\t}\n\t\telse {\t    \n\t\t\ttr.addClass('shown');\n\t\t\trow.child(createDiv()).show();\n\t\t\t$('td', row.child()).css({'background-color': '#e5e7eb'});\n\t\t\tdashboard.removeComponent([failure_by_site]);\n\t\t\tdashboard.addComponent([failure_by_site]);\n\t\t\tdashboard.removeComponent([failure_by_country]);\n\t\t\tdashboard.addComponent([failure_by_country]);\n\t\t\t$('#failure_by_country')[0].hidden=true;\n\t\t\t$('#bySiteButton')[0].style.borderBottom='3px solid #6dadf1';\n\t\t    var child_table_cont= document.querySelectorAll('#table_child thead tr th')[0];\n\t\t    console.log(\"child Tab:\", child_table_cont);\n\t\t}\n});\nfunction createDiv() {\n     //var html ='<button onclick=\"byCountryClicked()\" id=\"byCountryButton\">By Country<\/button><button onclick=\"bySiteClicked()\" id=\"bySiteButton\">By Site<\/button><button onclick=\"closeClicked()\" id=\"closeButton\">Close<\/button><div id=\"failure_by_site\"><\/div>'+'<div id=\"failure_by_country\"><\/div>';\n     var html=\"<div id='nested_tables'>\" \n                +\"<div id='table_for_header'>\"\n                 +\"<table style='width: 100%;'><thead><tr>\"\n                  +\"<th class='colH_0' style='width:126px;padding-top: 0px;padding-bottom: 0px;vertical-align: bottom'>\"\n                  +\"<button onclick='byCountryClicked()' id='byCountryButton'>By Country<\/button>\"\n                  +\"<button onclick='bySiteClicked()' id='bySiteButton'>By Site<\/button><\/th>\"\n                  +\"<th class='colH_1' style='width:115px'><\/th>\"\n                  +\"<th class='colH_2' style='width:115px'><\/th>\"\n                  +\"<th class='colH_3' style='min-width:10rem'><span id='site_or_country' style='font-family: Lato'>Site<\/span>\"\n                  +\"<button onclick='closeClicked()' id='closeButton'>Close<\/button><\/th>\"\n                 +\"<\/tr><\/thead><\/table>\"\n                +\"<\/div>\"\n               +\"<div id='failure_by_site'><\/div>\"\n               +\"<div id='failure_by_country'><\/div><\/div>\";\n    return html ;\n}\nfunction bySiteClicked() {\n$('#site_or_country').text('Site');\n$('#failure_by_country')[0].hidden=true;\n$('#failure_by_site')[0].hidden=false;\n$('#bySiteButton')[0].style.borderBottom='3px solid #6dadf1';\n$('#byCountryButton')[0].style.borderBottom='none';\n}\nfunction byCountryClicked() {\n$('#site_or_country').text('Country');\n$('#failure_by_country')[0].hidden=false;\n$('#failure_by_site')[0].hidden=true;\n$('#byCountryButton')[0].style.borderBottom='3px solid #6dadf1';\n$('#bySiteButton')[0].style.borderBottom='none';\n}\nfunction closeClicked() {\ntr.css('background-color', 'transparent');\nrow.child.hide();\ntr.removeClass('shown');\n}"}}]},"efwd":{"dataSources":{"connections":[{"connection":{"id":"1","type":"global.jdbc","connDetails":{"globalId":"2"}}}]},"dataMaps":[{"dataMap":{"name":"Trials","id":"6","type":"sql","connection":"1","query":"select distinct cast(t.id as text) as trial_id from \"Trial\" t\r\ninner join \"TrialGrant\" tg on t.id=tg.trial_id\r\nwhere tg.user_id = ${user_name}","parameters":[{"parameter":{"default":"","name":"user_name","type":"String"}}]}},{"dataMap":{"name":"SiteTrials","id":"13","type":"sql","connection":"1","query":"select distinct cast(stp.site_trial_id as text) as site_trial_id from \"SiteTrialPatientView\" stp\r\nJOIN \"SiteTrialRead\" st ON stp.site_trial_id = st.id and st.is_pseudo=false\r\nJOIN \"Trial\" trial  ON st.sponsor_trial_id = trial.id  and trial.is_pseudo=false\r\nJOIN \"TrialGrant\" TG on TG.trial_id = trial.id\r\nwhere \r\n(('_all_'=${Trials}) or (cast(trial.id as text) = ${Trials}))\r\nAND TG.user_id = ${user_name}","parameters":[{"parameter":{"default":"","name":"user_name","type":"String"}},{"parameter":{"default":"","name":"Trials","type":"Collection"}}]}},{"dataMap":{"name":"Protocols","id":"14","type":"sql","connection":"1","query":"select protocol_name_and_version from \r\n\t(\r\n\tselect distinct protocol_name_and_version,IEC.created_at from \"InclusionExclusionCriteria\" IEC\r\n\tJOIN \"Trial\" AS T ON T.id = IEC.trial_id\r\n\tJOIN \"TrialGrant\" TG on TG.trial_id = T.id\r\n\twhere (('_all_'=${Trials}) or (cast(T.id as text) = ${Trials}))\r\n    AND TG.user_id = ${user_name}\r\n\t) as protocals\r\norder by created_at desc","parameters":[{"parameter":{"default":"","name":"Trials","type":"Collection"}},{"parameter":{"default":"","name":"user_name","type":"String"}}]}},{"dataMap":{"name":"Failures","id":"15","type":"sql","connection":"1","query":"select\r\nCASE WHEN STPV.stage = 'potential-candidate' THEN 'Potential Candidate' ELSE\r\n  CASE WHEN STPV.stage = 'pre-screening' THEN 'Pre-Screening' ELSE\r\n\tCASE WHEN STPV.stage = 'first-visit-scheduled' THEN 'First Visit Scheduled' ELSE\r\n\t  CASE WHEN STPV.stage = 'in-screening' THEN 'In-Screening' ELSE\r\n\t\tCASE WHEN STPV.stage = 'enrolled' THEN 'Actively Enrolled' ELSE\r\n\t\t  CASE WHEN STPV.stage = 'completed' THEN 'Completed' ELSE\r\n\t\t\tCASE WHEN STPV.stage = 'pre-screen-failure' THEN 'Pre-screen Failure' ELSE\r\n\t\t\t\tCASE WHEN STPV.stage = 'screen-failure' THEN 'Screen Failure' ELSE\r\n\t\t\t\t\tCASE WHEN STPV.stage = 'discontinued' THEN 'Discontinued' ELSE 'Other' END END END END END END END END END as display_col,\r\nSTPV.stage as passing_col,\r\nCASE WHEN STPV.stage = 'pre-screen-failure' THEN 1 ELSE\r\n CASE WHEN STPV.stage = 'screen-failure' THEN 2 ELSE\r\n\tCASE WHEN STPV.stage = 'potential-candidate' THEN 3 ELSE\r\n\t  CASE WHEN STPV.stage = 'pre-screening' THEN 4 ELSE\r\n\t\tCASE WHEN STPV.stage = 'first-visit-scheduled' THEN 5 ELSE\r\n\t\t  CASE WHEN STPV.stage = 'in-screening' THEN 6 ELSE\r\n\t\t\tCASE WHEN STPV.stage = 'enrolled' THEN 7 ELSE\r\n\t\t\t  CASE WHEN STPV.stage = 'completed' THEN 8 ELSE\t\t\r\n\t\t\t\tCASE WHEN STPV.stage = 'discontinued' THEN 9 ELSE 10 END END END END END END END END END AS list_order\r\nfrom \r\n(select distinct STPV.stage from \"Answer\" AS A\r\nJOIN \"SiteTrialQuestion\" AS STQ ON A.site_trial_question_id = STQ.id\r\nJOIN \"Question\" AS Q ON Q.id = STQ.question_id\r\nJOIN \"InclusionExclusionCriteriaQuestion\" IECQ ON IECQ.question_id = Q.id\r\nJOIN \"InclusionExclusionCriteria\" IEC ON IECQ.ie_criteria_id = IEC.id\r\nRIGHT JOIN \"SiteTrialPatientView\" AS STPV ON STPV.id = A.site_trial_patient_id\r\nJOIN \"SiteTrialView\" AS STV ON STV.id = STQ.site_trial_id and STV.is_pseudo = false\r\nJOIN \"Trial\" AS T ON T.id = sponsor_trial_id AND T.id = IEC.trial_id AND T.is_pseudo = false\r\nJOIN \"TrialGrant\" TG on TG.trial_id = T.id\r\nJOIN \"Site\" AS S ON S.id = STV.site_id AND S.is_pseudo = false\r\nWhere   \r\nSTV.ie_criteria_checklist_enabled = true\r\nAND stage != 'archive'\r\nAND ((response = 'Yes' AND criterion_type = 'exclusion') OR (response = 'No' AND criterion_type = 'inclusion'))\r\nAND TG.user_id = ${user_name}\r\nAND (('_all_'=${Trials}) or (cast(T.id as text) = ${Trials}))\r\nAND (('_all_' in (${SiteTrials})) or (cast(STPV.site_trial_id as text) in (${SiteTrials})))\r\nAND (('All Protocols' in (${Protocols})) or (cast(protocol_name_and_version as text) in (${Protocols})))\r\n)STPV\r\norder by list_order","parameters":[{"parameter":{"default":"","name":"Trials","type":"Collection"}},{"parameter":{"default":"","name":"user_name","type":"String"}},{"parameter":{"default":"","name":"SiteTrials","type":"Collection"}},{"parameter":{"default":"","name":"Protocols","type":"Collection"}}]}},{"dataMap":{"name":"failure_ParentTable","id":"1","type":"sql","connection":"1","query":"select \r\n\tcase when max(sum_by_trial)=0 then 0 else cast(round((sum(number_of_patients)/max(sum_by_trial))*100,0) as int) end as \"bar value\",\r\n \tsum(\"criteria failure responses\".\"number_of_patients\") as \"# of Patients\",\r\n \tcase when max(sum_by_trial)=0 then '0%' else concat(cast(round((sum(number_of_patients)/max(sum_by_trial))*100,0) as text), '%') end as \"Percentage\",\r\n \t\"criteria failure responses\".\"failed_criteria\" as \"Failed Criteria\",\r\n \t\"criteria failure responses\".\"failed_criteria_text\" as \"Failed Criteria text\" \r\nfrom\r\n\t(WITH rawdata AS(\r\nselect * from (\r\nSELECT\r\nT.id as trial_id,T.name as trial_name,\r\nSTPV.id as patient_id,\r\ncriterion_type,\r\ncustom_identifier,\r\ncase when criterion_type='inclusion' then CONCAT('Inc ',custom_identifier) else CONCAT('Exc ',custom_identifier) END AS Criteria,\r\nresponse,\r\nIECQ.question_id,\r\nQ.question_text,\r\nIEC.created_at,\r\nIEC.protocol_name_and_version,\r\nA.created_at AS acreate,\r\nS.country,\r\nstage\r\nFROM \"Answer\" AS A\r\nJOIN \"SiteTrialQuestion\" AS STQ ON A.site_trial_question_id = STQ.id\r\nJOIN \"Question\" AS Q ON Q.id = STQ.question_id\r\nJOIN \"InclusionExclusionCriteriaQuestion\" IECQ ON IECQ.question_id = Q.id\r\nJOIN \"InclusionExclusionCriteria\" IEC ON IECQ.ie_criteria_id = IEC.id\r\nRIGHT JOIN \"SiteTrialPatientView\" AS STPV ON STPV.id = A.site_trial_patient_id\r\nJOIN \"SiteTrialView\" AS STV ON STV.id = STQ.site_trial_id and STV.is_pseudo = false\r\nJOIN \"Trial\" AS T ON T.id = sponsor_trial_id AND T.id = IEC.trial_id AND T.is_pseudo = false\r\nJOIN \"TrialGrant\" TG on TG.trial_id = T.id\r\nJOIN \"Site\" AS S ON S.id = STV.site_id AND S.is_pseudo = false\r\nWhere   \r\nSTV.ie_criteria_checklist_enabled = true\r\nAND stage != 'archive'\r\nAND (('_all_'=${Trials}) or (cast(T.id as text) = ${Trials}))\r\nAND (('_all_' in (${SiteTrials})) or (cast(STPV.site_trial_id as text) in (${SiteTrials})))\r\nAND TG.user_id = 'auth0|5d9234f1bc48890e1d290c57' \r\n) as body\r\nwhere (('All Failures'in (${Failures})) or (cast(stage as text) in (${Failures})))\r\n),\r\nLatestQuestion as (select patient_id,question_id,max(created_at) as created_at\r\nFROM RAWDATA\r\ngroup by patient_id,question_id ),\r\nraw_main as (select r.* from RAWDATA r JOIN LatestQuestion lq on r.patient_id=lq.patient_id and r.question_id = lq.question_id and r.created_at = lq.created_at),\r\nmaxcreation AS (\r\nSELECT raw.trial_name,raw.trial_id,\r\nRANK() OVER(\r\nPARTITION BY raw.trial_name\r\nORDER BY COUNT(raw.Criteria) DESC) AS ranking,\r\nraw.Criteria,\r\nCOUNT(raw.Criteria) AS Number_of_patients,\r\nraw.question_text,\r\nraw.country\r\nFROM raw_main AS raw\r\nINNER JOIN (\r\n  SELECT trial_name, MAX(created_at) AS creation\r\n  FROM raw_main\r\n  GROUP BY trial_name) b ON raw.trial_name = b.trial_name\r\nWHERE\r\nraw.created_at = b.creation \r\nAND (('All Protocols' in (${Protocols})) or (cast(protocol_name_and_version as text) in (${Protocols})))\r\nAND ((response = 'Yes' AND criterion_type = 'exclusion') OR (response = 'No' AND criterion_type = 'inclusion'))\r\nGROUP BY raw.trial_name, raw.trial_id,raw.criteria, raw.question_text,raw.country\r\n)\r\nselect \r\nmc1.trial_id,mc1.trial_name,mc1.ranking,\r\nmc1.number_of_patients,\r\nsum(mc1.number_of_patients) over(partition by trial_id order by trial_id) as sum_by_trial,\r\nsum(mc1.number_of_patients) over(partition by criteria,question_text order by criteria,question_text) as sum_by_site,\r\nmc1.criteria as failed_criteria,\r\nmc1.question_text as failed_criteria_text,\r\nmc1.country\r\nfrom maxcreation as mc1\r\ngroup by mc1.trial_id,mc1.trial_name,mc1.ranking,\r\nmc1.number_of_patients,mc1.criteria,mc1.question_text,country\r\norder by mc1.trial_id)  \"criteria failure responses\" \r\ngroup by\r\n\t\"criteria failure responses\".\"failed_criteria\", \"criteria failure responses\".\"failed_criteria_text\" \r\norder by\r\n\tsum(\"criteria failure responses\".\"number_of_patients\") desc, \"criteria failure responses\".\"failed_criteria\" asc","parameters":[{"parameter":{"default":"","name":"Trials","type":"Collection"}},{"parameter":{"default":"","name":"user_name","type":"String"}},{"parameter":{"default":"","name":"SiteTrials","type":"Collection"}},{"parameter":{"default":"","name":"Protocols","type":"Collection"}},{"parameter":{"default":"","name":"Failures","type":"Collection"}}]}},{"dataMap":{"name":"failure_by_site","id":"4","type":"sql","connection":"1","query":"select \r\n\tcase when max(sum_by_site)=0 then 0 else cast(round((sum(number_of_patients)/max(sum_by_site))*100,0) as int) end as \"bar value\",\r\n \tsum(\"criteria failure responses\".\"number_of_patients\") as \"# of Patients\",\r\n \tcase when max(sum_by_site)=0 then '0%' else concat(cast(round((sum(number_of_patients)/max(sum_by_site))*100,0) as text), '%') end as \"Percentage\",\r\n \t\"criteria failure responses\".\"site_name\" as \"Site\" \r\nfrom\r\n\t(WITH rawdata AS(\r\nselect * from (\r\nSELECT\r\nT.id as trial_id,T.name as trial_name\r\n,S.id as site_id,S.name as site_name,\r\nSTPV.id as patient_id,\r\ncriterion_type,\r\ncustom_identifier,\r\ncase when criterion_type='inclusion' then CONCAT('Inc ',custom_identifier) else CONCAT('Exc ',custom_identifier) END AS Criteria,\r\nresponse,\r\nIECQ.question_id,\r\nQ.question_text,\r\nIEC.created_at,\r\nIEC.protocol_name_and_version,\r\nA.created_at AS acreate,\r\nS.country,\r\nstage\r\nFROM \"Answer\" AS A\r\nJOIN \"SiteTrialQuestion\" AS STQ ON A.site_trial_question_id = STQ.id\r\nJOIN \"Question\" AS Q ON Q.id = STQ.question_id\r\nJOIN \"InclusionExclusionCriteriaQuestion\" IECQ ON IECQ.question_id = Q.id\r\nJOIN \"InclusionExclusionCriteria\" IEC ON IECQ.ie_criteria_id = IEC.id\r\nRIGHT JOIN \"SiteTrialPatientView\" AS STPV ON STPV.id = A.site_trial_patient_id\r\nJOIN \"SiteTrialView\" AS STV ON STV.id = STQ.site_trial_id and STV.is_pseudo = false\r\nJOIN \"Trial\" AS T ON T.id = sponsor_trial_id AND T.id = IEC.trial_id AND T.is_pseudo = false\r\nJOIN \"TrialGrant\" TG on TG.trial_id = T.id\r\nJOIN \"Site\" AS S ON S.id = STV.site_id AND S.is_pseudo = false\r\nWhere   \r\nSTV.ie_criteria_checklist_enabled = true\r\nAND stage != 'archive'\r\nAND (('_all_'=${Trials}) or (cast(T.id as text) = ${Trials}))\r\nAND (('_all_' in (${SiteTrials})) or (cast(STPV.site_trial_id as text) in (${SiteTrials})))\r\nAND TG.user_id = 'auth0|5d9234f1bc48890e1d290c57') as body\r\nwhere (('All Failures'in (${Failures})) or (cast(stage as text) in (${Failures})))\r\n),\r\nLatestQuestion as (select patient_id,question_id,max(created_at) as created_at\r\nFROM RAWDATA\r\ngroup by patient_id,question_id ),\r\nraw_main as (select r.* from RAWDATA r JOIN LatestQuestion lq on r.patient_id=lq.patient_id and r.question_id = lq.question_id and r.created_at = lq.created_at),\r\nmaxcreation AS (\r\nSELECT raw.trial_name,raw.trial_id, raw.site_name,raw.site_id,\r\nRANK() OVER(\r\nPARTITION BY raw.trial_name,raw.site_name\r\nORDER BY COUNT(raw.Criteria) DESC) AS ranking,\r\nraw.Criteria,\r\nCOUNT(raw.Criteria) AS Number_of_patients,\r\nraw.question_text,\r\nraw.country\r\nFROM raw_main AS raw\r\nINNER JOIN (\r\n  SELECT trial_name,site_name, MAX(created_at) AS creation\r\n  FROM raw_main\r\n  GROUP BY trial_name,site_name) b ON raw.trial_name = b.trial_name and raw.site_name = b.site_name\r\nWHERE \r\nraw.criteria=${selected_criteria_code}\r\nAND (('All Protocols' in (${Protocols})) or (cast(protocol_name_and_version as text) in (${Protocols})))\r\nAND raw.created_at = b.creation\r\nAND ((response = 'Yes' AND criterion_type = 'exclusion') OR (response = 'No' AND criterion_type = 'inclusion'))\r\nGROUP BY raw.trial_name, raw.trial_id,raw.site_name, raw.site_id, raw.criteria, raw.question_text,raw.country\r\n)\r\nselect \r\nmc1.site_id,mc1.site_name,mc1.trial_id,mc1.trial_name,mc1.ranking,\r\nmc1.number_of_patients,\r\nsum(mc1.number_of_patients) over(partition by trial_id order by trial_id) as sum_by_trial,\r\nsum(mc1.number_of_patients) over(partition by criteria,question_text order by criteria,question_text) as sum_by_site,\r\nmc1.criteria as failed_criteria,\r\nmc1.question_text as failed_criteria_text,\r\nmc1.country\r\nfrom maxcreation as mc1\r\ngroup by mc1.site_id,mc1.site_name,mc1.trial_id,mc1.trial_name,mc1.ranking,\r\nmc1.number_of_patients,mc1.criteria,mc1.question_text,country\r\norder by mc1.site_id,mc1.trial_id)  \"criteria failure responses\" \r\ngroup by\r\n\t\"criteria failure responses\".\"site_name\" \r\norder by\r\n\tsum(\"criteria failure responses\".\"number_of_patients\") desc, \"criteria failure responses\".\"site_name\" asc","parameters":[{"parameter":{"default":"","name":"Trials","type":"Collection"}},{"parameter":{"default":"","name":"user_name","type":"String"}},{"parameter":{"default":"","name":"selected_criteria_code","type":"String"}},{"parameter":{"default":"","name":"SiteTrials","type":"Collection"}},{"parameter":{"default":"","name":"Protocols","type":"Collection"}},{"parameter":{"default":"","name":"Failures","type":"Collection"}}]}},{"dataMap":{"name":"failure_by_country","id":"5","type":"sql","connection":"1","query":"select \r\n\tcase when max(sum_by_site)=0 then 0 else  cast(round((sum(number_of_patients)/max(sum_by_site))*100,0) as int) end as \"bar value\",\r\n \tsum(\"criteria failure responses\".\"number_of_patients\") as \"# of Patients\",\r\n \tcase when max(sum_by_site)=0 then '0%' else  concat(cast(round((sum(number_of_patients)/max(sum_by_site))*100,0) as text), '%') end as \"Percentage\",\r\n \t\"criteria failure responses\".\"country\" as \"Country\" \r\nfrom\r\n\t(WITH rawdata AS(\r\nselect * from (\r\nSELECT\r\nT.id as trial_id,T.name as trial_name\r\n,S.id as site_id,S.name as site_name,\r\nSTPV.id as patient_id,\r\ncriterion_type,\r\ncustom_identifier,\r\ncase when criterion_type='inclusion' then CONCAT('Inc ',custom_identifier) else CONCAT('Exc ',custom_identifier) END AS Criteria,\r\nresponse,\r\nIECQ.question_id,\r\nQ.question_text,\r\nIEC.created_at,\r\nIEC.protocol_name_and_version,\r\nA.created_at AS acreate,\r\nS.country,\r\nstage\r\nFROM \"Answer\" AS A\r\nJOIN \"SiteTrialQuestion\" AS STQ ON A.site_trial_question_id = STQ.id\r\nJOIN \"Question\" AS Q ON Q.id = STQ.question_id\r\nJOIN \"InclusionExclusionCriteriaQuestion\" IECQ ON IECQ.question_id = Q.id\r\nJOIN \"InclusionExclusionCriteria\" IEC ON IECQ.ie_criteria_id = IEC.id\r\nRIGHT JOIN \"SiteTrialPatientView\" AS STPV ON STPV.id = A.site_trial_patient_id\r\nJOIN \"SiteTrialView\" AS STV ON STV.id = STQ.site_trial_id and STV.is_pseudo = false\r\nJOIN \"Trial\" AS T ON T.id = sponsor_trial_id AND T.id = IEC.trial_id AND T.is_pseudo = false\r\nJOIN \"TrialGrant\" TG on TG.trial_id = T.id\r\nJOIN \"Site\" AS S ON S.id = STV.site_id AND S.is_pseudo = false\r\nWhere   \r\nSTV.ie_criteria_checklist_enabled = true\r\nAND stage != 'archive'\r\nAND (('_all_'=${Trials}) or (cast(T.id as text) = ${Trials}))\r\nAND (('_all_' in (${SiteTrials})) or (cast(STPV.site_trial_id as text) in (${SiteTrials})))\r\nAND TG.user_id = 'auth0|5d9234f1bc48890e1d290c57') as body\r\nwhere (('All Failures'in (${Failures})) or (cast(stage as text) in (${Failures})))\r\n),\r\nLatestQuestion as (select patient_id,question_id,max(created_at) as created_at\r\nFROM RAWDATA\r\ngroup by patient_id,question_id ),\r\nraw_main as (select r.* from RAWDATA r JOIN LatestQuestion lq on r.patient_id=lq.patient_id and r.question_id = lq.question_id and r.created_at = lq.created_at),\r\nmaxcreation AS (\r\nSELECT raw.trial_name,raw.trial_id, raw.site_name,raw.site_id,\r\nRANK() OVER(\r\nPARTITION BY raw.trial_name,raw.site_name\r\nORDER BY COUNT(raw.Criteria) DESC) AS ranking,\r\nraw.Criteria,\r\nCOUNT(raw.Criteria) AS Number_of_patients,\r\nraw.question_text,\r\nraw.country\r\nFROM raw_main AS raw\r\nINNER JOIN (\r\n  SELECT trial_name,site_name, MAX(created_at) AS creation\r\n  FROM raw_main\r\n  GROUP BY trial_name,site_name) b ON raw.trial_name = b.trial_name and raw.site_name = b.site_name\r\nWHERE \r\nraw.criteria=${selected_criteria_code}\r\nAND (('All Protocols' in (${Protocols})) or (cast(protocol_name_and_version as text) in (${Protocols})))\r\nAND raw.created_at = b.creation\r\nAND ((response = 'Yes' AND criterion_type = 'exclusion') OR (response = 'No' AND criterion_type = 'inclusion'))\r\nGROUP BY raw.trial_name, raw.trial_id,raw.site_name, raw.site_id, raw.criteria, raw.question_text,raw.country\r\n)\r\nselect \r\nmc1.site_id,mc1.site_name,mc1.trial_id,mc1.trial_name,mc1.ranking,\r\nmc1.number_of_patients,\r\nsum(mc1.number_of_patients) over(partition by trial_id order by trial_id) as sum_by_trial,\r\nsum(mc1.number_of_patients) over(partition by criteria,question_text order by criteria,question_text) as sum_by_site,\r\nmc1.criteria as failed_criteria,\r\nmc1.question_text as failed_criteria_text,\r\nmc1.country\r\nfrom maxcreation as mc1\r\ngroup by mc1.site_id,mc1.site_name,mc1.trial_id,mc1.trial_name,mc1.ranking,\r\nmc1.number_of_patients,mc1.criteria,mc1.question_text,country\r\norder by mc1.site_id,mc1.trial_id)  \"criteria failure responses\" \r\ngroup by\r\n\t\"criteria failure responses\".\"country\" \r\norder by\r\n\tsum(\"criteria failure responses\".\"number_of_patients\") desc, \"criteria failure responses\".\"country\" asc","parameters":[{"parameter":{"default":"","name":"Trials","type":"Collection"}},{"parameter":{"default":"","name":"user_name","type":"String"}},{"parameter":{"default":"","name":"selected_criteria_code","type":"String"}},{"parameter":{"default":"","name":"SiteTrials","type":"Collection"}},{"parameter":{"default":"","name":"Protocols","type":"Collection"}},{"parameter":{"default":"","name":"Failures","type":"Collection"}}]}},{"dataMap":{"name":"customScript","id":"19","type":"sql","connection":"1","query":"select 1 as one"}}]},"visualisation":[{"id":"1","name":"failure_ParentTable","type":"Custom","dataSource":"1","settings":{"script":"if (data.length == 0) {\r\n\t\t\t    $('#chart_1').html(\"<div ><h4 style='font-family:Lato;text-align:CENTER;color:#777d94; padding-top:80px;'>No Data Available For Current Selection<\/h4><\/div>\");\r\n\t\t\t    return;\r\n} else {\r\nvar link = document.createElement(\"link\");\r\n\t\t\t\t  link.rel = \"stylesheet\";\r\n\t\t\t\t  \r\n\t\t\t\t  if(window.DashboardGlobals)\r\n\t\t\t\t\t\tlink.href = window.DashboardGlobals.baseUrl+\"/getExternalResource.html?path=1594625979695/1600153490910/jquery.dataTables.css\";\t\t\t\t\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tlink.href = \"getExternalResource.html?path=1594625979695/1600153490910/jquery.dataTables.css\";\r\n\t\t\t\t  \r\n\t\t\t\t\r\n\t\t\t\t document.getElementsByTagName(\"head\")[0].appendChild(link);\r\n\t\t\t\t var link2 = document.createElement(\"link\");\r\n\t\t\t\t link2.rel = 'stylesheet';\r\n\t\t\t\tif(window.DashboardGlobals)\r\n\t\t\t\tlink2.href = \"https://fonts.googleapis.com/css?family=Lato\";\r\n\t\t\t\telse\r\n\t\t\t\tlink2.href = \"https://fonts.googleapis.com/css?family=Lato\";\r\n\r\n\t\t\t\tdocument.getElementsByTagName(\"head\")[0].appendChild(link2);\r\n\t\t\t\t \r\n\t\t\t\t \r\n\t\t\t\t   var script = document.createElement(\"script\");\r\n\t\t\t\t   scriptLoaded = false;\r\n\t\t\t\t   \r\n\t\t\t\t\tif(window.DashboardGlobals)\r\n\t\t\t\t\t\tscript.src = window.DashboardGlobals.baseUrl+\"/getExternalResource.html?path=1594625979695/1600153490910/jquery.dataTables.min.js\";\t\t\t\t\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tscript.src = \"getExternalResource.html?path=1594625979695/1600153490910/jquery.dataTables.min.js\";\r\n\t\t\t\t \r\n\t\t\t\t script.async = false;\r\n\t\t\t\t document.getElementsByTagName(\"head\")[0].appendChild(script);\r\n\r\n                                var column_index=[];\r\n\t\t\t\t\t\t\t\tvar flag;\r\n\t\t\t\t\t\t\t\tfunction tabulate(elem, data, columns) {\t\r\n\t\t\t\t\t\t\t\tvar table = d3.select(elem).append(\"table\")\t\r\n\t\t\t\t\t\t\t\t.attr(\"class\",\" table display compact width:100%;cellspacing:1 \")\r\n\t\t\t\t\t\t\t\t.attr(\"id\",\"table\")\r\n\t\t\t\t\t\t\t\tthead = table.append(\"thead\"),\r\n\t\t\t\t\t\t\t\ttbody = table.append(\"tbody\");\r\n\r\n\r\n\t\t\t\t\t\t\t\t// append the header row\r\n\t\t\t\t\t\t\t\tthead.append(\"tr\")\r\n\t\t\t\t\t\t\t\t.selectAll(\"th\")\r\n\t\t\t\t\t\t\t\t.data(columns)\r\n\t\t\t\t\t\t\t\t.enter()\r\n\t\t\t\t\t\t\t\t.append(\"th\")\r\n\t\t\t\t\t\t\t\t.text(function(column) { return column; })\r\n\t\t\t\t\t\t\t\t.attr('class', function(d, i){ return \"colH_\" + i; })\r\n\t\t\t\t\t\t\t\t.style('background-color','#f6f6f6')\r\n\t\t\t\t\t\t\t\t//.style('font-size','13px')\r\n\t\t\t\t\t\t\t\t.style('font-weight', 'normal')\r\n\t\t\t\t\t\t\t\t.style('font-family', 'Lato')\r\n\t\t\t\t\t\t\t\t.style('color','#777d94')\r\n\t\t\t\t\t\t\t\t//.style('border-left','1px solid #d2cfcf75')\r\n\t\t\t\t\t\t\t\t.style('text-align','left')\r\n\t\t\t\t\t\t\t\t//.style('padding-bottom','10px')\r\n\t\t\t\t\t\t\t\t//.style('@media print','display:none')\r\n\t\t\t\t\t\t\t\t//.style('padding-left','25px')\r\n\t\t\t\t\t\t\t\t.style('min-width','10rem')\r\n\t\t\t\t\t\t\t\t.style('padding','1rem')\r\n\r\n\r\n\t\t\t\t\t\t\t\t// create a row for each object in the data\r\n\t\t\t\t\t\t\t\tvar rows = tbody.selectAll(\"tr\")\r\n\t\t\t\t\t\t\t\t.data(data)\r\n\t\t\t\t\t\t\t\t.enter()\r\n\t\t\t\t\t\t\t\t.append(\"tr\");\r\n\r\n\t\t\t\t\t\t\t\t// create a cell in each row for each column\r\n\t\t\t\t\t\t\t\tvar cells = rows.selectAll(\"td\")\r\n\t\t\t\t\t\t\t\t.data(function(row) {\r\n\t\t\t\t\t\t\t\treturn columns.map(function(column) {\r\n\t\t\t\t\t\t\t\treturn {column: column, value: row[column]};\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t.enter()\r\n\t\t\t\t\t\t\t\t.append(\"td\")\r\n\t\t\t\t\t\t\t\t.text(function(d) { return d.value; })\r\n\t\t\t\t\t\t\t\t.attr('class', function(d, i){ return \"col_\" + i; })\r\n\t\t\t\t\t\t\t\t//.attr('align', 'center')\r\n\t\t\t\t\t\t\t\t.style('color','#777d94')\r\n\t\t\t\t\t\t\t\t//.style('font-size','13px')\r\n\t\t\t\t\t\t\t\t.style('font-weight', 'normal')\r\n\t\t\t\t\t\t\t\t.style('font-family', 'Lato')\r\n\t\t\t\t\t\t\t\t.style('vertical-align', 'middle')\r\n\t\t\t\t\t\t\t\t.style('padding', '1.5rem')\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\treturn table;\r\n\t\t\t\t\t\t\t\t}\t\r\n\r\n\t\t\t\t\t\t\t\t// render the table\r\n\t\t\t\t\t\t\t\tvar subjectTable = tabulate( '#chart_1', data, Object.keys(data[0]));\t\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t  script.onload = function(){\r\n\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tvar firstrecord=true;\r\n\t\t\t\t\t\t\t\tvar firstValue = 0;\r\n\t\t\t\t\t\t\t\tvar localizedData=0;\r\n\t\t\t\t\t\t\t\t//const getNavigatorLanguage='en-US';\r\n\t\t\t\t\t\t\t\tconst getNavigatorLanguage = (navigator.languages && navigator.languages.length) ? navigator.languages[0] : navigator.userLanguage || navigator.language || navigator.browserLanguage || 'en-US';\r\n\t\t\t\t\t\t\t\tconst urlString = window.location.search;\r\n\t\t\t\t\t\t\t\tconst urlParams = new URLSearchParams(urlString);\r\n\t\t\t\t\t\t\t\tconsole.log(\"URL has pageLength: \",urlParams.has('pageLength'));\r\n\t\t\t\t\t\t\t\tconsole.log(\"pageLength: \",urlParams.get('pageLength'));\r\n\t\t\t\t\t\t\t\tif(urlParams.has('pageLength'))\r\n\t\t\t\t\t\t\t\tvar pageLength=parseInt(urlParams.get('pageLength'));\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\tvar pageLength=50;\r\n\t\t\t\t\t\t\t\tconsole.log(\"Data Length: \",data.length);\r\n\t\t\t\t\t\t\t\tif(data.length > pageLength)\r\n\t\t\t\t\t\t\t\tvar paging=true\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\tvar paging=false\r\n\t\t\t\t\t\t\t\t$(document).ready(function() {\t\r\n\t\t\t\t\t\t\t\ttable = $('#table').DataTable({\r\n\t\t\t\t\t\t\t\t\t//\"deferRender\": true,\r\n\t\t\t\t\t\t\t\t\t\"pageLength\": pageLength,\r\n\t\t\t\t\t\t\t\t\t\"lengthChange\": false,\r\n\t\t\t\t\t\t\t\t\t//\"pagingType\": \"full_numbers\",\r\n\t\t\t\t\t\t\t\t\t//\"lengthMenu\": [[25, 10, 25, 50, -1], [10, 10, 25, 50, \"All\"]],\r\n\t\t\t\t\t\t\t\t\t\"paging\": paging,\r\n\t\t\t\t\t\t\t\t\t\"jQueryUI\": true,\r\n\t\t\t\t\t\t\t\t\t\"ordering\": false,\r\n\t\t\t\t\t\t\t\t\t\"info\": true,\r\n\t\t\t\t\t\t\t\t\t//\"bFilter\": false,\r\n\t\t\t\t\t\t\t\t\tautoWidth: false,\r\n\t\t\t\t\t\t\t\t\t\"columns\": [\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\"title\":\"\",\r\n\t\t\t\t\t\t\t\t\t\t\"sortable\":false,\r\n\t\t\t\t\t\t\t\t\t\t\"width\":'96px',\r\n\t\t\t\t\t\t\t\t\t\t\"render\": function(data, type, row, meta){\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tfor(var i = 0; i < Object.keys(data).length; i++){\r\n\t\t\t\t\t\t\t\t\t\t\t\tif(firstrecord){\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tfirstValue = Math.round((120/data + Number.EPSILON)*100)/100;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tfirstrecord=false;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn $(\"<div class='bar-chart-bar' id='main-table-bars'><\/div>\", {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}).css({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"width\": '120px',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"background-color\": '#85000b'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}).prop(\"outerHTML\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvar remainValues = Math.round((firstValue*data + Number.EPSILON)*100)/100;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvar backColor='#fef8f9';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    if(remainValues>90){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#85000b';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>80&&remainValues<=90){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#d2202f';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>70&&remainValues<=80){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#df5f6a';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>60&&remainValues<=70){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#e6838b';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>50&&remainValues<=60){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#ec9ea5';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>40&&remainValues<=50){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#f0b5ba';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>30&&remainValues<=40){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#f4c8cc';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>20&&remainValues<=30){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#f8dadc';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>10&&remainValues<=20){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#fbe9eb';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues=>0&&remainValues<=10){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#fef8f9';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn $(\"<div class='bar-chart-bar'><\/div>\", {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}).css({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"width\": remainValues+'px',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"background-color\": backColor\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}).prop(\"outerHTML\")\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\"type\": \"html\",\r\n\t\t\t\t\t\t\t\t\t\t\"title\":\"# of Patients\",\r\n\t\t\t\t\t\t\t\t\t\t\"width\":'120px',\r\n\t\t\t\t\t\t\t\t\t\t\"render\":function(data){\r\n\t\t\t\t\t\t\t\t\t\t\treturn getLanguage(parseInt(data));\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\"title\":\"Percentage\",\r\n\t\t\t\t\t\t\t\t\t\t\"width\":'120px',\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\"title\":\"Failed Criteria\",\r\n\t\t\t\t\t\t\t\t\t\t\"width\":'120px',\r\n\t\t\t\t\t\t\t\t\t\t\"render\":function(data){\r\n\t\t\t\t\t\t\t\t\t\t\treturn \"<div><span   class='criteria-failure-codes'>\"+data+\"<\/span><\/div>\"\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\"title\":\"\",\r\n\t\t\t\t\t\t\t\t\t\t\"className\": \"text-left\",\r\n\t\t\t\t\t\t\t\t\t\t\"render\":function(data, type, row, meta){\r\n\t\t\t\t\t\t\t\t\t\t\tvar data=decodeHTML(data);\r\n\t\t\t\t\t\t\t\t\t\t\tvar showChar = 200;\r\n\t\t\t\t\t\t\t\t\t\t\tvar openDet=false;\r\n\t\t\t\t\t\t\t\t\t\t\tvar actualshowChar=data.indexOf(' ', showChar);\r\n\t\t\t\t\t\t\t\t\t\t\tif(actualshowChar!=-1) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tvar frontString = data.substr(0, actualshowChar);\r\n\t\t\t\t\t\t\t\t\t\t\t\tvar backString = data.substr(actualshowChar, data.length);\r\n\t\t\t\t\t\t\t\t\t\t\t\tvar html='<details style=\" font-family: Lato; cursor: pointer;\">'+backString+'<summary style=\" font-family: Lato;\">'+frontString+'<span class=\"elipsisSpan\">...<\/span><\/summary><\/details>';\r\n\t\t\t\t\t\t\t\t\t\t\t\treturn html.toString();\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\t\t\t\t\t\treturn data;\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tfunction getLanguage(localizedData){\r\n\t\t\t\t\t\t\t\t\treturn localizedData.toLocaleString(getNavigatorLanguage) \r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tfunction decodeHTML(encodedHTML){ return $('<div>').html(encodedHTML).text(); }\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tconst details = document.querySelectorAll(\"details\");\r\n\t\t\t\t\t\t\t\tdetails.forEach((targetDetail) => {\r\n\t\t\t\t\t\t\t\t  targetDetail.addEventListener(\"click\", () => {\r\n\t\t\t\t\t\t\t\t\t// Close all the details that are not targetDetail.\r\n\t\t\t\t\t\t\t\t\tdetails.forEach((detail) => {\r\n\t\t\t\t\t\t\t\t\t  if (detail !== targetDetail) {\r\n\t\t\t\t\t\t\t\t\t\tdetail.removeAttribute(\"open\");\r\n\t\t\t\t\t\t\t\t\t  }\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t  });\r\n\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\t});\t\r\n\t\t\t\t\t\t\t\t \r\n\t\t  }\r\n}"}},{"id":"2","name":"failure_by_site","type":"Custom","dataSource":"4","settings":{"script":"if (data.length == 0) {\r\n\t\t\t    $('#chart_2').html(\"<div ><h4 style='font-family:Lato;text-align:CENTER;color:#777d94; padding-top:60px;'>No Data Available For Current Selection<\/h4><\/div>\");\r\n\t\t\t    return;\r\n} else {\r\nvar link = document.createElement(\"link\");\r\n\t\t\t\t  link.rel = \"stylesheet\";\r\n\t\t\t\t  \r\n\t\t\t\t  if(window.DashboardGlobals)\r\n\t\t\t\t\t\tlink.href = window.DashboardGlobals.baseUrl+\"/getExternalResource.html?path=1594625979695/1600153490910/jquery.dataTables.css\";\t\t\t\t\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tlink.href = \"getExternalResource.html?path=1594625979695/1600153490910/jquery.dataTables.css\";\r\n\t\t\t\t  \r\n\t\t\t\t\r\n\t\t\t\t document.getElementsByTagName(\"head\")[0].appendChild(link);\r\n\t\t\t\t var link2 = document.createElement(\"link\");\r\n\t\t\t\t link2.rel = 'stylesheet';\r\n\t\t\t\tif(window.DashboardGlobals)\r\n\t\t\t\tlink2.href = \"https://fonts.googleapis.com/css?family=Lato\";\r\n\t\t\t\telse\r\n\t\t\t\tlink2.href = \"https://fonts.googleapis.com/css?family=Lato\";\r\n\r\n\t\t\t\tdocument.getElementsByTagName(\"head\")[0].appendChild(link2);\r\n\t\t\t\t \r\n\t\t\t\t \r\n\t\t\t\t   var script = document.createElement(\"script\");\r\n\t\t\t\t   scriptLoaded = false;\r\n\t\t\t\t   \r\n\t\t\t\t\tif(window.DashboardGlobals)\r\n\t\t\t\t\t\tscript.src = window.DashboardGlobals.baseUrl+\"/getExternalResource.html?path=1594625979695/1600153490910/jquery.dataTables.min.js\";\t\t\t\t\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tscript.src = \"getExternalResource.html?path=1594625979695/1600153490910/jquery.dataTables.min.js\";\r\n\t\t\t\t \r\n\t\t\t\t script.async = false;\r\n\t\t\t\t document.getElementsByTagName(\"head\")[0].appendChild(script);\r\n\r\n                                var column_index=[];\r\n\t\t\t\t\t\t\t\tvar flag;\r\n\t\t\t\t\t\t\t\tfunction tabulate(elem, data, columns) {\t\r\n\t\t\t\t\t\t\t\tvar table = d3.select(elem).append(\"table\")\t\r\n\t\t\t\t\t\t\t\t.attr(\"class\",\" table display compact width:100%;cellspacing:1 \")\r\n\t\t\t\t\t\t\t\t.attr(\"id\",\"table_child\")\r\n\t\t\t\t\t\t\t\tthead = table.append(\"thead\"),\r\n\t\t\t\t\t\t\t\ttbody = table.append(\"tbody\");\r\n\r\n\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t// append the header row\r\n\t\t\t\t\t\t\t\tthead.append(\"tr\")\r\n\t\t\t\t\t\t\t\t.selectAll(\"th\")\r\n\t\t\t\t\t\t\t\t.data(columns)\r\n\t\t\t\t\t\t\t\t.enter()\r\n\t\t\t\t\t\t\t\t.append(\"th\")\r\n\t\t\t\t\t\t\t\t.text(function(column) { return column; })\r\n\t\t\t\t\t\t\t\t.attr('class', function(d, i){ return \"colH_\" + i; })\r\n\t\t\t\t\t\t\t\t.style('background-color','#f6f6f6')\r\n\t\t\t\t\t\t\t\t//.style('font-size','13px')\r\n\t\t\t\t\t\t\t\t.style('font-weight', 'normal')\r\n\t\t\t\t\t\t\t\t.style('font-family', 'Lato')\r\n\t\t\t\t\t\t\t\t.style('color','#777d94')\r\n\t\t\t\t\t\t\t\t//.style('border-left','1px solid #d2cfcf75')\r\n\t\t\t\t\t\t\t\t.style('text-align','left')\r\n\t\t\t\t\t\t\t\t//.style('padding-bottom','10px')\r\n\t\t\t\t\t\t\t\t//.style('@media print','display:none')\r\n\t\t\t\t\t\t\t\t//.style('padding-left','25px')\r\n\t\t\t\t\t\t\t\t.style('min-width','10rem')\r\n\t\t\t\t\t\t\t\t.style('padding','1rem');\r\n\t\t\t\t\t\t\t\t\r\n\r\n\r\n\t\t\t\t\t\t\t\t// create a row for each object in the data\r\n\t\t\t\t\t\t\t\tvar rows = tbody.selectAll(\"tr\")\r\n\t\t\t\t\t\t\t\t.data(data)\r\n\t\t\t\t\t\t\t\t.enter()\r\n\t\t\t\t\t\t\t\t.append(\"tr\");\r\n\r\n\t\t\t\t\t\t\t\t// create a cell in each row for each column\r\n\t\t\t\t\t\t\t\tvar cells = rows.selectAll(\"td\")\r\n\t\t\t\t\t\t\t\t.data(function(row) {\r\n\t\t\t\t\t\t\t\treturn columns.map(function(column) {\r\n\t\t\t\t\t\t\t\treturn {column: column, value: row[column]};\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t.enter()\r\n\t\t\t\t\t\t\t\t.append(\"td\")\r\n\t\t\t\t\t\t\t\t.text(function(d) { return d.value; })\r\n\t\t\t\t\t\t\t\t.attr('class', function(d, i){ return \"col_\" + i; })\r\n\t\t\t\t\t\t\t\t//.attr('align', 'center')\r\n\t\t\t\t\t\t\t\t.style('color','#777d94')\r\n\t\t\t\t\t\t\t\t//.style('font-size','13px')\r\n\t\t\t\t\t\t\t\t.style('font-weight', 'normal')\r\n\t\t\t\t\t\t\t\t.style('font-family', 'Lato')\r\n\t\t\t\t\t\t\t\t.style('vertical-align', 'middle')\r\n\t\t\t\t\t\t\t\t.style('padding', '1.5rem')\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\treturn table;\r\n\t\t\t\t\t\t\t\t}\t\r\n\r\n\t\t\t\t\t\t\t\t// render the table\r\n\t\t\t\t\t\t\t\tvar subjectTable = tabulate( '#chart_2', data, Object.keys(data[0]));\t\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t  script.onload = function(){\r\n\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tvar firstrecord=true;\r\n\t\t\t\t\t\t\t\tvar firstValue = 0;\r\n\t\t\t\t\t\t\t\tvar localizedData=0;\r\n\t\t\t\t\t\t\t\t//const getNavigatorLanguage='en-US';\r\n\t\t\t\t\t\t\t\tconst getNavigatorLanguage = (navigator.languages && navigator.languages.length) ? navigator.languages[0] : navigator.userLanguage || navigator.language || navigator.browserLanguage || 'en-US';\r\n\t\t\t\t\t\t\t\tconst urlString = window.location.search;\r\n\t\t\t\t\t\t\t\tconst urlParams = new URLSearchParams(urlString);\r\n\t\t\t\t\t\t\t\tif(urlParams.has('pageLength'))\r\n\t\t\t\t\t\t\t\tvar pageLength=parseInt(urlParams.get('pageLength'));\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\tvar pageLength=50;\r\n\t\t\t\t\t\t\t\tconsole.log(\"Data Length: \",data.length);\r\n\t\t\t\t\t\t\t\tif(data.length > pageLength)\r\n\t\t\t\t\t\t\t\tvar paging=true\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\tvar paging=false\r\n\t\t\t\t\t\t\t\t$(document).ready(function() {\r\n\t\t\t\t\t\t\t\tconsole.log(\"Inside Ready: \");\r\n\t\t\t\t\t\t\t\tvar table_by_store = $('#table_child').DataTable({\r\n\t\t\t\t\t\t\t\t\t//\"deferRender\": true,\r\n\t\t\t\t\t\t\t\t\t\"pageLength\": pageLength,\r\n\t\t\t\t\t\t\t\t\t\"lengthChange\": false,\r\n\t\t\t\t\t\t\t\t\t//\"pagingType\": \"full_numbers\",\r\n\t\t\t\t\t\t\t\t\t//\"lengthMenu\": [[25, 10, 25, 50, -1], [10, 10, 25, 50, \"All\"]],\r\n\t\t\t\t\t\t\t\t\t\"paging\": paging,\r\n\t\t\t\t\t\t\t\t\t\"jQueryUI\": true,\r\n\t\t\t\t\t\t\t\t\t\"ordering\": false,\r\n\t\t\t\t\t\t\t\t\t\"info\": true,\r\n\t\t\t\t\t\t\t\t\t\"bFilter\": false,\r\n\t\t\t\t\t\t\t\t\tautoWidth: false,\r\n\t\t\t\t\t\t\t\t\t\"columns\": [\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\"title\":\"\",\r\n\t\t\t\t\t\t\t\t\t\t\"sortable\":false,\r\n\t\t\t\t\t\t\t\t\t\t\"width\":'96px',\r\n\t\t\t\t\t\t\t\t\t\t\"render\": function(data, type, row, meta){\r\n\t\t\t\t\t\t\t\t\t\t\tfor(var i = 0; i < Object.keys(data).length; i++){\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\tif(firstrecord){\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tfirstValue = Math.round((120/data + Number.EPSILON)*100)/100;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tfirstrecord=false;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn $(\"<div class='bar-chart-bar'><\/div>\", {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}).css({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"width\": '120px',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"background-color\": '#85000b'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}).prop(\"outerHTML\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvar remainValues = Math.round((firstValue*data + Number.EPSILON)*100)/100;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvar backColor='#fef8f9';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    if(remainValues>90){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#85000b';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>80&&remainValues<=90){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#d2202f';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>70&&remainValues<=80){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#df5f6a';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>60&&remainValues<=70){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#e6838b';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>50&&remainValues<=60){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#ec9ea5';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>40&&remainValues<=50){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#f0b5ba';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>30&&remainValues<=40){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#f4c8cc';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>20&&remainValues<=30){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#f8dadc';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>10&&remainValues<=20){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#fbe9eb';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues=>0&&remainValues<=10){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#fef8f9';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn $(\"<div class='bar-chart-bar'><\/div>\", {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}).css({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"width\": remainValues+'px',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"background-color\": backColor\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}).prop(\"outerHTML\")\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\"type\": \"html\",\r\n\t\t\t\t\t\t\t\t\t\t\"title\":\"\",\r\n\t\t\t\t\t\t\t\t\t\t\"width\":'120px',\r\n\t\t\t\t\t\t\t\t\t\t\"render\":function(data){\r\n\t\t\t\t\t\t\t\t\t\t\treturn getLanguage(parseInt(data));\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\"title\":\"\",\r\n\t\t\t\t\t\t\t\t\t\t\"width\":'120px',\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\"className\": \"text-left\"\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tfunction getLanguage(localizedData){\r\n\t\t\t\t\t\t\t\t\treturn localizedData.toLocaleString(getNavigatorLanguage) \r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tfunction decodeHTML(encodedHTML){ return $('<div>').html(encodedHTML).text(); }\r\n\r\n\r\n\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t});\t\r\n\t\t\t\t\t\t\t\t \r\n\t\t  }\r\n}"}},{"id":"3","name":"failure_by_country","type":"Custom","dataSource":"5","settings":{"script":"if (data.length == 0) {\r\n\t\t\t    $('#chart_3').html(\"<div ><h4 style='font-family:Lato;text-align:CENTER;color:#777d94; padding-top:60px;'>No Data Available For Current Selection<\/h4><\/div>\");\r\n\t\t\t    return;\r\n} else {\r\nvar link = document.createElement(\"link\");\r\n\t\t\t\t  link.rel = \"stylesheet\";\r\n\t\t\t\t  \r\n\t\t\t\t  if(window.DashboardGlobals)\r\n\t\t\t\t\t\tlink.href = window.DashboardGlobals.baseUrl+\"/getExternalResource.html?path=1594625979695/1600153490910/jquery.dataTables.css\";\t\t\t\t\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tlink.href = \"getExternalResource.html?path=1594625979695/1600153490910/jquery.dataTables.css\";\r\n\t\t\t\t  \r\n\t\t\t\t\r\n\t\t\t\t document.getElementsByTagName(\"head\")[0].appendChild(link);\r\n\t\t\t\t var link2 = document.createElement(\"link\");\r\n\t\t\t\t link2.rel = 'stylesheet';\r\n\t\t\t\tif(window.DashboardGlobals)\r\n\t\t\t\tlink2.href = \"https://fonts.googleapis.com/css?family=Lato\";\r\n\t\t\t\telse\r\n\t\t\t\tlink2.href = \"https://fonts.googleapis.com/css?family=Lato\";\r\n\r\n\t\t\t\tdocument.getElementsByTagName(\"head\")[0].appendChild(link2);\r\n\t\t\t\t \r\n\t\t\t\t \r\n\t\t\t\t   var script = document.createElement(\"script\");\r\n\t\t\t\t   scriptLoaded = false;\r\n\t\t\t\t   \r\n\t\t\t\t\tif(window.DashboardGlobals)\r\n\t\t\t\t\t\tscript.src = window.DashboardGlobals.baseUrl+\"/getExternalResource.html?path=1594625979695/1600153490910/jquery.dataTables.min.js\";\t\t\t\t\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tscript.src = \"getExternalResource.html?path=1594625979695/1600153490910/jquery.dataTables.min.js\";\r\n\t\t\t\t \r\n\t\t\t\t script.async = false;\r\n\t\t\t\t document.getElementsByTagName(\"head\")[0].appendChild(script);\r\n\r\n                                var column_index=[];\r\n\t\t\t\t\t\t\t\tvar flag;\r\n\t\t\t\t\t\t\t\tfunction tabulate(elem, data, columns) {\t\r\n\t\t\t\t\t\t\t\tvar table = d3.select(elem).append(\"table\")\t\r\n\t\t\t\t\t\t\t\t.attr(\"class\",\" table display compact width:100%;cellspacing:1 \")\r\n\t\t\t\t\t\t\t\t.attr(\"id\",\"table_child2\")\r\n\t\t\t\t\t\t\t\tthead = table.append(\"thead\"),\r\n\t\t\t\t\t\t\t\ttbody = table.append(\"tbody\");\r\n\r\n\r\n\t\t\t\t\t\t\t\t// append the header row\r\n\t\t\t\t\t\t\t\tthead.append(\"tr\")\r\n\t\t\t\t\t\t\t\t.selectAll(\"th\")\r\n\t\t\t\t\t\t\t\t.data(columns)\r\n\t\t\t\t\t\t\t\t.enter()\r\n\t\t\t\t\t\t\t\t.append(\"th\")\r\n\t\t\t\t\t\t\t\t.text(function(column) { return column; })\r\n\t\t\t\t\t\t\t\t.attr('class', function(d, i){ return \"colH_\" + i; })\r\n\t\t\t\t\t\t\t\t.style('background-color','#f6f6f6')\r\n\t\t\t\t\t\t\t\t//.style('font-size','13px')\r\n\t\t\t\t\t\t\t\t.style('font-weight', 'normal')\r\n\t\t\t\t\t\t\t\t.style('font-family', 'Lato')\r\n\t\t\t\t\t\t\t\t.style('color','#777d94')\r\n\t\t\t\t\t\t\t\t//.style('border-left','1px solid #d2cfcf75')\r\n\t\t\t\t\t\t\t\t.style('text-align','left')\r\n\t\t\t\t\t\t\t\t//.style('padding-bottom','10px')\r\n\t\t\t\t\t\t\t\t//.style('@media print','display:none')\r\n\t\t\t\t\t\t\t\t//.style('padding-left','25px')\r\n\t\t\t\t\t\t\t\t.style('min-width','10rem')\r\n\t\t\t\t\t\t\t\t.style('padding','1rem')\r\n\r\n\r\n\t\t\t\t\t\t\t\t// create a row for each object in the data\r\n\t\t\t\t\t\t\t\tvar rows = tbody.selectAll(\"tr\")\r\n\t\t\t\t\t\t\t\t.data(data)\r\n\t\t\t\t\t\t\t\t.enter()\r\n\t\t\t\t\t\t\t\t.append(\"tr\");\r\n\r\n\t\t\t\t\t\t\t\t// create a cell in each row for each column\r\n\t\t\t\t\t\t\t\tvar cells = rows.selectAll(\"td\")\r\n\t\t\t\t\t\t\t\t.data(function(row) {\r\n\t\t\t\t\t\t\t\treturn columns.map(function(column) {\r\n\t\t\t\t\t\t\t\treturn {column: column, value: row[column]};\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t.enter()\r\n\t\t\t\t\t\t\t\t.append(\"td\")\r\n\t\t\t\t\t\t\t\t.text(function(d) { return d.value; })\r\n\t\t\t\t\t\t\t\t.attr('class', function(d, i){ return \"col_\" + i; })\r\n\t\t\t\t\t\t\t\t//.attr('align', 'center')\r\n\t\t\t\t\t\t\t\t.style('color','#777d94')\r\n\t\t\t\t\t\t\t\t//.style('font-size','13px')\r\n\t\t\t\t\t\t\t\t.style('font-weight', 'normal')\r\n\t\t\t\t\t\t\t\t.style('font-family', 'Lato')\r\n\t\t\t\t\t\t\t\t.style('vertical-align', 'middle')\r\n\t\t\t\t\t\t\t\t.style('padding', '1.5rem')\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\treturn table;\r\n\t\t\t\t\t\t\t\t}\t\r\n\r\n\t\t\t\t\t\t\t\t// render the table\r\n\t\t\t\t\t\t\t\tvar subjectTable = tabulate( '#chart_3', data, Object.keys(data[0]));\t\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t  script.onload = function(){\r\n\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tvar firstrecord=true;\r\n\t\t\t\t\t\t\t\tvar firstValue = 0;\r\n\t\t\t\t\t\t\t\tvar localizedData=0;\r\n\t\t\t\t\t\t\t\t//const getNavigatorLanguage='en-US';\r\n\t\t\t\t\t\t\t\tconst getNavigatorLanguage = (navigator.languages && navigator.languages.length) ? navigator.languages[0] : navigator.userLanguage || navigator.language || navigator.browserLanguage || 'en-US';\r\n\t\t\t\t\t\t\t\tconst urlString = window.location.search;\r\n\t\t\t\t\t\t\t\tconst urlParams = new URLSearchParams(urlString);\r\n\t\t\t\t\t\t\t\tif(urlParams.has('pageLength'))\r\n\t\t\t\t\t\t\t\tvar pageLength=parseInt(urlParams.get('pageLength'));\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\tvar pageLength=50;\r\n\t\t\t\t\t\t\t\tif(data.length > pageLength)\r\n\t\t\t\t\t\t\t\tvar paging=true\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\tvar paging=false\r\n\t\t\t\t\t\t\t\t$(document).ready(function() {\r\n\t\t\t\t\t\t\t\tconsole.log(\"Inside Ready: \");\r\n\t\t\t\t\t\t\t\tvar table_by_store = $('#table_child2').DataTable({\r\n\t\t\t\t\t\t\t\t\t//\"deferRender\": true,\r\n\t\t\t\t\t\t\t\t\t\"pageLength\": pageLength,\r\n\t\t\t\t\t\t\t\t\t\"lengthChange\": false,\r\n\t\t\t\t\t\t\t\t\t//\"pagingType\": \"full_numbers\",\r\n\t\t\t\t\t\t\t\t\t//\"lengthMenu\": [[25, 10, 25, 50, -1], [10, 10, 25, 50, \"All\"]],\r\n\t\t\t\t\t\t\t\t\t\"paging\": paging,\r\n\t\t\t\t\t\t\t\t\t\"jQueryUI\": true,\r\n\t\t\t\t\t\t\t\t\t\"ordering\": false,\r\n\t\t\t\t\t\t\t\t\t\"info\": true,\r\n\t\t\t\t\t\t\t\t\t\"bFilter\": false,\r\n\t\t\t\t\t\t\t\t\tautoWidth: false,\r\n\t\t\t\t\t\t\t\t\t\"columns\": [\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\"title\":\"\",\r\n\t\t\t\t\t\t\t\t\t\t\"sortable\":false,\r\n\t\t\t\t\t\t\t\t\t\t\"width\":'96px',\r\n\t\t\t\t\t\t\t\t\t\t\"render\": function(data, type, row, meta){\r\n\t\t\t\t\t\t\t\t\t\t\tfor(var i = 0; i < Object.keys(data).length; i++){\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\tif(firstrecord){\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tfirstValue = Math.round((120/data + Number.EPSILON)*100)/100;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tfirstrecord=false;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn $(\"<div class='bar-chart-bar'><\/div>\", {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}).css({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"width\": '120px',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"background-color\": '#85000b'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}).prop(\"outerHTML\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvar remainValues = Math.round((firstValue*data + Number.EPSILON)*100)/100;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvar backColor='#fef8f9';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    if(remainValues>90){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#85000b';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>80&&remainValues<=90){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#d2202f';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>70&&remainValues<=80){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#df5f6a';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>60&&remainValues<=70){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#e6838b';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>50&&remainValues<=60){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#ec9ea5';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>40&&remainValues<=50){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#f0b5ba';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>30&&remainValues<=40){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#f4c8cc';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>20&&remainValues<=30){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#f8dadc';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues>10&&remainValues<=20){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#fbe9eb';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t    else if(remainValues=>0&&remainValues<=10){\r\n\t\t\t\t\t\t\t\t\t\t\t\t    backColor='#fef8f9';\r\n\t\t\t\t\t\t\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn $(\"<div class='bar-chart-bar'><\/div>\", {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}).css({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"width\": remainValues+'px',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"background-color\": backColor\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}).prop(\"outerHTML\")\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\"type\": \"html\",\r\n\t\t\t\t\t\t\t\t\t\t\"title\":\"\",\r\n\t\t\t\t\t\t\t\t\t\t\"width\":'120px',\r\n\t\t\t\t\t\t\t\t\t\t\"render\":function(data){\r\n\t\t\t\t\t\t\t\t\t\t\treturn getLanguage(parseInt(data));\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\"title\":\"\",\r\n\t\t\t\t\t\t\t\t\t\t\"width\":'120px',\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\"className\": \"text-left\"\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tfunction getLanguage(localizedData){\r\n\t\t\t\t\t\t\t\t\treturn localizedData.toLocaleString(getNavigatorLanguage) \r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tfunction decodeHTML(encodedHTML){ return $('<div>').html(encodedHTML).text(); }\r\n\r\n\r\n\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t});\t\r\n\t\t\t\t\t\t\t\t \r\n\t\t  }\r\n}"}}],"dir":"1594625979695/1596543365504/1597651091967","file":"Criteria Failure Report","uuid":"2c32d272-b7a7-444f-bb15-ec4577fafa5f","componentJson":{"@class":"com.helicalinsight.efwce.DashboardIOHandler"}}}]]></state>
    <security>
        <createdBy>1</createdBy>
        <organization></organization>
    </security>
</efwce>
